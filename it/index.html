<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MyHomesBudget — Bilancio familiare semplice</title>
  <meta name="description" content="Gestisci entrate, spese e risparmi in modo semplice. Prova gratis per 30 giorni.">

  <!-- CSP -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src 'self' https: data:;
                 style-src 'self' 'unsafe-inline';
                 script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com;
                 connect-src 'self' https://www.google-analytics.com https://region1.google-analytics.com;
                 font-src 'self' https: data:;
                 frame-ancestors 'none';
                 base-uri 'self';
                 form-action 'self'">

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LSD3V9G957"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-LSD3V9G957', { anonymize_ip: true });
  </script>

  <!-- Redirect dopo verifica email -->
  <script>
    (function(){
      function itPrefix(){
        var m = location.pathname.match(/^\/(it|ita)(\/|$)/i);
        return m ? ("/" + m[1].toLowerCase() + "/") : "/it/";
      }
      var prefix = itPrefix();
      var q = new URLSearchParams(location.search);
      var hash = location.hash || '';
      var verified =
        q.get('verified') === '1' ||
        q.get('status') === 'verified' ||
        q.get('confirmed') === '1' ||
        hash.includes('verified');
      if (!verified) return;

      try {
        localStorage.setItem('email_verified','1');
        localStorage.setItem('last_verified', String(Date.now()));
      } catch(e){}
      var done = false;
      try { done = (localStorage.getItem('onboarding_completed') === '1'); } catch(e){}
      var dest = done ? 'dashboard.html' : 'onboarding.html';
      try { if (typeof gtag === 'function') gtag('event','verified_entry_redirect',{ dest: done ? 'dashboard' : 'onboarding', lang:'it' }); } catch(e){}
      location.replace(prefix + dest);
    })();
  </script>

  <!-- Social/SEO -->
  <link rel="canonical" href="https://www.myhomesbudget.com/it/"/>
  <link rel="alternate" href="https://www.myhomesbudget.com/it/" hreflang="it"/>
  <link rel="alternate" href="https://www.myhomesbudget.com/en/" hreflang="en"/>
  <link rel="alternate" href="https://www.myhomesbudget.com/es/" hreflang="es"/>
  <link rel="alternate" href="https://www.myhomesbudget.com/" hreflang="x-default"/>
  <meta property="og:title" content="MyHomesBudget — Gestisci il tuo bilancio domestico in modo semplice e intuitivo"/>
  <meta property="og:description" content="Inserisci le tue spese e le entrate in pochi click e tieni tutto sotto controllo. Prova gratis per 30 giorni."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://www.myhomesbudget.com/it/"/>
  <meta property="og:image" content="https://www.myhomesbudget.com/social.png"/>
  <meta name="twitter:card" content="summary_large_image"/>

  <!-- Perf -->
  <link rel="preload" href="/bg.webp" as="image" imagesrcset="/bg.webp"/>
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
  <link rel="preconnect" href="https://www.google-analytics.com" crossorigin>
  <link rel="preconnect" href="https://region1.google-analytics.com" crossorigin>
  <link rel="icon" href="/favicon.ico">
  <meta name="theme-color" content="#0f0f10">
  <meta name="color-scheme" content="light dark">

  <style>
    /* ════════════════════════════════════════════════════════════════════
       MOTION SYSTEM & DESIGN TOKENS
       ════════════════════════════════════════════════════════════════════ */
    :root{
      font-family:-apple-system,system-ui,"Segoe UI",Roboto,sans-serif;
      
      /* Brand gradient */
      --grad: linear-gradient(135deg,#6c5ce7,#00cec9);
      --card-border: rgba(0,0,0,.06);
      
      /* Motion tokens */
      --ease: cubic-bezier(.22,.61,.36,1);
      --dur-s: 180ms;
      --dur-m: 360ms;
      --dur-l: 640ms;
      --stagger: 80ms;
    }
    
    *{box-sizing:border-box;margin:0;padding:0}
    
    /* Focus states */
    a:focus-visible,button:focus-visible,input:focus-visible,select:focus-visible{
      outline:3px solid #00cec9;
      outline-offset:3px;
      border-radius:8px;
    }

    /* ════════════════════════════════════════════════════════════════════
       BACKGROUND & BASE
       ════════════════════════════════════════════════════════════════════ */
    body{
      margin:0;padding:0;color:#fff;overflow-x:hidden;
      background:url("/bg.webp") no-repeat center/cover fixed;
      position:relative;
    }
    body::before{
      content:"";position:fixed;inset:0;
      background:rgba(0,0,0,.08);
      z-index:-1;
    }
    
    /* Breathing gradient overlay (subtle animation) */
    body::after{
      content:"";position:fixed;inset:0;
      background:var(--grad);
      opacity:.04;
      animation:breathe var(--dur-l) ease-in-out infinite alternate;
      z-index:-1;
      pointer-events:none;
    }
    
    @keyframes breathe{
      0%{opacity:.02; filter:hue-rotate(0deg)}
      100%{opacity:.06; filter:hue-rotate(5deg)}
    }

    /* Disable animations for reduced motion */
    @media (prefers-reduced-motion:reduce){
      *,*::before,*::after{
        animation-duration:0.01ms !important;
        animation-iteration-count:1 !important;
        transition-duration:0.01ms !important;
      }
      body::after{animation:none}
    }

    /* iOS: evita jank con background fixed */
    @supports (-webkit-touch-callout: none){ 
      body{background-attachment:scroll}
      body::after{display:none}
    }

    /* ════════════════════════════════════════════════════════════════════
       TOPBAR (glassmorphism)
       ════════════════════════════════════════════════════════════════════ */
    .topbar{
      position:fixed;top:16px;left:50%;transform:translateX(-50%);
      width:min(1100px,calc(100% - 40px));z-index:100;pointer-events:none;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    .logo-link,.top-actions{pointer-events:auto}
    
    .logo-link{
      display:flex;align-items:center;gap:8px;text-decoration:none;
      transition:transform var(--dur-s) var(--ease);
    }
    .logo-link:hover{transform:translateY(-1px)}
    
    .logo-image{height:32px;filter:drop-shadow(0 2px 4px rgba(0,0,0,.3))}
    .logo-text{
      font-weight:600;color:#fff;font-size:1.05rem;
      text-shadow:0 1px 2px rgba(0,0,0,.35);
    }
    
    .top-actions{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    
    .top-link,.logout-btn{
      text-decoration:none;padding:6px 12px;border-radius:10px;font-weight:800;
      background-image:var(--grad);
      -webkit-background-clip:text;background-clip:text;color:transparent;
      transition:background var(--dur-s) var(--ease);
      border:none;cursor:pointer;font-size:inherit;font-family:inherit;
    }
    .top-link:hover,.logout-btn:hover{
      background:rgba(255,255,255,.14);
      -webkit-background-clip:initial;background-clip:initial;
      color:#fff;
    }
    
    .user-greeting{
      color:#fff;font-weight:600;font-size:.95rem;
      text-shadow:0 1px 2px rgba(0,0,0,.35);
    }
    
    .lang-selector{font-size:22px;display:flex;gap:8px}
    .lang-selector a{
      color:#fff;text-decoration:none;padding:6px 10px;border-radius:8px;
      transition:background var(--dur-s) var(--ease),transform var(--dur-s) var(--ease);
    }
    .lang-selector a:hover{
      background:rgba(255,255,255,.12);
      transform:scale(1.05);
    }

    /* ════════════════════════════════════════════════════════════════════
       STICKY CTA BAR (appears on scroll - completely independent)
       ════════════════════════════════════════════════════════════════════ */
    .sticky-cta-bar{
      position:fixed;top:0;left:0;right:0;z-index:150;
      background:rgba(10,10,12,.96);
      backdrop-filter:saturate(1.3) blur(16px);
      -webkit-backdrop-filter:saturate(1.3) blur(16px);
      border-bottom:1px solid rgba(255,255,255,.12);
      padding:12px 24px;
      display:flex;align-items:center;justify-content:center;gap:16px;
      transform:translateY(-100%);
      opacity:0;
      transition:transform var(--dur-m) var(--ease),opacity var(--dur-m) var(--ease);
      pointer-events:none;
      box-shadow:0 8px 32px rgba(0,0,0,.4);
    }
    .sticky-cta-bar.visible{
      transform:translateY(0);
      opacity:1;
      pointer-events:auto;
    }
    .sticky-cta-bar .headline{
      font-weight:700;font-size:1rem;color:#fff;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
      max-width:500px;
    }
    .sticky-cta-bar .actions{display:flex;gap:12px;align-items:center}
    .sticky-cta-bar .cta-small{
      display:inline-block;padding:10px 20px;border-radius:10px;
      background:var(--grad);color:#fff;font-weight:800;font-size:.95rem;
      text-decoration:none;white-space:nowrap;
      box-shadow:0 4px 16px rgba(108,92,231,.3);
      transition:transform var(--dur-s) var(--ease),
                 filter var(--dur-s) var(--ease),
                 box-shadow var(--dur-s) var(--ease);
    }
    .sticky-cta-bar .cta-small:hover{
      transform:translateY(-2px) scale(1.05);
      filter:brightness(1.15);
      box-shadow:0 6px 24px rgba(108,92,231,.4);
    }
    
    @media(max-width:768px){
      .sticky-cta-bar{padding:10px 16px;gap:10px}
      .sticky-cta-bar .headline{font-size:.9rem;max-width:200px}
      .sticky-cta-bar .cta-small{padding:8px 16px;font-size:.85rem}
    }

    /* ════════════════════════════════════════════════════════════════════
       MAIN WRAPPER
       ════════════════════════════════════════════════════════════════════ */
    .wrap{
      width:min(1100px,calc(100% - 40px));
      margin:110px auto 24px auto;
      position:relative;
    }

    /* ════════════════════════════════════════════════════════════════════
       HERO SECTION (A/B variants)
       ════════════════════════════════════════════════════════════════════ */
    .hero{
      position:relative;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      text-align:center;gap:16px;padding:40px 20px;margin:0 auto 40px;
      max-width:900px;
    }
    
    /* Parallax layers (subtle) */
    .hero::before{
      content:"";position:absolute;inset:-10%;
      background:radial-gradient(circle at 30% 40%,rgba(108,92,231,.08),transparent 60%);
      pointer-events:none;
      transform:translateZ(0);
      will-change:transform;
    }
    
    .hero-greeting{
      font-size:1rem;font-weight:600;color:#e0e0e0;
      opacity:0;
      animation:fadeInUp var(--dur-m) var(--ease) forwards;
    }
    
    .hero h1{
      font-size:clamp(2rem,5vw,3.2rem);line-height:1.1;margin:0;
      color:#fff;
      text-shadow:0 2px 8px rgba(0,0,0,.4);
      opacity:0;
      animation:fadeInUp var(--dur-m) var(--ease) forwards calc(var(--stagger) * 1);
    }
    
    /* Highlight "bilancio domestico" with animated gradient */
    .hero h1 .highlight-text{
      display:inline-block;
      background:linear-gradient(135deg,#a78bfa,#60efff,#c084fc,#22d3ee);
      background-size:200% 200%;
      -webkit-background-clip:text;background-clip:text;
      color:transparent;
      font-weight:900;
      animation:gradientShine 3s ease infinite;
      text-shadow:0 0 40px rgba(167,139,250,.3);
      filter:drop-shadow(0 0 20px rgba(96,239,255,.4));
    }
    
    @keyframes gradientShine{
      0%,100%{background-position:0% 50%}
      50%{background-position:100% 50%}
    }
    
    /* Rotating headline (3 variants) */
    .hero h1 .rotating-text{
      display:inline-block;
      background:var(--grad);
      -webkit-background-clip:text;background-clip:text;
      color:transparent;
      position:relative;
      min-width:200px;
      text-align:center;
    }
    
    .hero p{
      max-width:700px;margin:0;font-size:clamp(1rem,2.2vw,1.2rem);
      color:#e8e8e8;
      text-shadow:0 1px 4px rgba(0,0,0,.35);
      line-height:1.5;
      opacity:0;
      animation:fadeInUp var(--dur-m) var(--ease) forwards calc(var(--stagger) * 2);
    }
    
    .hero .cta-row{
      display:flex;gap:12px;flex-wrap:wrap;justify-content:center;
      opacity:0;
      animation:fadeInUp var(--dur-m) var(--ease) forwards calc(var(--stagger) * 3);
    }
    
    .cta{
      display:inline-block;padding:14px 24px;border-radius:12px;
      font-weight:800;text-decoration:none;font-size:1.05rem;
      background:var(--grad);color:#fff;
      box-shadow:0 10px 28px rgba(0,0,0,.2),0 0 0 0 rgba(108,92,231,.5);
      transition:transform var(--dur-s) var(--ease),
                 filter var(--dur-s) var(--ease),
                 box-shadow var(--dur-s) var(--ease);
      position:relative;
      overflow:hidden;
      animation:ctaPulse 2.5s ease-in-out infinite;
    }
    
    /* Animated glow effect */
    @keyframes ctaPulse{
      0%,100%{
        box-shadow:0 10px 28px rgba(0,0,0,.2),0 0 0 0 rgba(108,92,231,.5);
      }
      50%{
        box-shadow:0 10px 28px rgba(0,0,0,.2),0 0 30px 8px rgba(108,92,231,.3);
      }
    }
    
    /* Attention grabber - subtle wiggle after load */
    @keyframes ctaWiggle{
      0%,100%{transform:translateY(0) rotate(0deg)}
      25%{transform:translateY(-2px) rotate(-1deg)}
      75%{transform:translateY(-2px) rotate(1deg)}
    }
    
    .cta.loaded{
      animation:ctaPulse 2.5s ease-in-out infinite, ctaWiggle 0.6s ease 3s;
    }
    
    .cta::before{
      content:"";position:absolute;inset:0;
      background:linear-gradient(135deg,rgba(255,255,255,.2),transparent);
      opacity:0;
      transition:opacity var(--dur-s) var(--ease);
    }
    
    /* Sparkle effect on hover */
    .cta::after{
      content:"✨";position:absolute;
      top:50%;left:50%;
      transform:translate(-50%,-50%) scale(0);
      font-size:1.2rem;
      opacity:0;
      transition:all var(--dur-m) var(--ease);
      pointer-events:none;
    }
    
    .cta:hover{
      filter:brightness(1.15);
      transform:translateY(-4px) scale(1.03);
      box-shadow:0 18px 40px rgba(0,0,0,.3),0 0 40px 10px rgba(108,92,231,.4);
      animation:none;
    }
    .cta:hover::before{opacity:1}
    .cta:hover::after{
      transform:translate(-50%,-50%) scale(1.2);
      opacity:1;
    }
    
    /* Magnetic effect */
    .cta:active{
      transform:translateY(-2px) scale(0.98);
    }
    
    .cta-secondary{
      background:rgba(255,255,255,.15);
      backdrop-filter:blur(8px);
      -webkit-backdrop-filter:blur(8px);
      border:1px solid rgba(255,255,255,.2);
    }
    
    .trust-row{
      display:flex;gap:16px;align-items:center;justify-content:center;
      flex-wrap:wrap;font-size:.9rem;color:#d0d0d0;
      opacity:0;
      animation:fadeInUp var(--dur-m) var(--ease) forwards calc(var(--stagger) * 4);
    }
    .trust-row .trust-item{display:flex;align-items:center;gap:6px}
    .trust-row .trust-icon{font-size:1.1rem}
    
    .microcopy{
      font-size:.95rem;color:#e0e0e0;opacity:.92;margin-top:4px;
      opacity:0;
      animation:fadeInUp var(--dur-m) var(--ease) forwards calc(var(--stagger) * 5);
    }
    
    @keyframes fadeInUp{
      from{opacity:0;transform:translateY(20px)}
      to{opacity:1;transform:translateY(0)}
    }

    /* ════════════════════════════════════════════════════════════════════
       DEMO MOCKUP (screenshot with glass frame)
       ════════════════════════════════════════════════════════════════════ */
    .demo-section{
      margin:40px auto;max-width:800px;
      opacity:0;
      animation:fadeInUp var(--dur-l) var(--ease) forwards calc(var(--stagger) * 6);
    }
    
    .mockup-frame{
      position:relative;
      border-radius:16px;
      background:rgba(255,255,255,.12);
      backdrop-filter:saturate(1.1) blur(12px);
      -webkit-backdrop-filter:saturate(1.1) blur(12px);
      border:1px solid rgba(255,255,255,.18);
      padding:8px;
      box-shadow:0 20px 60px rgba(0,0,0,.3),
                 0 0 0 1px rgba(255,255,255,.08) inset;
      overflow:hidden;
    }
    
    .mockup-frame::before{
      content:"";position:absolute;inset:0;
      background:linear-gradient(135deg,rgba(255,255,255,.1),transparent);
      pointer-events:none;
    }
    
    .mockup-image{
      width:100%;height:auto;display:block;border-radius:12px;
      opacity:0;
      transition:opacity var(--dur-m) var(--ease);
    }
    .mockup-image.loaded{opacity:1}
    
    /* Skeleton shimmer (while loading) */
    .mockup-skeleton{
      width:100%;aspect-ratio:16/9;border-radius:12px;
      background:linear-gradient(90deg,
        rgba(255,255,255,.08) 0%,
        rgba(255,255,255,.15) 50%,
        rgba(255,255,255,.08) 100%);
      background-size:200% 100%;
      animation:shimmer 1.5s infinite;
    }
    .mockup-skeleton.hidden{display:none}
    
    @keyframes shimmer{
      0%{background-position:200% 0}
      100%{background-position:-200% 0}
    }

    /* ════════════════════════════════════════════════════════════════════
       VALUE PROP CARDS (3 benefits)
       ════════════════════════════════════════════════════════════════════ */
    .value-section{margin:50px auto;max-width:1100px}
    
    .section-title{
      text-align:center;font-size:1.8rem;font-weight:800;margin:0 0 32px;
      background:var(--grad);
      -webkit-background-clip:text;background-clip:text;
      color:transparent;
    }
    
    .value-grid{
      display:grid;gap:24px;
      grid-template-columns:repeat(3,1fr);
    }
    
    @media(max-width:900px){
      .value-grid{grid-template-columns:1fr}
    }
    
    @media(min-width:901px) and (max-width:1100px){
      .value-grid{gap:20px}
    }
    
    .value-card{
      background:rgba(255,255,255,.58);
      backdrop-filter:saturate(1.15) blur(10px);
      -webkit-backdrop-filter:saturate(1.15) blur(10px);
      border:1px solid rgba(0,0,0,.05);
      border-radius:20px;padding:28px 24px;
      box-shadow:0 12px 40px rgba(0,0,0,.08);
      text-align:center;
      transition:transform var(--dur-m) var(--ease),
                 box-shadow var(--dur-m) var(--ease),
                 background var(--dur-m) var(--ease),
                 border-color var(--dur-m) var(--ease);
      opacity:0;
      transform:translateY(30px) scale(.96);
      position:relative;
      overflow:hidden;
      will-change:transform;
    }
    
    /* Animated border gradient on hover */
    .value-card::before{
      content:"";position:absolute;inset:-2px;
      background:linear-gradient(135deg,#6c5ce7,#00cec9,#a78bfa,#60efff);
      background-size:200% 200%;
      border-radius:16px;
      opacity:0;
      transition:opacity var(--dur-m) var(--ease);
      z-index:-1;
      animation:borderGlow 3s ease infinite;
    }
    
    @keyframes borderGlow{
      0%,100%{background-position:0% 50%}
      50%{background-position:100% 50%}
    }
    
    .value-card.reveal-in{
      opacity:1;
      transform:translateY(0) scale(1);
    }
    .value-card:hover{
      transform:translateY(-12px) scale(1.04);
      box-shadow:0 24px 60px rgba(108,92,231,.22);
      background:rgba(255,255,255,.78);
      border-color:rgba(108,92,231,.15);
    }
    .value-card:hover::before{
      opacity:1;
    }
    .value-card:active{
      transform:translateY(-8px) scale(1.02);
    }
    
    /* Icon animation on hover */
    .value-card:hover .icon{
      animation:iconBounce 0.6s ease;
    }
    
    @keyframes iconBounce{
      0%,100%{transform:translateY(0) scale(1)}
      30%{transform:translateY(-8px) scale(1.1)}
      50%{transform:translateY(0) scale(1.05)}
      70%{transform:translateY(-4px) scale(1.08)}
    }
    
    .value-card .icon{
      width:56px;height:56px;margin:0 auto 16px;
      filter:drop-shadow(0 4px 12px rgba(0,0,0,.15));
    }
    
    .value-card h3{
      margin:0 0 10px;font-size:1.2rem;font-weight:800;color:#111;
    }
    .value-card p{
      margin:0;color:#333;font-size:1rem;line-height:1.5;
    }

    /* ════════════════════════════════════════════════════════════════════
       HOW-TO SECTION (timeline layout)
       ════════════════════════════════════════════════════════════════════ */
    .howto-section{
      margin:60px auto;max-width:1100px;
      position:relative;
    }
    
    .howto-timeline{
      display:flex;gap:24px;align-items:flex-start;
      position:relative;
    }
    
    /* Connector line (desktop) */
    .howto-timeline::before{
      content:"";position:absolute;top:32px;left:0;right:0;
      height:2px;
      background:linear-gradient(90deg,
        transparent 0%,
        rgba(108,92,231,.3) 20%,
        rgba(0,206,201,.3) 80%,
        transparent 100%);
      z-index:0;
    }
    
    .howto-step{
      flex:1;position:relative;z-index:1;
      background:rgba(255,255,255,.7);
      backdrop-filter:blur(6px);
      -webkit-backdrop-filter:blur(6px);
      border:1px solid rgba(0,0,0,.04);
      border-radius:16px;padding:20px;
      box-shadow:0 8px 24px rgba(0,0,0,.08);
      text-align:center;
      transition:transform var(--dur-m) var(--ease),
                 box-shadow var(--dur-m) var(--ease),
                 background var(--dur-m) var(--ease);
      opacity:0;
      transform:translateY(20px);
      cursor:pointer;
    }
    .howto-step.reveal-in{
      opacity:1;
      transform:translateY(0);
    }
    .howto-step:hover{
      transform:translateY(-6px) scale(1.02);
      box-shadow:0 16px 40px rgba(108,92,231,.15);
      background:rgba(255,255,255,.85);
    }
    
    /* Number animation on hover */
    .howto-step:hover .step-number{
      animation:numberPulse 0.6s ease;
    }
    
    @keyframes numberPulse{
      0%,100%{transform:scale(1) rotate(0deg)}
      25%{transform:scale(1.15) rotate(-5deg)}
      75%{transform:scale(1.15) rotate(5deg)}
    }
    
    .step-number{
      width:64px;height:64px;margin:0 auto 16px;
      border-radius:50%;
      background:var(--grad);
      display:flex;align-items:center;justify-content:center;
      font-size:1.8rem;font-weight:900;color:#fff;
      box-shadow:0 8px 20px rgba(0,0,0,.2);
      position:relative;
    }
    .step-number::after{
      content:"";position:absolute;inset:-6px;
      border-radius:50%;
      border:2px solid rgba(255,255,255,.3);
    }
    
    .howto-step .icon{
      width:48px;height:48px;margin:0 auto 12px;
      filter:drop-shadow(0 2px 8px rgba(0,0,0,.12));
    }
    
    .howto-step h4{
      margin:0 0 8px;font-size:1.15rem;font-weight:800;color:#111;
    }
    .howto-step p{
      margin:0;color:#2b2b2b;font-size:.95rem;line-height:1.45;
    }
    
    /* Mobile: vertical layout */
    @media(max-width:900px){
      .howto-timeline{flex-direction:column}
      .howto-timeline::before{
        top:0;bottom:0;left:32px;width:2px;height:auto;
        background:linear-gradient(180deg,
          transparent 0%,
          rgba(108,92,231,.3) 20%,
          rgba(0,206,201,.3) 80%,
          transparent 100%);
      }
    }

    /* ════════════════════════════════════════════════════════════════════
       PRICING TEASER (3 cards)
       ════════════════════════════════════════════════════════════════════ */
    .pricing-section{margin:60px auto;max-width:1100px}
    
    .pricing-grid{
      display:grid;gap:24px;
      grid-template-columns:repeat(3,1fr);
    }
    
    @media(max-width:900px){
      .pricing-grid{grid-template-columns:1fr}
    }
    
    @media(min-width:901px) and (max-width:1100px){
      .pricing-grid{gap:20px}
    }
    
    .price-card{
      position:relative;
      background:rgba(255,255,255,.6);
      backdrop-filter:saturate(1.15) blur(12px);
      -webkit-backdrop-filter:saturate(1.15) blur(12px);
      border:1px solid rgba(0,0,0,.05);
      border-radius:20px;padding:36px 24px 28px;
      box-shadow:0 12px 40px rgba(0,0,0,.08);
      display:flex;flex-direction:column;gap:16px;text-align:center;
      transition:transform var(--dur-m) var(--ease),
                 box-shadow var(--dur-m) var(--ease),
                 border-color var(--dur-m) var(--ease),
                 background var(--dur-m) var(--ease);
      opacity:0;
      transform:translateY(30px) scale(.96);
      cursor:pointer;
      will-change:transform;
    }
    .price-card.reveal-in{
      opacity:1;
      transform:translateY(0) scale(1);
    }
    .price-card:hover{
      transform:translateY(-12px) scale(1.03);
      box-shadow:0 24px 60px rgba(108,92,231,.18);
      background:rgba(255,255,255,.72);
      border-color:rgba(108,92,231,.18);
    }
    .price-card:active{
      transform:translateY(-8px) scale(1.01);
    }
    
    /* Pulse effect on price */
    .price-card:hover .price-inline{
      animation:pricePulse 0.6s ease;
    }
    
    @keyframes pricePulse{
      0%,100%{transform:scale(1)}
      50%{transform:scale(1.1)}
    }
    
    /* Popular card (Plus) - emphasized with gradient border */
    .price-card.popular{
      border:2px solid transparent;
      background:rgba(255,255,255,.72);
      background-image:linear-gradient(rgba(255,255,255,.72),rgba(255,255,255,.72)),var(--grad);
      background-origin:border-box;
      background-clip:padding-box,border-box;
      padding-top:52px;
      box-shadow:0 16px 48px rgba(108,92,231,.12);
    }
    .price-card.popular:hover{
      box-shadow:0 28px 70px rgba(108,92,231,.22);
      transform:translateY(-14px) scale(1.04);
    }
    
    .price-card .badge{
      position:absolute;top:-12px;left:50%;transform:translateX(-50%);
      padding:6px 16px;border-radius:999px;
      font-size:.85rem;font-weight:900;color:#fff;
      background:var(--grad);
      box-shadow:0 8px 20px rgba(0,0,0,.25);
      z-index:2;
    }
    
    .plan-title{
      margin:0;font-size:1.3rem;font-weight:800;color:#111;
      display:flex;flex-direction:column;gap:4px;align-items:center;
    }
    .plan-name{display:block}
    .price-inline{
      font-size:2rem;font-weight:900;
      background:var(--grad);
      -webkit-background-clip:text;background-clip:text;
      color:transparent;
    }
    .price-inline small{font-size:1rem;font-weight:600;color:#555}
    
    .features{
      margin:8px 0;color:#333;font-size:.95rem;line-height:1.6;
      flex:1;
    }
    .features ul{list-style:none;padding:0;margin:0}
    .features li{
      display:flex;gap:8px;align-items:flex-start;justify-content:center;
      padding:4px 0;
    }
    .features li::before{
      content:"✓";color:#2e7d32;font-weight:900;font-size:1.1rem;
    }
    
    .btn-secondary{
      display:inline-block;background:var(--grad);color:#fff;
      text-decoration:none;font-weight:800;border-radius:12px;padding:12px 20px;
      box-shadow:0 8px 22px rgba(0,0,0,.15);
      align-self:center;
      transition:transform var(--dur-s) var(--ease),
                 filter var(--dur-s) var(--ease),
                 box-shadow var(--dur-s) var(--ease);
      position:relative;
      overflow:hidden;
    }
    
    /* Shine effect on button */
    .btn-secondary::before{
      content:"";position:absolute;
      top:0;left:-100%;
      width:100%;height:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);
      transition:left var(--dur-l) var(--ease);
    }
    
    .btn-secondary:hover{
      filter:brightness(1.15);
      transform:translateY(-3px) scale(1.05);
      box-shadow:0 14px 32px rgba(0,0,0,.25);
    }
    .btn-secondary:hover::before{
      left:100%;
    }
    
    .btn-secondary:active{
      transform:translateY(-1px) scale(1.02);
    }
    
    .pricing-cta-final{
      margin-top:32px;text-align:center;
    }
    .pricing-cta-final .cta{font-size:1.1rem;padding:16px 32px}

    /* ════════════════════════════════════════════════════════════════════
       LEAD MAGNET (non-invasive)
       ════════════════════════════════════════════════════════════════════ */
    .lead-magnet{
      margin:50px auto;max-width:600px;
      background:rgba(255,255,255,.65);
      backdrop-filter:blur(10px);
      -webkit-backdrop-filter:blur(10px);
      border:1px solid rgba(0,0,0,.06);
      border-radius:16px;padding:24px;
      box-shadow:0 12px 36px rgba(0,0,0,.12);
      text-align:center;
      display:none;
    }
    .lead-magnet.visible{display:block}
    
    .lead-magnet h3{
      margin:0 0 12px;font-size:1.3rem;font-weight:800;color:#111;
    }
    .lead-magnet p{
      margin:0 0 16px;color:#333;font-size:1rem;line-height:1.5;
    }
    .lead-magnet form{
      display:flex;gap:8px;flex-wrap:wrap;justify-content:center;
    }
    .lead-magnet input{
      flex:1;min-width:200px;padding:10px 14px;border-radius:8px;
      border:1px solid rgba(0,0,0,.15);
      font-size:1rem;font-family:inherit;
    }
    .lead-magnet button{
      padding:10px 20px;border-radius:8px;border:none;
      background:var(--grad);color:#fff;font-weight:700;font-size:1rem;
      cursor:pointer;
      transition:transform var(--dur-s) var(--ease),filter var(--dur-s) var(--ease);
    }
    .lead-magnet button:hover{
      transform:translateY(-1px);
      filter:brightness(1.1);
    }
    .lead-magnet .privacy-note{
      margin-top:8px;font-size:.8rem;color:#666;
    }
    .lead-magnet .privacy-note a{color:#6c5ce7}

    /* ════════════════════════════════════════════════════════════════════
       EXIT INTENT MODAL
       ════════════════════════════════════════════════════════════════════ */
    .exit-modal{
      position:fixed;inset:0;z-index:200;
      display:none;align-items:center;justify-content:center;
      background:rgba(0,0,0,.6);
      backdrop-filter:blur(4px);
      -webkit-backdrop-filter:blur(4px);
      opacity:0;
      transition:opacity var(--dur-m) var(--ease);
    }
    .exit-modal.visible{
      display:flex;
      opacity:1;
    }
    
    .exit-modal-content{
      position:relative;max-width:500px;width:calc(100% - 40px);
      background:rgba(255,255,255,.95);
      backdrop-filter:blur(12px);
      -webkit-backdrop-filter:blur(12px);
      border-radius:20px;padding:32px;
      box-shadow:0 20px 60px rgba(0,0,0,.3);
      text-align:center;
      transform:scale(.95);
      transition:transform var(--dur-m) var(--ease);
    }
    .exit-modal.visible .exit-modal-content{transform:scale(1)}
    
    .exit-modal-close{
      position:absolute;top:12px;right:12px;
      width:32px;height:32px;border:none;background:none;
      font-size:1.5rem;color:#666;cursor:pointer;
      transition:color var(--dur-s) var(--ease);
    }
    .exit-modal-close:hover{color:#111}
    
    .exit-modal h3{
      margin:0 0 12px;font-size:1.5rem;font-weight:800;color:#111;
    }
    .exit-modal p{
      margin:0 0 20px;color:#333;font-size:1.05rem;line-height:1.5;
    }
    .exit-modal .cta{font-size:1.1rem;padding:14px 28px}

    /* ════════════════════════════════════════════════════════════════════
       FOOTER
       ════════════════════════════════════════════════════════════════════ */
    .footer{
      margin:60px 0 20px;text-align:center;color:#e6e6e6;font-size:.9rem;
      line-height:1.8;
    }
    .footer a{
      color:#fff;text-decoration:none;
      transition:color var(--dur-s) var(--ease);
    }
    .footer a:hover{color:#00cec9}

    /* ════════════════════════════════════════════════════════════════════
       REVEAL ANIMATION (IntersectionObserver)
       ════════════════════════════════════════════════════════════════════ */
    .reveal{
      opacity:0;
      transform:translateY(20px) scale(.98);
      transition:opacity var(--dur-l) var(--ease),
                 transform var(--dur-l) var(--ease);
    }
    .reveal.in{
      opacity:1;
      transform:translateY(0) scale(1);
    }
    
    @media (prefers-reduced-motion:reduce){
      .reveal,.reveal.in{
        transition:none;
        opacity:1;
        transform:none;
      }
    }

    /* ════════════════════════════════════════════════════════════════════
       RESPONSIVE
       ════════════════════════════════════════════════════════════════════ */
    @media(max-width:768px){
      .wrap{margin-top:90px}
      .hero{padding:30px 16px}
      .cta{padding:12px 20px;font-size:1rem}
      .section-title{font-size:1.5rem}
    }
  </style>
</head>
<body>
  <!-- ════════════════════════════════════════════════════════════════════
       TOPBAR
       ════════════════════════════════════════════════════════════════════ -->
  <nav class="topbar" aria-label="Barra superiore">
    <a href="/it/" class="logo-link" title="MyHomesBudget">
      <img src="/homes.png" alt="Logo MyHomesBudget" class="logo-image" loading="lazy" width="32" height="32">
      <span class="logo-text">MyHomesBudget</span>
    </a>
    <div class="top-actions">
      <!-- Dynamic: login-aware content injected here -->
      <a class="top-link" href="/it/login.html" id="login-link">Accedi</a>
      <a class="top-link" href="/it/pricing.html">Prezzi</a>
      <span class="lang-selector" aria-label="Selettore lingue">
        <a href="/it/" title="Italiano" lang="it">🇮🇹</a>
        <a href="/en/" title="English" lang="en">🇬🇧</a>
        <a href="/es/" title="Español" lang="es">🇪🇸</a>
      </span>
    </div>
  </nav>

  <!-- ════════════════════════════════════════════════════════════════════
       STICKY CTA BAR (appears on scroll - independent from topbar)
       ════════════════════════════════════════════════════════════════════ -->
  <div class="sticky-cta-bar" id="sticky-cta" aria-hidden="true">
    <div class="headline" id="sticky-headline">Inizia il tuo percorso verso un bilancio perfetto</div>
    <div class="actions">
      <a href="signup.html?plan=starter" class="cta-small" id="sticky-cta-btn">Inizia gratis ora</a>
    </div>
  </div>

  <main class="wrap">
    <!-- ════════════════════════════════════════════════════════════════════
         HERO SECTION
         ════════════════════════════════════════════════════════════════════ -->
    <section class="hero" id="hero">
      <div class="hero-greeting" id="greeting"><!-- Dynamic greeting --></div>
      
      <h1>
        <!-- HERO HEADLINE A -->
        Gestisci il tuo <span class="highlight-text">bilancio domestico</span> in modo <span class="rotating-text" id="rotating-text">semplice</span>
      </h1>
      
      <!-- HERO SUBHEADLINE -->
      <p>Inserisci le tue spese e le entrate in pochi click e tieni tutto sotto controllo.</p>

      <div class="cta-row">
        <a class="cta" href="signup.html?plan=starter" id="cta-hero-primary">
          Prova gratis per 30 giorni
        </a>
        <a class="cta cta-secondary" href="/it/pricing.html" id="cta-hero-secondary">
          Scopri i piani
        </a>
      </div>

      <div class="trust-row">
        <span class="trust-item"><span class="trust-icon">🇮🇹</span> Costruito in Italia</span>
        <span class="trust-item"><span class="trust-icon">🔒</span> Dati sicuri UE</span>
        <span class="trust-item"><span class="trust-icon">⚡</span> Veloce e affidabile</span>
      </div>

      <div class="microcopy" aria-hidden="true">Nessuna carta di credito richiesta. Cancella quando vuoi.</div>
    </section>

    <!-- ════════════════════════════════════════════════════════════════════
         DEMO MOCKUP
         ════════════════════════════════════════════════════════════════════ -->
    <section class="demo-section" aria-label="Anteprima dashboard">
      <div class="mockup-frame">
        <div class="mockup-skeleton" id="mockup-skeleton"></div>
        <img 
          src="/social.png" 
          alt="Anteprima dashboard MyHomesBudget" 
          class="mockup-image" 
          id="mockup-image"
          loading="lazy"
          width="1200"
          height="675"
          decoding="async"
        >
      </div>
    </section>

    <!-- ════════════════════════════════════════════════════════════════════
         VALUE PROPOSITION (3 cards)
         ════════════════════════════════════════════════════════════════════ -->
    <section class="value-section" aria-label="Benefici principali">
      <h2 class="section-title"><!-- VALUE PROP TITLE -->Perché scegliere MyHomesBudget</h2>
      
      <div class="value-grid">
        <article class="value-card reveal">
          <svg class="icon" viewBox="0 0 24 24" role="img" aria-hidden="true">
            <defs>
              <linearGradient id="grad-1" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#6c5ce7"/>
                <stop offset="1" stop-color="#00cec9"/>
              </linearGradient>
            </defs>
            <path d="M12 2L2 7v10c0 5.5 3.8 9.7 10 11 6.2-1.3 10-5.5 10-11V7l-10-5z" fill="url(#grad-1)"/>
            <path d="M9 12l2 2 4-4" stroke="#fff" stroke-width="2" fill="none" stroke-linecap="round"/>
          </svg>
          <h3>Zero complicazioni</h3>
          <!-- VALUE PROP 1 -->
          <p>Niente fogli di calcolo. Tutto chiaro e rapido.</p>
        </article>

        <article class="value-card reveal">
          <svg class="icon" viewBox="0 0 24 24" role="img" aria-hidden="true">
            <defs>
              <linearGradient id="grad-2" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#6c5ce7"/>
                <stop offset="1" stop-color="#00cec9"/>
              </linearGradient>
            </defs>
            <rect x="3" y="4" width="18" height="16" rx="2" fill="url(#grad-2)"/>
            <circle cx="12" cy="12" r="3" fill="#fff"/>
            <path d="M16 2v4M8 2v4" stroke="url(#grad-2)" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <h3>Sempre con te</h3>
          <!-- VALUE PROP 2 -->
          <p>iPhone, Android e PC. Presto installabile come PWA.</p>
        </article>

        <article class="value-card reveal">
          <svg class="icon" viewBox="0 0 24 24" role="img" aria-hidden="true">
            <defs>
              <linearGradient id="grad-3" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#6c5ce7"/>
                <stop offset="1" stop-color="#00cec9"/>
              </linearGradient>
            </defs>
            <circle cx="12" cy="12" r="10" fill="url(#grad-3)"/>
            <path d="M7 12l3 3 7-7" stroke="#fff" stroke-width="2" fill="none" stroke-linecap="round"/>
          </svg>
          <h3>Privacy UE</h3>
          <!-- VALUE PROP 3 -->
          <p>Dati in Europa e sotto il tuo controllo.</p>
        </article>
      </div>
    </section>

    <!-- ════════════════════════════════════════════════════════════════════
         HOW-TO SECTION (timeline)
         ════════════════════════════════════════════════════════════════════ -->
    <section class="howto-section" aria-label="Come funziona">
      <h2 class="section-title"><!-- HOWTO TITLE -->Inizia in 3 semplici passi</h2>
      
      <div class="howto-timeline">
        <article class="howto-step reveal">
          <div class="step-number" aria-hidden="true">1</div>
          <svg class="icon" viewBox="0 0 24 24" role="img" aria-hidden="true">
            <defs>
              <linearGradient id="grad-user" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#6c5ce7"/>
                <stop offset="1" stop-color="#00cec9"/>
              </linearGradient>
            </defs>
            <circle cx="12" cy="8" r="4" fill="url(#grad-user)"/>
            <path d="M4 20c0-4 4-7 8-7s8 3 8 7" fill="none" stroke="url(#grad-user)" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <h4>Crea il tuo account</h4>
          <!-- STEP 1 TEXT -->
          <p>Registrati gratis in 30 secondi con la tua email o account Google.</p>
        </article>

        <article class="howto-step reveal">
          <div class="step-number" aria-hidden="true">2</div>
          <svg class="icon" viewBox="0 0 24 24" role="img" aria-hidden="true">
            <defs>
              <linearGradient id="grad-plus" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#6c5ce7"/>
                <stop offset="1" stop-color="#00cec9"/>
              </linearGradient>
            </defs>
            <path d="M12 5v14M5 12h14" stroke="url(#grad-plus)" stroke-width="3" stroke-linecap="round"/>
          </svg>
          <h4>Aggiungi le operazioni</h4>
          <!-- STEP 2 TEXT -->
          <p>Inserisci entrate e uscite con categorie personalizzate in pochi click.</p>
        </article>

        <article class="howto-step reveal">
          <div class="step-number" aria-hidden="true">3</div>
          <svg class="icon" viewBox="0 0 24 24" role="img" aria-hidden="true">
            <defs>
              <linearGradient id="grad-chart" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#6c5ce7"/>
                <stop offset="1" stop-color="#00cec9"/>
              </linearGradient>
            </defs>
            <polyline points="3,15 7,11 11,13 15,7 21,9" fill="none" stroke="url(#grad-chart)" stroke-width="2" stroke-linecap="round"/>
            <circle cx="3" cy="15" r="2" fill="url(#grad-chart)"/>
            <circle cx="7" cy="11" r="2" fill="url(#grad-chart)"/>
            <circle cx="11" cy="13" r="2" fill="url(#grad-chart)"/>
            <circle cx="15" cy="7" r="2" fill="url(#grad-chart)"/>
            <circle cx="21" cy="9" r="2" fill="url(#grad-chart)"/>
          </svg>
          <h4>Monitora i tuoi progressi</h4>
          <!-- STEP 3 TEXT -->
          <p>Visualizza grafici chiari e raggiungi i tuoi obiettivi finanziari.</p>
        </article>
      </div>
    </section>

    <!-- ════════════════════════════════════════════════════════════════════
         PRICING TEASER
         ════════════════════════════════════════════════════════════════════ -->
    <section class="pricing-section" aria-label="Piani tariffari">
      <h2 class="section-title"><!-- PRICING TITLE -->Scegli il piano perfetto per te</h2>
      
      <div class="pricing-grid">
        <!-- Starter -->
        <article class="price-card reveal">
          <div class="plan-title">
            <span class="plan-name">Starter</span>
            <div class="price-inline">
              Gratis <small>/mese</small>
            </div>
          </div>
          <div class="features">
            <ul>
              <li>1 utente</li>
              <li>Budget base</li>
              <li>Storico 6 mesi</li>
            </ul>
          </div>
          <a href="signup.html?plan=starter" class="btn-secondary">Inizia gratis</a>
        </article>

        <!-- Plus (Popular) -->
        <article class="price-card popular reveal">
          <span class="badge">Più scelto</span>
          <div class="plan-title">
            <span class="plan-name">Plus</span>
            <div class="price-inline">
              €6 <small>/mese</small>
            </div>
          </div>
          <div class="features">
            <ul>
              <li>Fino a 5 utenti</li>
              <li>Budget avanzato</li>
              <li>Storico illimitato</li>
              <li>Grafici avanzati</li>
            </ul>
          </div>
          <a href="/it/paywall.html?plan=plus" class="btn-secondary">Scegli Plus</a>
        </article>

        <!-- Pro -->
        <article class="price-card reveal">
          <div class="plan-title">
            <span class="plan-name">Pro</span>
            <div class="price-inline">
              €10 <small>/mese</small>
            </div>
          </div>
          <div class="features">
            <ul>
              <li>Utenti illimitati</li>
              <li>Budget completo</li>
              <li>Storico illimitato</li>
              <li>Report personalizzati</li>
              <li>Supporto prioritario</li>
            </ul>
          </div>
          <a href="/it/paywall.html?plan=pro" class="btn-secondary">Scegli Pro</a>
        </article>
      </div>

      <div class="pricing-cta-final">
        <a class="cta" href="/it/pricing.html">Confronta tutti i piani</a>
      </div>
    </section>

    <!-- ════════════════════════════════════════════════════════════════════
         LEAD MAGNET (optional, non-invasive)
         ════════════════════════════════════════════════════════════════════ -->
    <aside class="lead-magnet" id="lead-magnet" aria-labelledby="lead-title">
      <h3 id="lead-title">🎁 Budget Starter Kit Gratuito</h3>
      <p>Ricevi la nostra guida PDF con consigli pratici per iniziare a gestire il tuo budget oggi stesso.</p>
      <form id="lead-form" action="#">
        <input 
          type="email" 
          placeholder="La tua email" 
          required 
          aria-label="Email per ricevere il kit gratuito"
          id="lead-email"
        >
        <button type="submit">Invia</button>
      </form>
      <p class="privacy-note">
        Rispettiamo la tua privacy. 
        <a href="/it/privacy.html">Leggi la nostra policy</a>
      </p>
    </aside>
  </main>

  <!-- ════════════════════════════════════════════════════════════════════
       FOOTER
       ════════════════════════════════════════════════════════════════════ -->
  <footer class="footer">
    <p>
      © 2025 MyHomesBudget. Tutti i diritti riservati.<br>
      <a href="/it/pricing.html">Prezzi</a> · 
      <a href="/it/privacy.html">Privacy</a> · 
      <a href="/it/terms.html">Termini</a>
    </p>
  </footer>

  <!-- ════════════════════════════════════════════════════════════════════
       EXIT INTENT MODAL
       ════════════════════════════════════════════════════════════════════ -->
  <div class="exit-modal" id="exit-modal" role="dialog" aria-modal="true" aria-labelledby="exit-title">
    <div class="exit-modal-content">
      <button class="exit-modal-close" id="exit-close" aria-label="Chiudi">×</button>
      <h3 id="exit-title">✋ Aspetta un momento!</h3>
      <p>Non perdere l'opportunità di provare MyHomesBudget gratis per 30 giorni. Nessuna carta richiesta.</p>
      <a href="signup.html?plan=starter" class="cta" id="exit-cta">Prova ora gratis</a>
    </div>
  </div>

  <!-- ════════════════════════════════════════════════════════════════════
       JAVASCRIPT ORCHESTRATOR
       ════════════════════════════════════════════════════════════════════ -->
  <script>
    (function(){
      'use strict';

      // ════════════════════════════════════════════════════════════════
      // UTILITY: Safe GA4 tracking
      // ════════════════════════════════════════════════════════════════
      function track(event, params){
        if(typeof gtag === 'function'){
          gtag('event', event, params);
        }
      }

      // ════════════════════════════════════════════════════════════════
      // UTILITY: Check for reduced motion
      // ════════════════════════════════════════════════════════════════
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      // ════════════════════════════════════════════════════════════════
      // 1) LOGIN AWARENESS + LOGOUT
      // ════════════════════════════════════════════════════════════════
      function initLoginAwareness(){
        const loginLink = document.getElementById('login-link');
        if(!loginLink) return;

        let user = null;
        let userName = '';

        // Check mhb_user (custom storage)
        try{
          const stored = localStorage.getItem('mhb_user');
          if(stored){
            user = JSON.parse(stored);
            userName = user.name || user.email || 'Utente';
          }
        }catch(e){}

        // Check Supabase session
        if(!user){
          try{
            for(let key in localStorage){
              if(key.includes('supabase.auth.token')){
                const token = localStorage.getItem(key);
                if(token){
                  try{
                    const parsed = JSON.parse(token);
                    if(parsed && parsed.user){
                      userName = parsed.user.user_metadata?.full_name || parsed.user.email || 'Utente';
                      user = parsed.user;
                      break;
                    }
                  }catch(e){}
                }
              }
            }
          }catch(e){}
        }

        if(user && userName){
          // User is logged in
          loginLink.outerHTML = `
            <span class="user-greeting">Ciao, ${userName}</span>
            <button class="logout-btn" id="logout-btn">Esci</button>
          `;

          const logoutBtn = document.getElementById('logout-btn');
          if(logoutBtn){
            logoutBtn.addEventListener('click', function(){
              // Clear mhb_user
              try{
                localStorage.removeItem('mhb_user');
              }catch(e){}

              // Clear Supabase session keys
              try{
                for(let key in localStorage){
                  if(key.includes('supabase')){
                    localStorage.removeItem(key);
                  }
                }
              }catch(e){}

              track('logout', {lang:'it'});
              location.href = '/it/login.html';
            });
          }
        }
      }

      // ════════════════════════════════════════════════════════════════
      // 2) DYNAMIC GREETING (time-based)
      // ════════════════════════════════════════════════════════════════
      function initGreeting(){
        const greetingEl = document.getElementById('greeting');
        if(!greetingEl) return;

        const hour = new Date().getHours();
        let greeting = 'Buongiorno';
        if(hour >= 12 && hour < 18) greeting = 'Buon pomeriggio';
        else if(hour >= 18) greeting = 'Buonasera';

        greetingEl.textContent = greeting + '! 👋';
      }

      // ════════════════════════════════════════════════════════════════
      // 3) ROTATING HEADLINE (3 variants)
      // ════════════════════════════════════════════════════════════════
      function initRotatingHeadline(){
        if(prefersReducedMotion) return;

        const rotatingEl = document.getElementById('rotating-text');
        if(!rotatingEl) return;

        const variants = ['semplice', 'intuitivo', 'efficace'];
        let currentIndex = 0;

        function rotate(){
          currentIndex = (currentIndex + 1) % variants.length;
          rotatingEl.style.opacity = '0';
          setTimeout(() => {
            rotatingEl.textContent = variants[currentIndex];
            rotatingEl.style.opacity = '1';
          }, 300);
        }

        rotatingEl.style.transition = 'opacity 0.3s ease';
        setInterval(rotate, 6000);

        // Pause on hover
        rotatingEl.addEventListener('mouseenter', () => {
          clearInterval(rotate);
        });
      }

      // ════════════════════════════════════════════════════════════════
      // 4) PARALLAX (subtle, hero only, desktop only)
      // ════════════════════════════════════════════════════════════════
      function initParallax(){
        if(prefersReducedMotion || window.innerWidth < 768) return;

        const hero = document.getElementById('hero');
        if(!hero) return;

        let ticking = false;

        function updateParallax(){
          const scrollY = window.pageYOffset;
          const offset = scrollY * 0.15; // subtle
          hero.style.transform = `translateY(${offset}px)`;
          ticking = false;
        }

        window.addEventListener('scroll', () => {
          if(!ticking){
            requestAnimationFrame(updateParallax);
            ticking = true;
          }
        });
      }

      // ════════════════════════════════════════════════════════════════
      // 5) MOCKUP IMAGE LOADER (skeleton shimmer)
      // ════════════════════════════════════════════════════════════════
      function initMockupLoader(){
        const skeleton = document.getElementById('mockup-skeleton');
        const img = document.getElementById('mockup-image');
        if(!skeleton || !img) return;

        img.addEventListener('load', () => {
          skeleton.classList.add('hidden');
          img.classList.add('loaded');
        });

        if(img.complete){
          skeleton.classList.add('hidden');
          img.classList.add('loaded');
        }
      }

      // ════════════════════════════════════════════════════════════════
      // 6) REVEAL ANIMATION (IntersectionObserver with intelligent stagger)
      // ════════════════════════════════════════════════════════════════
      function initReveal(){
        if(prefersReducedMotion) return;

        const reveals = document.querySelectorAll('.reveal');
        if(!reveals.length) return;

        // Group elements by section for better stagger control
        const sections = {};
        reveals.forEach(el => {
          const section = el.closest('section');
          const sectionId = section?.id || section?.className || 'default';
          if(!sections[sectionId]) sections[sectionId] = [];
          sections[sectionId].push(el);
        });

        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if(entry.isIntersecting){
              const section = entry.target.closest('section');
              const sectionId = section?.id || section?.className || 'default';
              const items = sections[sectionId] || [entry.target];
              const index = items.indexOf(entry.target);
              
              setTimeout(() => {
                entry.target.classList.add('reveal-in');
              }, index * 120); // smoother stagger
              
              observer.unobserve(entry.target);
            }
          });
        }, {
          threshold: 0.15,
          rootMargin: '0px 0px -80px 0px'
        });

        reveals.forEach(el => observer.observe(el));
      }

      // ════════════════════════════════════════════════════════════════
      // 7) STICKY CTA BAR (appears on scroll >35%, hides when scrolling up)
      // ════════════════════════════════════════════════════════════════
      function initStickyCTA(){
        const stickyBar = document.getElementById('sticky-cta');
        if(!stickyBar) return;

        let ticking = false;
        let lastScrollY = 0;
        let isVisible = false;

        function updateSticky(){
          const scrollY = window.pageYOffset;
          const docHeight = document.documentElement.scrollHeight - window.innerHeight;
          const scrollPercent = (scrollY / docHeight) * 100;
          const scrollingDown = scrollY > lastScrollY;

          // Show when scrolling down past 35% of page
          if(scrollPercent > 35 && scrollingDown && !isVisible){
            stickyBar.classList.add('visible');
            stickyBar.setAttribute('aria-hidden', 'false');
            isVisible = true;
          } 
          // Hide when scrolling up OR at top of page
          else if((scrollPercent < 15 || !scrollingDown) && isVisible){
            stickyBar.classList.remove('visible');
            stickyBar.setAttribute('aria-hidden', 'true');
            isVisible = false;
          }

          lastScrollY = scrollY;
          ticking = false;
        }

        window.addEventListener('scroll', () => {
          if(!ticking){
            requestAnimationFrame(updateSticky);
            ticking = true;
          }
        });

        // Track clicks
        const stickyBtn = document.getElementById('sticky-cta-btn');
        if(stickyBtn){
          stickyBtn.addEventListener('click', () => {
            track('cta_sticky_click', {lang:'it'});
          });
        }
      }

      // ════════════════════════════════════════════════════════════════
      // 8) LEAD MAGNET (frequency cap via localStorage)
      // ════════════════════════════════════════════════════════════════
      function initLeadMagnet(){
        const leadBox = document.getElementById('lead-magnet');
        if(!leadBox) return;

        // Check if user is logged in
        let isLoggedIn = false;
        try{
          if(localStorage.getItem('mhb_user')){
            isLoggedIn = true;
          }
          for(let key in localStorage){
            if(key.includes('supabase.auth.token')){
              isLoggedIn = true;
              break;
            }
          }
        }catch(e){}

        if(isLoggedIn){
          return; // Don't show for logged-in users
        }

        // Check frequency cap
        try{
          const dismissed = localStorage.getItem('lead_magnet_dismissed');
          if(dismissed){
            return;
          }
        }catch(e){}

        // Show lead magnet
        leadBox.classList.add('visible');

        // Handle form submission
        const form = document.getElementById('lead-form');
        if(form){
          form.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('lead-email').value;
            
            track('lead_submit', {lang:'it', email_domain: email.split('@')[1]});
            
            alert('Grazie! Ti invieremo il Budget Starter Kit a breve.');
            
            try{
              localStorage.setItem('lead_magnet_dismissed', '1');
            }catch(e){}
            
            leadBox.style.display = 'none';
          });
        }
      }

      // ════════════════════════════════════════════════════════════════
      // 9) EXIT INTENT MODAL (desktop only, once per session)
      // ════════════════════════════════════════════════════════════════
      function initExitIntent(){
        if(window.innerWidth < 768 || prefersReducedMotion) return;

        const modal = document.getElementById('exit-modal');
        const closeBtn = document.getElementById('exit-close');
        const exitCTA = document.getElementById('exit-cta');
        if(!modal) return;

        // Check if already shown this session
        if(sessionStorage.getItem('exit_intent_shown')) return;

        // Check if user is logged in
        let isLoggedIn = false;
        try{
          if(localStorage.getItem('mhb_user')){
            isLoggedIn = true;
          }
          for(let key in localStorage){
            if(key.includes('supabase.auth.token')){
              isLoggedIn = true;
              break;
            }
          }
        }catch(e){}

        if(isLoggedIn) return;

        function showModal(){
          modal.classList.add('visible');
          sessionStorage.setItem('exit_intent_shown', '1');
          track('exit_intent_open', {lang:'it'});

          // Focus management
          exitCTA.focus();
        }

        function hideModal(){
          modal.classList.remove('visible');
        }

        // Detect exit intent (mouse leaving viewport at top)
        document.addEventListener('mouseout', (e) => {
          if(!e.relatedTarget && e.clientY < 10){
            showModal();
          }
        });

        // Close handlers
        if(closeBtn){
          closeBtn.addEventListener('click', hideModal);
        }

        modal.addEventListener('click', (e) => {
          if(e.target === modal){
            hideModal();
          }
        });

        // Escape key
        document.addEventListener('keydown', (e) => {
          if(e.key === 'Escape' && modal.classList.contains('visible')){
            hideModal();
          }
        });

        // Track CTA click
        if(exitCTA){
          exitCTA.addEventListener('click', () => {
            track('exit_intent_cta_click', {lang:'it'});
          });
        }
      }

      // ════════════════════════════════════════════════════════════════
      // 10) CTA TRACKING (hero CTAs)
      // ════════════════════════════════════════════════════════════════
      function initCTATracking(){
        const params = new URLSearchParams(location.search);
        const variant = params.get('v') || '1';

        const heroPrimary = document.getElementById('cta-hero-primary');
        const heroSecondary = document.getElementById('cta-hero-secondary');

        if(heroPrimary){
          heroPrimary.addEventListener('click', () => {
            track('cta_hero_click', {lang:'it', variant: 'v' + variant, type:'primary'});
          });
        }

        if(heroSecondary){
          heroSecondary.addEventListener('click', () => {
            track('cta_hero_click', {lang:'it', variant: 'v' + variant, type:'secondary'});
          });
        }
      }

      // ════════════════════════════════════════════════════════════════
      // 11) ADD LOADED CLASS TO CTAS FOR WIGGLE ANIMATION
      // ════════════════════════════════════════════════════════════════
      function initCTAAnimations(){
        setTimeout(() => {
          const ctas = document.querySelectorAll('.cta');
          ctas.forEach((cta, index) => {
            setTimeout(() => {
              cta.classList.add('loaded');
            }, index * 200);
          });
        }, 2000); // Start wiggle 2s after page load
      }

      // ════════════════════════════════════════════════════════════════
      // INIT ALL
      // ════════════════════════════════════════════════════════════════
      document.addEventListener('DOMContentLoaded', () => {
        initLoginAwareness();
        initGreeting();
        initRotatingHeadline();
        initParallax();
        initMockupLoader();
        initReveal();
        initStickyCTA();
        initLeadMagnet();
        initExitIntent();
        initCTATracking();
        initCTAAnimations();

        // Track page view
        track('page_view', {page_title: document.title, lang:'it'});
      });
    })();
  </script>
</body>
</html>
