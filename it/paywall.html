<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fine Periodo di Prova — MyHomesBudget</title>
  <meta name="description" content="Il tuo periodo di prova è terminato. Scegli un piano per continuare a usare MyHomesBudget senza limiti.">
  <meta name="robots" content="noindex, nofollow"> <!-- Generalmente le paywall non si indicizzano -->

  <!-- CSP -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src 'self' https: data:;
                 style-src 'self' 'unsafe-inline';
                 script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com;
                 connect-src 'self' https://www.google-analytics.com https://region1.google-analytics.com;
                 font-src 'self' https: data:;
                 frame-ancestors 'none';
                 base-uri 'self';
                 form-action 'self'">

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LSD3V9G_DUMMY"></script> <!-- Sostituisci con il tuo ID -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-LSD3V9G_DUMMY', { anonymize_ip: true });
  </script>

  <!-- Performance -->
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
  <link rel="preconnect" href="https://www.google-analytics.com" crossorigin>
  <link rel="icon" href="/favicon.ico">
  <meta name="theme-color" content="#0f0f10">
  <meta name="color-scheme" content="light dark">

  <style>
    /* === STILI BASE E COMUNI === */
    :root{font-family:-apple-system,system-ui,"Segoe UI",Roboto,sans-serif}
    *{box-sizing:border-box}
    a:focus-visible, button:focus-visible{outline:2px solid #00cec9; outline-offset:2px; border-radius:6px}

    body{
      margin:0;padding:0;color:#fff;
      background:url("/bg.webp") no-repeat center center fixed;
      background-size:cover;
      display:flex;
      flex-direction:column;
      min-height:100vh;
    }
    body::before{content:"";position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:-1}
    h1,h2,h3,h4{text-shadow:0 1px 3px rgba(0,0,0,.4)}

    /* === PAYWALL LAYOUT === */
    .paywall-wrapper {
      flex-grow: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    .paywall-panel{
      width: 100%;
      max-width: 720px;
      background:rgba(255,255,255,0.7);
      backdrop-filter:saturate(1.2) blur(8px);
      -webkit-backdrop-filter:saturate(1.2) blur(5px);
      color:#111;border-radius:16px;padding:clamp(1.2rem, 5vw, 2rem);
      box-shadow:0 10px 40px rgba(0,0,0,.15);
      text-align: center;
    }
    .paywall-panel h1 { font-size: clamp(1.8rem, 5vw, 2.2rem); margin: 0 0 8px; }
    .paywall-panel .copy { font-size: clamp(1rem, 2.5vw, 1.1rem); max-width: 500px; margin: 0 auto 24px; color: #333; }

    /* === PIANI E PREZZI === */
    .pricing-grid{display:grid;gap:16px;grid-template-columns:1fr 1fr; margin-bottom: 24px;}
    @media(max-width:600px){.pricing-grid{grid-template-columns:1fr}}
    .price-card{
      background:rgba(255,255,255,.45);
      border:1px solid rgba(255,255,255,0.6);
      padding:18px;border-radius:12px;
      display:flex;flex-direction:column;gap:16px;text-align:center;
    }
    .price-card .plan-title{
      margin: 0; display: flex; gap: .5rem; flex-wrap: wrap; align-items: baseline; justify-content: center;
      font-size: 1.1rem;
    }
    .price-card .plan-title .plan-name{ font-weight: 700; }
    .price-card .plan-title .sep{ opacity: .45; }
    .price-card .plan-title .price-inline{font-weight: 800; font-size: 1.2rem; line-height: 1;}
    .price-card .plan-title .price-inline small{font-weight: 600; font-size: .9rem; color: #333;}
    
    .cta-group { display: flex; flex-direction: column; gap: 8px; }
    .btn-payment{
      display:flex; align-items:center; justify-content:center; gap: 8px;
      text-decoration:none;font-weight:700;border-radius:10px;padding:10px 14px;
      box-shadow:0 6px 18px rgba(0,0,0,.1);
      transition: transform .15s ease, filter .15s ease;
      border: none; cursor: pointer; font-size: 0.95rem;
    }
    .btn-payment:hover{filter:brightness(1.08); transform: translateY(-1px);}
    .btn-stripe { background: #635bff; color: white; }
    .btn-paypal { background: #ffc439; color: #003087; }

    /* === FAQ SINTETICA === */
    .faq-condensed { text-align: left; margin-bottom: 24px; }
    .faq-condensed h3 { text-align: center; margin: 0 0 12px; }
    .faq-item { font-size: 0.95rem; padding: 8px 0; border-bottom: 1px solid rgba(0,0,0,.08); }
    .faq-item:last-child { border-bottom: none; }
    .faq-item strong { color: #111; }
    .faq-item p { margin: 4px 0 0; color: #444; }

    /* === LOGIN PROMPT === */
    .login-prompt {
      margin-top: 16px; padding: 12px;
      background: rgba(0,0,0,.05); border-radius: 8px;
      font-size: 0.9rem;
    }
    .login-prompt a { color: #6c5ce7; font-weight: 600; }

    /* === ANIMAZIONI REVEAL ON SCROLL === */
    .reveal{
      opacity: 0; transform: translateY(16px);
      transition: opacity .8s ease, transform .8s cubic-bezier(.22,1,.36,1);
    }
    .reveal.in{ opacity:1; transform:none; }
    @media (prefers-reduced-motion: reduce){
      .reveal, .reveal.in{ transition:none; opacity:1; transform:none; }
    }
  </style>

</head>
<body>

  <div class="paywall-wrapper">
    <!-- Per uso modale, questo pannello dovrebbe avere role="dialog" e aria-modal="true" -->
    <main class="paywall-panel" role="document" aria-labelledby="paywall-title">
      
      <h1 id="paywall-title" class="reveal">Il tuo periodo di prova è terminato</h1>
      <p class="copy reveal">Continua a usare MyHomesBudget senza limiti scegliendo un piano.</p>

      <!-- PIANI DI PAGAMENTO -->
      <div class="pricing-grid">
        <div class="price-card reveal">
          <h2 class="plan-title">
            <span class="plan-name">Piano Mensile</span>
            <span class="sep">—</span>
            <span class="price-inline">2,99€ <small>/ mese</small></span>
          </h2>
          <div class="cta-group">
            <a href="#stripe-checkout" class="btn-payment btn-stripe" data-plan="monthly">Paga con Stripe</a>
            <a href="#paypal-checkout" class="btn-payment btn-paypal" data-plan="monthly">Paga con PayPal</a>
          </div>
        </div>
        <div class="price-card reveal">
          <h2 class="plan-title">
            <span class="plan-name">Una Tantum</span>
            <span class="sep">—</span>
            <span class="price-inline">19,99€ <small>/ per sempre</small></span>
          </h2>
          <div class="cta-group">
            <a href="#stripe-checkout" class="btn-payment btn-stripe" data-plan="lifetime">Paga con Stripe</a>
            <a href="#paypal-checkout" class="btn-payment btn-paypal" data-plan="lifetime">Paga con PayPal</a>
          </div>
        </div>
      </div>

      <!-- FAQ CONDENSATA -->
      <section class="faq-condensed reveal" aria-labelledby="faq-title">
        <h3 id="faq-title">Domande rapide</h3>
        <div class="faq-item">
          <strong>Cosa succede ai dati che ho inserito?</strong>
          <p>I tuoi dati sono al sicuro e verranno sbloccati non appena attivi un piano. Non cancelliamo nulla.</p>
        </div>
        <div class="faq-item">
          <strong>Quali metodi di pagamento accettate?</strong>
          <p>Accettiamo tutte le principali carte di credito tramite Stripe e pagamenti sicuri con il tuo conto PayPal.</p>
        </div>
        <div class="faq-item">
          <strong>Posso cancellare il piano mensile quando voglio?</strong>
          <p>Sì, puoi cancellare il tuo abbonamento in qualsiasi momento senza costi aggiuntivi.</p>
        </div>
      </section>

      <!-- PROMPT DI LOGIN -->
      <div class="login-prompt reveal">
        Hai già un abbonamento? <a href="login.html">Accedi qui</a>
      </div>

    </main>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // === EVENTO GA4: PAYWALL VIEW ===
  gtag('event', 'paywall_viewed');

  // === EVENTI GA4: INIZIO CHECKOUT ===
  document.querySelectorAll('a[data-plan]').forEach(link => {
    link.addEventListener('click', (e) => {
      // e.preventDefault(); // Decommenta se gestisci il redirect via JS
      gtag('event', 'checkout_started', { plan: link.dataset.plan });

      // Esempio di evento MOCK per acquisto completato
      // setTimeout(() => {
      //   gtag('event', 'subscription_purchased', { plan: link.dataset.plan });
      //   console.log(`Simulazione acquisto completato per piano: ${link.dataset.plan}`);
      // }, 2000);
    });
  });

  // === ANIMAZIONE REVEAL ===
  const targets = document.querySelectorAll('.reveal');
  if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
    targets.forEach(el => el.classList.add('in'));
    return;
  }
  
  targets.forEach((el, i) => {
    el.style.transitionDelay = (i * 0.1) + 's';
  });
  
  // Breve ritardo per permettere il rendering prima di animare
  setTimeout(() => {
    targets.forEach(el => el.classList.add('in'));
  }, 100);
});


/*
// =========================================================================
// === SNIPPET PER RIUTILIZZO COME MODALE (DA DECOMMENTARE E ADATTARE) ===
// =========================================================================
// Per usare questo paywall come modale:
// 1. Sposta il .paywall-wrapper dentro il body della tua pagina principale.
// 2. Dagli un ID (es. id="paywallModal") e l'attributo `hidden`.
// 3. Cambia role="document" del .paywall-panel in role="dialog" e aggiungi aria-modal="true".
// 4. Includi gli stili per l'overlay (es. .modal-overlay { ... }).
// 5. Usa le funzioni sottostanti per controllarlo.

const paywallModal = document.getElementById('paywallModal');
const paywallPanel = paywallModal ? paywallModal.querySelector('[role="dialog"]') : null;
const focusableElementsString = 'a[href], button:not([disabled])';
let focusableElements, firstFocusableEl, lastFocusableEl, previouslyFocusedEl;

function openPaywall() {
  if (!paywallModal) return;
  previouslyFocusedEl = document.activeElement;
  paywallModal.hidden = false;

  focusableElements = [...paywallPanel.querySelectorAll(focusableElementsString)];
  firstFocusableEl = focusableElements[0];
  lastFocusableEl = focusableElements[focusableElements.length - 1];
  
  firstFocusableEl.focus();

  paywallModal.addEventListener('keydown', handleFocusTrap);
}

function closePaywall() {
  if (!paywallModal) return;
  paywallModal.hidden = true;
  paywallModal.removeEventListener('keydown', handleFocusTrap);
  if (previouslyFocusedEl) {
    previouslyFocusedEl.focus();
  }
}

function handleFocusTrap(e) {
  if (e.key === 'Escape') {
    closePaywall();
    return;
  }

  if (e.key === 'Tab') {
    if (e.shiftKey) { // Shift + Tab
      if (document.activeElement === firstFocusableEl) {
        e.preventDefault();
        lastFocusableEl.focus();
      }
    } else { // Tab
      if (document.activeElement === lastFocusableEl) {
        e.preventDefault();
        firstFocusableEl.focus();
      }
    }
  }
}

// Esempio di trigger:
// document.getElementById('show-paywall-btn').addEventListener('click', openPaywall);
// Aggiungi un bottone di chiusura dentro il modale che chiami `closePaywall()`
// =========================================================================
*/
</script>

</body>
</html>
