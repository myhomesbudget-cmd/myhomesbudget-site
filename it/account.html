<!doctype html>
<html lang="it" data-app="myhomesbudget">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Il Mio Account â€” MyHomesBudget</title>
  <meta name="robots" content="noindex, nofollow" />
  
  <!-- Three.js per il 3D -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <!-- Phosphor Icons -->
  <script src="https://unpkg.com/@phosphor-icons/web"></script>

  <style>
    /* === VARIABILI TEMA CHIARO === */
    :root {
      --fg: #111;
      --bg: #f4f7fa;
      --glass: rgba(255,255,255,.6);
      --card-border: rgba(0,0,0,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --radius-lg: 16px;
      --primary-color: #6c5ce7;
      
      --font-sans: -apple-system,system-ui,"Segoe UI",Roboto,sans-serif;
      --grad: linear-gradient(135deg, #6c5ce7, #00cec9);
      
      /* Colori Emozioni */
      --color-sad: #636e72;   /* Grigio bluastro */
      --color-happy: #f1c40f; /* Oro */
      --color-excited: #8e44ad; /* Viola */
    }

    * { box-sizing: border-box; }
    html { font-family: var(--font-sans); background-color: var(--bg); }
    
    body {
      margin: 0;
      color: var(--fg);
      background: var(--bg);
      background-image: url("/bg.webp");
      background-repeat: no-repeat;
      background-position: center;
      background-size: cover;
      background-attachment: fixed;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    body::before {
      content: ""; position: fixed; inset: 0;
      background: linear-gradient(135deg, rgba(108,92,231,.05), rgba(0,206,201,.05));
      z-index: -1;
    }

    /* ====== TOPBAR ====== */
    .topbar {
      position: fixed; top: 0; left: 0; right: 0; height: 60px; padding: 0 24px;
      display: flex; align-items: center; justify-content: space-between;
      background: var(--glass); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--card-border); z-index: 100;
    }
    .logo-link { display: flex; align-items: center; gap: 8px; text-decoration: none; }
    .logo-text { font-weight: 600; color: #333; font-size: 1.1rem; }
    
    .top-link {
      display: flex; align-items: center; justify-content: center; height: 34px;
      color: #fff; text-decoration: none; padding: 6px 12px; border-radius: 10px;
      font-size: .9rem; font-weight: 600; background: var(--grad);
      border: none; box-shadow: 0 4px 12px rgba(0,0,0,.15);
      transition: transform 0.2s ease, filter 0.2s ease; cursor: pointer;
    }
    .top-link:hover { transform: translateY(-2px); filter: brightness(1.08); }

    /* ====== LAYOUT CENTRALE ====== */
    main.container {
      padding: 100px 24px 40px; 
      max-width: 1000px; 
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 85vh;
    }

    /* AREA 3D CENTRALE */
    .character-stage {
      width: 100%;
      height: 400px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    #canvas-container {
      width: 100%; height: 100%;
    }

    /* MESSAGGIO FLUTTUANTE */
    .message-bubble {
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(4px);
      padding: 16px 32px;
      border-radius: 50px;
      font-weight: 800;
      font-size: 1.2rem;
      color: #333;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      border: 1px solid rgba(0,0,0,0.05);
      text-align: center;
      margin-top: -40px; /* Sovrapposto leggermente al 3D */
      z-index: 10;
      position: relative;
      transition: all 0.3s ease;
      opacity: 0;
      transform: translateY(20px);
    }
    .message-bubble.visible { opacity: 1; transform: translateY(0); }
    
    .message-bubble strong { color: var(--primary-color); }

    /* SIMULATORE PIANI */
    .plan-simulator {
      margin-top: 40px;
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: var(--shadow);
      text-align: center;
      border: 1px solid var(--card-border);
    }
    
    .tier-switcher {
      display: flex; gap: 10px; justify-content: center; margin-top: 10px;
    }
    .tier-btn {
      padding: 8px 16px; border: 1px solid #ddd; background: #f9f9f9;
      border-radius: 8px; cursor: pointer; font-weight: 600; color: #666;
      transition: all 0.2s;
    }
    .tier-btn:hover { background: #eee; }
    .tier-btn.active { 
      background: var(--primary-color); 
      color: #fff; 
      border-color: var(--primary-color);
      box-shadow: 0 4px 12px rgba(108, 92, 231, 0.3);
    }

  </style>
</head>
<body>

  <nav class="topbar">
    <a href="index.html" class="logo-link">
      <img src="/homes.png" alt="Logo" style="height:32px;border-radius:6px; background:#eee;"> 
      <span class="logo-text">MyHomesBudget</span>
    </a>
    <div class="top-nav-right">
      <a href="index.html" class="top-link">
        <i class="ph ph-arrow-left" style="margin-right:8px"></i> Dashboard
      </a>
    </div>
  </nav>

  <main class="container">
    
    <!-- Scena 3D -->
    <div class="character-stage">
      <div id="canvas-container"></div>
    </div>

    <!-- Messaggio Dinamico -->
    <div id="status-message" class="message-bubble">
      Caricamento stato profilo...
    </div>

    <!-- Simulatore (Solo per demo, nella realtÃ  legge dal DB) -->
    <div class="plan-simulator">
      <p style="font-size:0.85rem; text-transform:uppercase; color:#999; font-weight:700; margin:0;">Stato attuale (Simulazione):</p>
      <div class="tier-switcher">
        <button class="tier-btn active" onclick="setTier('STARTER')">STARTER</button>
        <button class="tier-btn" onclick="setTier('PLUS')">PLUS</button>
        <button class="tier-btn" onclick="setTier('PRO')">PRO</button>
      </div>
    </div>

  </main>

  <script>
    // --- SETUP THREE.JS BASE ---
    const container = document.getElementById('canvas-container');
    const scene = new THREE.Scene();
    
    // Camera
    const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
    camera.position.set(0, 0.5, 5);

    // Renderer (Sfondo trasparente)
    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    container.appendChild(renderer.domElement);

    // Luci
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
    scene.add(ambientLight);
    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
    dirLight.position.set(2, 5, 5);
    dirLight.castShadow = true;
    scene.add(dirLight);

    // --- COSTRUZIONE ROBOT ---
    const botGroup = new THREE.Group();
    scene.add(botGroup);

    // Materiali
    const mainMat = new THREE.MeshPhysicalMaterial({ 
      color: 0xecf0f1, roughness: 0.2, metalness: 0.1, clearcoat: 0.5 
    });
    // Materiale colorato (cambierÃ  con il piano)
    const accentMat = new THREE.MeshPhysicalMaterial({ 
      color: 0x95a5a6, roughness: 0.3, emissive: 0x000000 
    });
    const darkMat = new THREE.MeshStandardMaterial({ color: 0x2c3e50 });

    // Corpo
    const bodyGeo = new THREE.SphereGeometry(0.9, 32, 32);
    const body = new THREE.Mesh(bodyGeo, mainMat);
    body.castShadow = true; body.receiveShadow = true;
    body.scale.set(1, 0.85, 1);
    botGroup.add(body);

    // Testa (Gruppo per animazione indipendente)
    const headGroup = new THREE.Group();
    headGroup.position.y = 0.75;
    botGroup.add(headGroup);

    const headGeo = new THREE.SphereGeometry(0.65, 32, 32);
    const head = new THREE.Mesh(headGeo, mainMat);
    head.castShadow = true;
    headGroup.add(head);

    // Visiera/Faccia
    const visorGeo = new THREE.SphereGeometry(0.55, 32, 32, 0, Math.PI * 2, 0, Math.PI * 0.35);
    const visor = new THREE.Mesh(visorGeo, accentMat);
    visor.rotation.x = -Math.PI / 2;
    visor.position.y = 0.15;
    headGroup.add(visor);

    // Occhi
    const eyeGeo = new THREE.CapsuleGeometry(0.1, 0.2, 4, 8);
    const leftEye = new THREE.Mesh(eyeGeo, darkMat);
    leftEye.rotation.z = Math.PI / 2;
    leftEye.position.set(-0.22, 0.1, 0.5);
    visor.add(leftEye);

    const rightEye = new THREE.Mesh(eyeGeo, darkMat);
    rightEye.rotation.z = Math.PI / 2;
    rightEye.position.set(0.22, 0.1, 0.5);
    visor.add(rightEye);

    // Braccia
    const armGeo = new THREE.SphereGeometry(0.22, 16, 16);
    
    // Braccio DX (con pollice)
    const armRightGroup = new THREE.Group();
    armRightGroup.position.set(1, 0.1, 0);
    botGroup.add(armRightGroup);
    const armRight = new THREE.Mesh(armGeo, mainMat);
    armRightGroup.add(armRight);
    
    const thumbGeo = new THREE.CylinderGeometry(0.05, 0.07, 0.25);
    const thumb = new THREE.Mesh(thumbGeo, mainMat);
    thumb.position.set(0, 0.25, 0);
    thumb.rotation.z = -0.2;
    armRight.add(thumb);
    thumb.scale.set(0,0,0); // Nascosto default

    // Braccio SX
    const armLeftGroup = new THREE.Group();
    armLeftGroup.position.set(-1, 0.1, 0);
    botGroup.add(armLeftGroup);
    const armLeft = new THREE.Mesh(armGeo, mainMat);
    armLeftGroup.add(armLeft);

    // Ombra
    const shadowGeo = new THREE.PlaneGeometry(2.2, 2.2);
    const shadowMat = new THREE.MeshBasicMaterial({ color: 0x000000, transparent: true, opacity: 0.15 });
    
    // Texture sfumata ombra
    const canvas = document.createElement('canvas');
    canvas.width = 64; canvas.height = 64;
    const ctx = canvas.getContext('2d');
    const grd = ctx.createRadialGradient(32, 32, 0, 32, 32, 32);
    grd.addColorStop(0, 'rgba(0,0,0,1)'); grd.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle = grd; ctx.fillRect(0,0,64,64);
    const shadowTex = new THREE.CanvasTexture(canvas);
    shadowMat.map = shadowTex; shadowMat.alphaMap = shadowTex;
    
    const shadowPlane = new THREE.Mesh(shadowGeo, shadowMat);
    shadowPlane.rotation.x = -Math.PI / 2;
    shadowPlane.position.y = -1;
    botGroup.add(shadowPlane);

    // --- ANIMAZIONE E STATI ---
    let currentTier = 'STARTER';
    let time = 0;

    function animate() {
      requestAnimationFrame(animate);
      time += 0.02;

      // Logica Comportamentale in base al Tier
      if (currentTier === 'STARTER') {
         // --- TRISTE ---
         // Testa bassa
         headGroup.rotation.x = THREE.MathUtils.lerp(headGroup.rotation.x, 0.4, 0.05);
         headGroup.rotation.y = THREE.MathUtils.lerp(headGroup.rotation.y, Math.sin(time)*0.1, 0.05); // Scuote piano la testa
         
         // Corpo basso e lento
         botGroup.position.y = Math.sin(time * 1.5) * 0.05 - 0.2;
         
         // Braccia penzoloni
         armRightGroup.position.y = THREE.MathUtils.lerp(armRightGroup.position.y, -0.2, 0.1);
         armLeftGroup.position.y = THREE.MathUtils.lerp(armLeftGroup.position.y, -0.2, 0.1);
         
         // No pollice
         thumb.scale.lerp(new THREE.Vector3(0,0,0), 0.2);

      } else if (currentTier === 'PLUS') {
         // --- FELICE ---
         // Testa alta
         headGroup.rotation.x = THREE.MathUtils.lerp(headGroup.rotation.x, -0.1, 0.05);
         headGroup.rotation.y = THREE.MathUtils.lerp(headGroup.rotation.y, Math.sin(time*2)*0.1, 0.05);
         
         // Saltello leggero
         botGroup.position.y = Math.sin(time * 4) * 0.1;
         
         // Braccia normali
         armRightGroup.position.y = THREE.MathUtils.lerp(armRightGroup.position.y, 0.1, 0.1);
         armLeftGroup.position.y = THREE.MathUtils.lerp(armLeftGroup.position.y, 0.1, 0.1);
         
         // No pollice
         thumb.scale.lerp(new THREE.Vector3(0,0,0), 0.2);

      } else if (currentTier === 'PRO') {
         // --- ECCITATO ---
         // Testa che guarda in alto/basso per l'energia
         headGroup.rotation.x = THREE.MathUtils.lerp(headGroup.rotation.x, -0.2, 0.05);
         
         // Salto alto e veloce (Jump)
         botGroup.position.y = Math.abs(Math.sin(time * 6)) * 0.4 - 0.1;
         
         // Rotazione euforica
         botGroup.rotation.y = Math.sin(time * 2) * 0.2;

         // Braccia in alto!
         armRightGroup.position.y = THREE.MathUtils.lerp(armRightGroup.position.y, 0.6, 0.1);
         armLeftGroup.position.y = THREE.MathUtils.lerp(armLeftGroup.position.y, 0.6, 0.1);
         
         // POLLICE SU!
         thumb.scale.lerp(new THREE.Vector3(1,1,1), 0.2);
      }

      // Ombra dinamica
      shadowPlane.material.opacity = 0.2 - (botGroup.position.y + 0.2) * 0.1;

      renderer.render(scene, camera);
    }
    animate();

    // --- FUNZIONE CAMBIO STATO ---
    window.setTier = function(tier) {
      currentTier = tier;
      const bubble = document.getElementById('status-message');
      
      // Update pulsanti
      document.querySelectorAll('.tier-btn').forEach(b => {
        b.classList.toggle('active', b.innerText === tier);
      });

      // Update Messaggio e Colore Robot
      let msg = "";
      let colorHex = 0xbdc3c7;

      bubble.classList.remove('visible');
      setTimeout(() => {
        if(tier === 'STARTER') {
           msg = "Mmm... sei ancora Starter. <br>Passa a <strong>PLUS</strong> per sbloccare gli obiettivi!";
           colorHex = 0x636e72; // Grigio Triste
        } else if(tier === 'PLUS') {
           msg = "Bene, sei Plus! <br>Ma perchÃ© non avere tutto? Passa a <strong>PRO</strong>!";
           colorHex = 0xf1c40f; // Oro Felice
        } else if(tier === 'PRO') {
           msg = "SEI UN PRO! ðŸš€<br>Hai il massimo della potenza!";
           colorHex = 0x8e44ad; // Viola Eccitato
        }
        
        bubble.innerHTML = msg;
        bubble.classList.add('visible');
        accentMat.color.setHex(colorHex);
        
        // Se PRO, illumina
        if(tier === 'PRO') accentMat.emissive.setHex(0x8e44ad);
        else accentMat.emissive.setHex(0x000000);
        
      }, 300);
    };

    // Resize
    window.addEventListener('resize', () => {
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
    });

    // Start
    setTier('STARTER'); // Default
  </script>
</body>
</html>
