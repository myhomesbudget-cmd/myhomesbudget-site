<!doctype html>
<html lang="it" data-app="myhomesbudget">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registrati ‚Äî MyHomesBudget</title>
  <meta name="robots" content="noindex, nofollow">

  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src 'self' https: data:;
                 style-src 'self' 'unsafe-inline';
                 script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com;
                 connect-src 'self' https://www.google-analytics.com https://region1.google-analytics.com;
                 font-src 'self' https: data:;
                 frame-ancestors 'none';
                 base-uri 'self';
                 form-action 'self'">

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LSD3V9G957"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config','G-LSD3V9G957',{ anonymize_ip:true });
  </script>

  <link rel="icon" href="/favicon.ico">
  <meta name="theme-color" content="#0f0f10">
  <meta name="color-scheme" content="light dark">

  <style>
    :root{font-family:-apple-system,system-ui,"Segoe UI",Roboto,sans-serif}
    *{box-sizing:border-box}
    a:focus-visible,button:focus-visible,input:focus-visible{outline:2px solid #00cec9;outline-offset:2px;border-radius:6px}
    body{margin:0;color:#fff;background:url("/bg.webp") no-repeat center/cover fixed;min-height:100vh;display:flex;flex-direction:column}
    body::before{content:"";position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:-1}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;background:rgba(255,255,255,.08);backdrop-filter:saturate(1.2) blur(8px);border-bottom:1px solid rgba(255,255,255,.12)}
    main{flex:1;display:flex;justify-content:center;align-items:center;padding:24px}
    .panel{width:100%;max-width:520px;background:rgba(255,255,255,.85);color:#111;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.15);backdrop-filter:saturate(1.2) blur(8px);overflow:hidden}
    .panel header{background:rgba(255,255,255,.55);border-bottom:1px solid rgba(0,0,0,.08)}
    .panel header h1{margin:0;font-size:1.6rem;color:#111}
    .panel .body{padding:20px 24px}
    .field{margin-bottom:14px}
    label{display:block;margin-bottom:6px;font-weight:600}
    input,select{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(0,0,0,.12);background:#fff;font-size:1rem}
    .btn{width:100%;padding:12px 16px;border:none;border-radius:10px;font-weight:800;cursor:pointer}
    .btn-primary{background:#6c5ce7;color:#fff}
    .btn-secondary{background:#fff;color:#111;border:1px solid rgba(0,0,0,.12)}
    .split{display:flex;gap:10px;margin-top:10px}
    .muted{color:#555;font-size:.9rem;margin-top:8px}
  </style>

  <script>
    function postAuthRedirect(){
      try {
        if (localStorage.getItem('onboarding_completed') === '1') {
          location.replace('/ita/dashboard.html');
        } else {
          location.replace('/ita/onboarding.html');
        }
      } catch(e){
        location.replace('/ita/onboarding.html');
      }
    }
    (function(){
      var q = new URLSearchParams(location.search);
      if (q.get('auth') === 'ok' || q.get('status') === 'success') postAuthRedirect();
    })();
  </script>
</head>
<body>
  <header aria-label="Barra applicazione">
    <div class="brand">üè† <strong>MyHomesBudget</strong></div>
    <nav><a href="/ita/index.html" style="color:#fff;text-decoration:none;opacity:.9">Home</a></nav>
  </header>

  <main>
    <section class="panel" aria-labelledby="title">
      <header><h1 id="title">Crea il tuo account</h1></header>
      <div class="body">
        <form id="signup-form" novalidate>
          <div class="field">
            <label for="name">Nome</label>
            <input id="name" name="name" type="text" autocomplete="name" required>
          </div>
          <div class="field">
            <label for="email">Email</label>
            <input id="email" name="email" type="email" autocomplete="email" required>
          </div>
          <div class="field">
            <label for="password">Password</label>
            <input id="password" name="password" type="password" autocomplete="new-password" required>
          </div>
          <div class="field">
            <label for="plan">Piano</label>
            <select id="plan" name="plan">
              <option value="trial" selected>Prova gratuita</option>
              <option value="abbonamento">Abbonamento</option>
              <option value="lifetime">Permanente</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Registrati</button>
        </form>

        <div class="split">
          <button class="btn btn-secondary" id="google-btn" type="button">Continua con Google</button>
        </div>
        <p class="muted">Hai gi√† un account? <a href="/ita/login.html">Accedi</a></p>
      </div>
    </section>
  </main>

  <script>
    // Al submit manda i dati al backend; al "success", chiama postAuthRedirect()
    document.getElementById('signup-form').addEventListener('submit', function(e){
      e.preventDefault();
      gtag('event','signup_submit',{plan: document.getElementById('plan').value});
      // TODO: sostituisci con la tua chiamata al server + verifica email
      // Simulazione client-side:
      setTimeout(function(){
        // se usi verifica via email, puoi comunque mandare subito all'onboarding:
        // l'importante √® che al primo login la guard/redirect porti all'onboarding.
        gtag('event','auth_success_redirect',{source:'password'});
        postAuthRedirect();
      }, 200);
    });

    // Google Sign-In (placeholder): nel callback reale chiama postAuthRedirect()
    document.getElementById('google-btn').addEventListener('click', function(){
      gtag('event','signup_google_click');
      // TODO: integra OAuth Google; al successo:
      gtag('event','auth_success_redirect',{source:'google'});
      postAuthRedirect();
    });
  </script>
</body>
</html>
