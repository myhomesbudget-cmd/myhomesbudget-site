<!doctype html>
<html lang="it" data-app="myhomesbudget">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard ‚Äî MyHomesBudget</title>
  <meta name="robots" content="noindex, nofollow" />
  <link rel="icon" href="/favicon.ico" />

  <style>
    :root{
      --fg:#111;--bg:#f4f7fa;--glass:rgba(255,255,255,.6);
      --card-border:rgba(0,0,0,.08);--shadow:0 10px 30px rgba(0,0,0,.08);
      --radius-lg:16px;--primary-color:#6c5ce7;--danger-color:#d32f2f;--success-color:#2e7d32;
      --font-sans:-apple-system,system-ui,"Segoe UI",Roboto,sans-serif;
      --grad: linear-gradient(135deg, #6c5ce7, #00cec9);
      --grad-danger: linear-gradient(135deg, #d32f2f, #ff7675);
    }
    *{box-sizing:border-box}
    html{font-family:var(--font-sans);background-color:var(--bg)}
    body{margin:0;color:var(--fg);background:url("/bg.webp") no-repeat center/cover fixed;min-height:100vh}
    body::before{content:"";position:fixed;inset:0;background:linear-gradient(135deg, rgba(108,92,231,.05), rgba(0,206,201,.05));z-index:-1}

    /* ====== TOPBAR ====== */
    .topbar{position:fixed;top:0;left:0;right:0;height:60px;padding:0 24px;
      display:flex;align-items:center;justify-content:space-between;
      background:var(--glass);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
      border-bottom:1px solid var(--card-border);z-index:100}
    .logo-link{display:flex;align-items:center;gap:8px;text-decoration:none}
    .logo-text{font-weight:600;color:#fff;font-size:1.1rem;text-shadow:0 1px 2px rgba(0,0,0,.35)}
    .top-actions{display:flex;gap:12px;align-items:center}
    .top-link{
      color:#fff;text-decoration:none;padding:6px 12px;border-radius:10px;font-size:.9rem;
      font-weight:600;background: var(--grad);border: none;box-shadow: 0 4px 12px rgba(0,0,0,.15);
      transition: transform 0.2s ease, filter 0.2s ease, box-shadow 0.2s ease;}
    .top-link:hover {transform: translateY(-2px);filter: brightness(1.08);box-shadow: 0 6px 16px rgba(0,0,0,.20);}
    
    .select-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      border-radius: 10px;
      background: var(--grad);
      box-shadow: 0 4px 12px rgba(0,0,0,.15);
      transition: transform 0.2s ease, filter 0.2s ease, box-shadow 0.2s ease;
    }
    .select-wrapper:hover {
      transform: translateY(-2px);
      filter: brightness(1.08);
      box-shadow: 0 6px 16px rgba(0,0,0,.20);
    }
    .select-wrapper::after {
      content: '‚ñº';
      font-size: 10px;
      color: rgba(255,255,255,0.8);
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
    }
    #month-selector {
      appearance: none; -webkit-appearance: none; -moz-appearance: none;
      background: transparent;
      color: #fff;
      border: none;
      padding: 6px 28px 6px 12px;
      font-size: .9rem;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
    }
    #month-selector option { background: white; color: black; }
    #month-selector:disabled { opacity: 0.7; }

    .top-center{position:absolute;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:12px}
    #trial-banner{display:none;align-items:center;gap:10px;background:var(--grad);color:#fff;padding:8px 12px;border-radius:999px;font-weight:700;box-shadow:0 6px 16px rgba(0,0,0,.15)}
    #trial-banner a{background:#fff;color:var(--primary-color);text-decoration:none;padding:4px 10px;border-radius:999px;font-size:.85rem;font-weight:800}

    /* ====== Contenuto Principale ====== */
    main.container{padding:84px 24px 24px;max-width:1280px;margin:0 auto;width:100%}
    .dash-nav{display:flex;gap:8px;border-bottom:1px solid rgba(0,0,0,.1);padding-bottom:12px;margin-bottom:24px}
    
    .dash-nav a{
      text-decoration:none;padding:8px 16px;border-radius:10px;font-weight:600;
      transition: all 0.2s ease;
      background: var(--grad); color: #fff; box-shadow: 0 4px 12px rgba(0,0,0,.1);
    }
    .dash-nav a:hover {
      transform: translateY(-2px); filter: brightness(1.08); box-shadow: 0 6px 16px rgba(0,0,0,.15);
    }
    .dash-nav a.is-active{
      filter: brightness(1.15);
      box-shadow: 0 6px 16px rgba(0,0,0,.20), inset 0 1px 2px rgba(255,255,255,0.2);
    }
    
    .content-section{background:rgba(255,255,255,.85);border-radius:var(--radius-lg);padding:24px;border:1px solid var(--card-border);box-shadow:var(--shadow)}
    
    .dashboard-panel {
      background: rgba(255,255,255,0.55);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border-radius: var(--radius-lg);
      padding: 24px;
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow);
    }
    .dashboard-panel .content-section,
    .dashboard-panel .summary-card {
      box-shadow: none;
      border: none;
    }
    .dashboard-panel .content-section {
       background: rgba(255,255,255,0.7);
    }

    /* ====== Layout Dashboard & Colonne ====== */
    .dashboard-grid{display:grid;grid-template-columns:1fr;gap:24px}
    @media(min-width: 1024px){.dashboard-grid{grid-template-columns:repeat(2, 1fr);}.form-section{grid-column:1 / -1}}
    .flow-column h2{display:flex;align-items:center;justify-content:space-between;gap:12px;font-size:1.5rem;margin:0 0 16px; padding: 0 8px;}
    .flow-column.income h2{color:var(--success-color)}
    .flow-column.expense h2{color:var(--danger-color)}

    /* ====== Riepilogo Grafico con Barre ====== */
    .summary-card{background:#fff;padding:16px;border-radius:var(--radius-lg);margin-bottom:16px}
    .summary-card h3 { display: flex; justify-content: space-between; align-items: center; margin: 0 0 12px; font-size: 1rem; color: #555; }
    .summary-total-amount { font-weight: 800; font-size: 1.2rem; }
    .income .summary-total-amount { color: var(--success-color); }
    .expense .summary-total-amount { color: var(--danger-color); }
    .category-summary-bars { display: flex; flex-direction: column; gap: 14px; margin-top: 16px; }
    .category-bar-item { display: flex; flex-direction: column; gap: 6px; }
    .category-bar-info { display: flex; justify-content: space-between; align-items: center; font-size: 0.95rem; }
    .category-bar-label { display: flex; align-items: center; gap: 8px; font-weight: 600; }
    .category-bar-label .icon { font-size: 1.1rem; }
    .category-bar-amount { font-weight: 700; }
    .progress-bar-bg { width: 100%; height: 10px; background-color: rgba(0,0,0,0.08); border-radius: 999px; overflow: hidden; }
    .progress-bar-fg { height: 100%; border-radius: 999px; transition: width 0.5s ease-out; }
    .income .progress-bar-fg { background: linear-gradient(90deg, #00cec9, #81ecec); }
    .expense .progress-bar-fg { background: linear-gradient(90deg, #6c5ce7, #fd79a8); }


    /* ====== Form e Bottoni ====== */
    .btn{cursor:pointer;border:none;border-radius:12px;padding:12px 16px;font-weight:800;color: #fff; transition: transform 0.2s ease, filter 0.2s ease, box-shadow 0.2s ease;}
    .btn:hover { transform: translateY(-2px); filter: brightness(1.08);}
    .btn-primary{background: var(--grad);box-shadow: 0 10px 24px rgba(0,0,0,.18);}
    .btn-primary:hover {box-shadow: 0 14px 28px rgba(0,0,0,.22);}
    .transaction-form{display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:flex-end}
    .form-group{display:flex;flex-direction:column}
    .form-group label{font-weight:600;font-size:.9rem;margin-bottom:6px}
    .form-group input,.form-group select{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;background:#fff;font-size:1rem}
    .form-group.kind, .form-group.note{grid-column:1 / -1}
    .transaction-form button{grid-column:1 / -1;margin-top:10px}
    @media(min-width: 1024px){.transaction-form{grid-template-columns:repeat(6, 1fr);gap:16px}.form-group.kind{grid-column:span 1}.form-group.note{grid-column:span 3}.form-group.amount{grid-column:span 2}.form-group.date{grid-column:span 2}.form-group.category{grid-column:span 2}.form-group.subcategory{grid-column:span 2}}

    /* ====== Lista Transazioni e Bottoni Azione ====== */
    .list-title {
      margin: -24px -24px 16px;
      padding: 12px 24px;
      font-size: 1.1rem;
      font-weight: 700;
      color: #333;
      border-bottom: 1px solid rgba(0,0,0,0.08);
      background: rgba(255,255,255,0.4);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .list-total-amount {
      font-weight: 800;
      font-size: 1.2rem;
    }
    .income .list-total-amount { color: var(--success-color); }
    .expense .list-total-amount { color: var(--danger-color); }

    .transaction-list .item{display:grid;grid-template-columns:auto 1fr auto auto;gap:12px;align-items:center;padding:12px 4px;border-bottom:1px solid rgba(0,0,0,.05)}
    .item:last-child{border-bottom:none}
    .item-icon{font-size:1.5rem;flex-shrink:0}
    .item-details{display:flex;flex-direction:column;min-width:0}
    .item-details .note{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .item-details .category{font-size:.9rem;color:#555;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .item-amount{text-align:right;white-space:nowrap;flex-shrink:0}
    .item-amount.expense{color:var(--danger-color);font-weight:700}
    .item-amount.income{color:var(--success-color);font-weight:700}
    .item-actions{display:flex;gap:4px;flex-shrink:0}
    .action-btn{background: var(--grad);color:#fff;border:none;border-radius:8px;padding:6px 10px;font-size:.85rem;font-weight:600;cursor:pointer;transition: filter 0.2s ease, transform 0.2s ease;}
    .action-btn:hover{filter: brightness(1.1);transform: translateY(-1px);}
    .action-btn.delete{background: var(--grad-danger);}
    .empty-state{text-align:center;padding:40px 20px;color:#777;background:rgba(0,0,0,0.02);border-radius:12px}
  </style>
</head>
<body>
  <!-- Topbar -->
  <nav class="topbar">
    <a href="/it/" class="logo-link"><img src="/homes.png" alt="Logo" style="height:32px;border-radius:6px"><span class="logo-text">MyHomesBudget</span></a>
    <div class="top-center"><div id="trial-banner"><span id="trial-days-left"></span><a href="/it/paywall.html">Aggiorna piano</a></div></div>
    <div class="top-actions">
      <div class="select-wrapper">
        <select id="month-selector" aria-label="Seleziona mese"></select>
      </div>
      <a href="/it/onboarding.html?edit=1" class="top-link">üéØ Modifica Obiettivo</a>
      <a href="#" id="logout-btn" class="top-link">Esci</a>
    </div>
  </nav>

  <main class="container">
    <nav id="dash-nav" class="dash-nav">
      <a href="/it/dashboard.html" class="is-active" aria-current="page">AGGIORNA</a>
      <a href="/it/dashboard-riepilogo.html">Riepilogo</a>
    </nav>

    <!-- Sezione Form -->
    <section class="content-section form-section">
      <h2 id="form-title" style="margin:0 0 16px">üìö Inserisci una Nuova Transazione</h2>
      <form id="transaction-form" class="transaction-form">
        <input type="hidden" id="transaction-id" name="transaction-id">
        <div class="form-group kind"><label for="kind">Tipo</label><select id="kind" name="kind" required><option value="expense">Uscita</option><option value="income">Entrata</option><option value="transfer">Trasferimento</option></select></div>
        <div class="form-group note"><label for="note">Nota</label><input type="text" id="note" name="note" placeholder="Es. Caff√® al bar" required></div>
        <div class="form-group amount"><label for="amount">Importo (‚Ç¨)</label><input type="number" id="amount" name="amount" step="0.01" placeholder="0.00" required></div>
        <div class="form-group date"><label for="occurred_at">Data</label><input type="date" id="occurred_at" name="occurred_at" required></div>
        <div class="form-group category"><label for="category_id">Categoria</label><select id="category_id" name="category_id" required></select></div>
        <div class="form-group subcategory"><label for="subcategory_id">Sottocategoria</label><select id="subcategory_id" name="subcategory_id"></select></div>
        <button type="submit" class="btn btn-primary">Aggiungi</button>
      </form>
    </section>

    <!-- Pannello Principale Dati -->
    <div class="dashboard-panel" style="margin-top: 24px;">
      <div class="dashboard-grid">
        <div class="flow-column income"><h2>‚úÖ Entrate Recenti</h2><div id="income-summary" class="summary-card"></div><div id="income-list" class="content-section transaction-list"></div></div>
        <div class="flow-column expense"><h2>‚ùå Uscite Recenti</h2><div id="expense-summary" class="summary-card"></div><div id="expense-list" class="content-section transaction-list"></div></div>
      </div>
    </div>
  </main>
  
  <script type="module">
    import { supabase } from "/it/supabase-client.js";

    // --- Elementi DOM ---
    const transactionForm = document.getElementById('transaction-form');
    const kindSelect = document.getElementById('kind');
    const categorySelect = document.getElementById('category_id');
    const subcategorySelect = document.getElementById('subcategory_id');
    const transactionIdInput = document.getElementById('transaction-id');
    const formTitle = document.getElementById('form-title');
    const logoutBtn = document.getElementById('logout-btn');
    const incomeList = document.getElementById('income-list');
    const expenseList = document.getElementById('expense-list');
    const incomeSummary = document.getElementById('income-summary');
    const expenseSummary = document.getElementById('expense-summary');
    const monthSelector = document.getElementById('month-selector');

    let user = null;
    let allCategories = [];
    let allSubcategories = [];
    let allTransactions = [];

    // --- Gestione Dati e Rendering ---
    function handleTrialStatus(profile){
      const banner=document.getElementById('trial-banner');const text=document.getElementById('trial-days-left');if(!profile||profile.plan_type!=='trial'||!profile.trial_end){banner.style.display='none';return}const trialEnd=new Date(profile.trial_end);const today=new Date();today.setHours(0,0,0,0);const diffDays=Math.ceil((trialEnd.getTime()-today.getTime())/864e5);if(diffDays>=0){banner.style.display='flex';text.textContent=diffDays===0?"Ultimo giorno di prova!":diffDays===1?"Manca 1 giorno alla fine della prova.":`Mancano ${diffDays} giorni alla fine della prova.`}else{alert("La tua prova √® terminata. Scegli un piano per continuare.");location.replace("/it/paywall.html")}}
    function safeToNumber(v){ const n=(typeof v==='number')?v:parseFloat(v);return Number.isFinite(n)?n:0}
    async function loadInitialData(){
      const{data:categories,error:cError}=await supabase.from('categories').select('*').eq('created_by',user.id);if(cError){console.error("Errore categorie:",cError);return}allCategories=categories||[];if(allCategories.length){const ids=allCategories.map(c=>c.id);const{data:subcategories,error:sError}=await supabase.from('subcategories').select('*').in('category_id',ids);if(sError){console.error("Errore sottocategorie:",sError);return}allSubcategories=subcategories||[]}}
    function updateCategoryDropdown(){
      const selectedKind=kindSelect.value;const filtered=allCategories.filter(cat=>cat.kind===selectedKind);categorySelect.innerHTML='<option value="">Scegli categoria...</option>';filtered.forEach(cat=>categorySelect.add(new Option(`${cat.icon} ${cat.name}`,cat.id)));updateSubcategories()}
    function updateSubcategories(selectedSubcategoryId=null){
      const categoryId=categorySelect.value;subcategorySelect.innerHTML='<option value="">Nessuna</option>';subcategorySelect.disabled=true;if(!categoryId)return;const relevant=allSubcategories.filter(sub=>String(sub.category_id)===String(categoryId));if(relevant.length){subcategorySelect.disabled=false;relevant.forEach(sub=>subcategorySelect.add(new Option(`${sub.icon} ${sub.name}`,sub.id)));if(selectedSubcategoryId)subcategorySelect.value=selectedSubcategoryId}}
    
    function renderDashboard(transactions){
      const incomes=transactions.filter(tx=>tx.kind==='income');
      const expenses=transactions.filter(tx=>tx.kind==='expense');
      renderSummary(incomes,incomeSummary,'income');
      renderList(incomes,incomeList, 'income');
      renderSummary(expenses,expenseSummary,'expense');
      renderList(expenses,expenseList, 'expense');
    }
    
    function renderSummary(items, container, kind) {
        container.innerHTML = '';
        const categoryMap = allCategories
            .filter(cat => cat.kind === kind)
            .reduce((acc, cat) => {
                acc[cat.id] = { name: cat.name, icon: cat.icon || (kind === 'income' ? 'üí∞' : 'üí∏'), total: 0 };
                return acc;
            }, {});
        items.forEach(tx => {
            const catId = tx.category_id;
            if (categoryMap[catId]) {
                categoryMap[catId].total += safeToNumber(tx.amount);
            }
        });
        const totalAmount = items.reduce((sum, tx) => sum + safeToNumber(tx.amount), 0);
        const top5Categories = Object.values(categoryMap)
            .sort((a, b) => b.total - a.total)
            .slice(0, 5);
        if (top5Categories.length === 0) {
            container.style.display = 'none';
            return;
        }
        container.style.display = 'block';
        const summaryTitle = kind === 'income' ? 'üèÜ Top 5 Entrate' : 'üèÜ Top 5 Uscite';
        let barsHTML = top5Categories.map(cat => {
            const percentage = totalAmount > 0 ? (cat.total / totalAmount) * 100 : 0;
            return `
                <div class="category-bar-item">
                    <div class="category-bar-info">
                        <span class="category-bar-label">
                            <span class="icon">${cat.icon}</span>
                            <span>${cat.name}</span>
                        </span>
                        <span class="category-bar-amount">${cat.total.toFixed(2)}‚Ç¨</span>
                    </div>
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fg" style="width: ${percentage}%"></div>
                    </div>
                </div>
            `;
        }).join('');
        container.innerHTML = `
            <h3>
                <span>${summaryTitle}</span>
                <span class="summary-total-amount">${totalAmount.toFixed(2)}‚Ç¨</span>
            </h3>
            <div class="category-summary-bars">${barsHTML}</div>
        `;
    }

    function renderList(items, container, kind){
      container.innerHTML = '';
      
      const totalAmount = items.reduce((sum, tx) => sum + safeToNumber(tx.amount), 0);
      const titleText = kind === 'income' ? 'Movimenti in Entrata' : 'Movimenti in Uscita';
      
      const titleEl = document.createElement('div');
      titleEl.className = 'list-title';
      const totalColorClass = kind === 'income' ? 'income' : 'expense';
      titleEl.innerHTML = `
        <span>${titleText}</span>
        <span class="list-total-amount ${totalColorClass}">${totalAmount.toFixed(2)}‚Ç¨</span>
      `;
      container.appendChild(titleEl);

      if(!items.length){
        const emptyState = document.createElement('div');
        emptyState.className = 'empty-state';
        emptyState.innerHTML = `<p>Nessun movimento qui.</p>`;
        container.appendChild(emptyState);
        return;
      }
      
      items.forEach(tx=>{
        const item=document.createElement('div');
        item.className='item';
        const cat=tx.categories;
        const sub=tx.subcategories;
        const icon=sub?.icon||cat?.icon||'üí∏';
        const categoryText=`${cat?.name||'N/A'}${(sub?` / ${sub.name}`:'')}`;
        const amountNum=safeToNumber(tx.amount);
        item.innerHTML=`<div class="item-icon">${icon}</div><div class="item-details"><span class="note">${tx.note??''}</span><span class="category">${categoryText}</span></div><div class="item-amount ${tx.kind}">${tx.kind==='expense'?'-':''}${amountNum.toFixed(2)} ‚Ç¨</div><div class="item-actions"><button class="action-btn edit-btn" data-id="${tx.id}">Modifica</button><button class="action-btn delete-btn delete" data-id="${tx.id}">Elimina</button></div>`;
        container.appendChild(item);
      });
    }

    async function loadTransactions() {
        monthSelector.disabled = true;
        renderDashboard([]); 
        const selectedMonth = monthSelector.value;
        let query = supabase.from('transactions')
            .select(`*, categories(name, icon), subcategories(name, icon)`)
            .eq('created_by', user.id)
            .order('occurred_at', { ascending: false });
        if (selectedMonth) {
            const startDate = new Date(selectedMonth);
            const endDate = new Date(startDate.getFullYear(), startDate.getMonth() + 1, 0, 23, 59, 59);
            query = query
                .gte('occurred_at', startDate.toISOString())
                .lte('occurred_at', endDate.toISOString());
        } else {
            query = query.limit(30);
        }
        const { data, error } = await query;
        monthSelector.disabled = false;
        if (error) {
            console.error("Errore transazioni:", error);
            return;
        }
        allTransactions = data || [];
        renderDashboard(allTransactions);
    }

    function handleEdit(id){
      const tx=allTransactions.find(t=>String(t.id)===String(id));if(!tx)return;formTitle.textContent="‚úçÔ∏è Modifica Transazione";transactionIdInput.value=tx.id;document.getElementById('kind').value=tx.kind;document.getElementById('note').value=tx.note??'';document.getElementById('amount').value=safeToNumber(tx.amount);document.getElementById('occurred_at').value=(tx.occurred_at||'').split('T')[0]||'';updateCategoryDropdown();categorySelect.value=tx.category_id??'';updateSubcategories(tx.subcategory_id??null);window.scrollTo({top:0,behavior:'smooth'})}
    async function handleDelete(id){
      if(!confirm("Eliminare questa transazione?"))return;const{error}=await supabase.from('transactions').delete().eq('id',id);if(error){console.error("Errore eliminazione:",error);alert("Impossibile eliminare.")}else{loadTransactions()}}
    async function handleFormSubmit(e){
      e.preventDefault();const formData=new FormData(transactionForm);const id=formData.get('transaction-id');const payload={kind:formData.get('kind'),note:formData.get('note'),amount:formData.get('amount'),occurred_at:formData.get('occurred_at'),category_id:formData.get('category_id'),subcategory_id:formData.get('subcategory_id')||null,created_by:user.id};const{error}=id?await supabase.from('transactions').update(payload).eq('id',id):await supabase.from('transactions').insert(payload);if(error){console.error("Errore salvataggio:",error);alert("Errore. Riprova.")}else{transactionForm.reset();formTitle.textContent="üìö Inserisci una Nuova Transazione";transactionIdInput.value="";document.getElementById('occurred_at').valueAsDate=new Date();updateCategoryDropdown();loadTransactions()}}

    // --- Inizializzazione pagina ---
    async function initializePage() {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session){ location.replace("/it/login.html"); return; }
      user = session.user;
      
      const { data: profile } = await supabase.from('profiles').select('onboarded, plan_type, trial_end').eq('id', user.id).single();
      handleTrialStatus(profile);
      if (profile && !profile.onboarded && new URLSearchParams(location.search).get('edit')!=='1'){location.replace("/it/onboarding.html");return;}

      for (let i = 0; i < 12; i++){
        const d = new Date(); d.setMonth(d.getMonth()-i);
        const value = d.toISOString().slice(0,7) + '-01';
        const label = d.toLocaleDateString('it-IT',{month:'long', year:'numeric'});
        monthSelector.add(new Option(label, value));
      }

      document.getElementById('occurred_at').valueAsDate=new Date();
      await loadInitialData();
      updateCategoryDropdown();
      await loadTransactions(); 

      // Listeners
      kindSelect.addEventListener('change', updateCategoryDropdown);
      categorySelect.addEventListener('change', () => updateSubcategories());
      transactionForm.addEventListener('submit', handleFormSubmit);
      logoutBtn.addEventListener('click', async(e)=>{e.preventDefault();await supabase.auth.signOut();location.replace("/it/")});
      document.querySelector('.dashboard-grid').addEventListener('click',(ev)=>{const t=ev.target.closest('.action-btn');if(!t)return;const id=t.dataset.id;if(t.classList.contains('edit-btn'))handleEdit(id);else if(t.classList.contains('delete-btn'))handleDelete(id)});
      monthSelector.addEventListener('change', loadTransactions);
      
      const refreshButton = document.querySelector('.dash-nav a[href="/it/dashboard.html"]');
      if(refreshButton) {
        refreshButton.addEventListener('click', (e) => {
          e.preventDefault();
          loadTransactions();
        });
      }
    }

    document.addEventListener('DOMContentLoaded', initializePage);
  </script>
</body>
</html>
