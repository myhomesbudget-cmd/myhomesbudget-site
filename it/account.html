<!doctype html>
<html lang="it" data-app="myhomesbudget">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Il Mio Account ‚Äî MyHomesBudget</title>
  <meta name="robots" content="noindex, nofollow" />
  
  <!-- Three.js per il 3D -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <!-- Phosphor Icons -->
  <script src="https://unpkg.com/@phosphor-icons/web"></script>

  <style>
    /* === RIPRENDO ESATTAMENTE LE TUE VARIABILI === */
    :root {
      --fg: #111;
      --bg: #f4f7fa;
      --glass: rgba(255,255,255,.6);
      --card-border: rgba(0,0,0,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --radius-lg: 16px;
      --primary-color: #6c5ce7;
      --danger-color: #d32f2f;
      --success-color: #2e7d32;
      --warning-color: #f39c12;
      --font-sans: -apple-system,system-ui,"Segoe UI",Roboto,sans-serif;
      --grad: linear-gradient(135deg, #6c5ce7, #00cec9);
      --grad-danger: linear-gradient(135deg, #d32f2f, #ff7675);
      
      /* Variabili specifiche per i Tier */
      --tier-starter: #00cec9;
      --tier-plus: #f39c12;
      --tier-pro: #6c5ce7;
    }

    * { box-sizing: border-box; }
    html { font-family: var(--font-sans); background-color: var(--bg); }
    
    body {
      margin: 0;
      color: var(--fg);
      background: var(--bg); /* Fallback se manca l'immagine */
      background-image: url("/bg.webp");
      background-repeat: no-repeat;
      background-position: center;
      background-size: cover;
      background-attachment: fixed;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    /* Overlay gradiente come nel tuo codice */
    body::before {
      content: ""; position: fixed; inset: 0;
      background: linear-gradient(135deg, rgba(108,92,231,.05), rgba(0,206,201,.05));
      z-index: -1;
    }

    /* ====== TOPBAR (Stile Originale) ====== */
    .topbar {
      position: fixed; top: 0; left: 0; right: 0; height: 60px; padding: 0 24px;
      display: flex; align-items: center; justify-content: space-between;
      background: var(--glass); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--card-border); z-index: 100;
    }
    .logo-link { display: flex; align-items: center; gap: 8px; text-decoration: none; }
    .logo-text { font-weight: 600; color: #333; font-size: 1.1rem; } /* Adattato per sfondo chiaro se logo bianco non si vede */
    
    .top-link {
      display: flex; align-items: center; justify-content: center; height: 34px;
      color: #fff; text-decoration: none; padding: 6px 12px; border-radius: 10px;
      font-size: .9rem; font-weight: 600; background: var(--grad);
      border: none; box-shadow: 0 4px 12px rgba(0,0,0,.15);
      transition: transform 0.2s ease, filter 0.2s ease; cursor: pointer;
    }
    .top-link:hover { transform: translateY(-2px); filter: brightness(1.08); }

    /* ====== LAYOUT ACCOUNT ====== */
    main.container {
      padding: 84px 24px 24px; max-width: 1200px; margin: 0 auto;
      display: grid; grid-template-columns: 1fr 1.2fr; gap: 40px; align-items: center;
      min-height: 85vh;
    }

    @media (max-width: 900px) {
      main.container { grid-template-columns: 1fr; padding-top: 80px; }
      .character-column { height: 400px; order: -1; }
    }

    /* CARD INFO UTENTE (Stile Glass) */
    .account-card {
      background: rgba(255,255,255,0.75);
      backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
      border-radius: var(--radius-lg);
      padding: 32px;
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow);
    }

    .user-header { display: flex; align-items: center; gap: 20px; margin-bottom: 24px; }
    .avatar-circle {
      width: 80px; height: 80px; border-radius: 50%;
      background: var(--grad);
      display: flex; align-items: center; justify-content: center;
      color: #fff; font-size: 2rem;
      box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
    }
    
    .user-info h1 { margin: 0; font-size: 1.5rem; color: #333; }
    .user-info p { margin: 4px 0 0; color: #666; font-size: 0.95rem; }

    /* BADGE PIANO */
    .plan-badge {
      display: inline-block; padding: 6px 16px; border-radius: 20px;
      font-weight: 800; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;
      color: #fff; margin-bottom: 24px;
      transition: all 0.4s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .plan-badge[data-tier="STARTER"] { background: var(--tier-starter); }
    .plan-badge[data-tier="PLUS"] { background: var(--tier-plus); }
    .plan-badge[data-tier="PRO"] { background: var(--tier-pro); box-shadow: 0 6px 20px rgba(108, 92, 231, 0.4); }

    /* LISTA FEATURE */
    .features-list { list-style: none; padding: 0; margin: 0 0 30px 0; }
    .features-list li {
      display: flex; align-items: center; gap: 12px; margin-bottom: 12px;
      font-weight: 500; color: #888; transition: all 0.3s;
    }
    .features-list li i { font-size: 1.2rem; }
    
    /* Stato attivo delle feature */
    .features-list li.is-active { color: #333; }
    .features-list li.is-active i { color: var(--success-color); }
    
    /* SIMULATORE */
    .tier-switcher {
      background: rgba(0,0,0,0.03); border-radius: 12px; padding: 6px;
      display: flex; gap: 6px; margin-top: 20px;
    }
    .tier-btn {
      flex: 1; border: none; background: transparent; padding: 10px;
      border-radius: 8px; font-weight: 600; color: #666; cursor: pointer;
      transition: all 0.2s;
    }
    .tier-btn:hover { background: rgba(255,255,255,0.5); }
    .tier-btn.active { background: #fff; color: var(--primary-color); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }

    /* COLONNA 3D */
    .character-column {
      position: relative; height: 100%; min-height: 500px;
      display: flex; align-items: center; justify-content: center;
    }
    #canvas-container {
      width: 100%; height: 100%; position: absolute; inset: 0;
    }
    
    /* Testo fluttuante sopra il 3D */
    .cheer-text {
      position: absolute; bottom: 20px; 
      background: rgba(255,255,255,0.9); padding: 12px 24px;
      border-radius: 50px; font-weight: 800; color: var(--primary-color);
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      transform: translateY(20px); opacity: 0; transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .cheer-text.visible { transform: translateY(0); opacity: 1; }

  </style>
</head>
<body>

  <!-- Topbar -->
  <nav class="topbar">
    <a href="index.html" class="logo-link">
      <img src="/homes.png" alt="Logo" style="height:32px;border-radius:6px; background:#eee;"> 
      <span class="logo-text">MyHomesBudget</span>
    </a>
    <div class="top-nav-right">
      <a href="index.html" class="top-link">
        <i class="ph ph-arrow-left" style="margin-right:8px"></i> Dashboard
      </a>
    </div>
  </nav>

  <main class="container">
    
    <!-- Colonna Info -->
    <div class="account-card">
      <div class="user-header">
        <div class="avatar-circle">MR</div>
        <div class="user-info">
          <h1>Mario Rossi</h1>
          <p>Membro dal 2023</p>
        </div>
      </div>

      <div class="plan-badge" id="current-badge" data-tier="STARTER">STARTER</div>
      
      <ul class="features-list">
        <li class="is-active" id="feat-1"><i class="ph-fill ph-check-circle"></i> Tracciamento Spese</li>
        <li class="is-active" id="feat-2"><i class="ph-fill ph-check-circle"></i> Report Mensili</li>
        <li id="feat-3"><i class="ph ph-lock-key"></i> Obiettivi di Risparmio (PLUS)</li>
        <li id="feat-4"><i class="ph ph-lock-key"></i> Assistente AI (PRO)</li>
        <li id="feat-5"><i class="ph ph-lock-key"></i> Export Dati & Multi-user (PRO)</li>
      </ul>

      <div style="border-top: 1px solid rgba(0,0,0,0.05); margin: 20px 0; padding-top:20px;">
        <p style="font-size:0.8rem; text-transform:uppercase; color:#999; font-weight:700; margin-bottom:10px;">Simula il tuo piano:</p>
        <div class="tier-switcher">
          <button class="tier-btn active" onclick="setTier('STARTER')">STARTER</button>
          <button class="tier-btn" onclick="setTier('PLUS')">PLUS</button>
          <button class="tier-btn" onclick="setTier('PRO')">PRO</button>
        </div>
      </div>
      
      <button class="top-link" style="width:100%; margin-top:10px; justify-content:center;">
        Gestisci Abbonamento
      </button>
    </div>

    <!-- Colonna 3D -->
    <div class="character-column">
      <div id="canvas-container"></div>
      <div class="cheer-text" id="cheer-text">OTTIMA SCELTA! üëç</div>
    </div>

  </main>

  <script>
    // --- SETUP THREE.JS ---
    const container = document.getElementById('canvas-container');
    const scene = new THREE.Scene();
    
    // Camera
    const camera = new THREE.PerspectiveCamera(40, container.clientWidth / container.clientHeight, 0.1, 1000);
    camera.position.set(0, 1, 6);

    // Renderer (con trasparenza per il tuo sfondo)
    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.shadowMap.enabled = true; // Ombre per effetto Pixar
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    container.appendChild(renderer.domElement);

    // --- LUCI (Stile "Studio" per look pulito) ---
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambientLight);

    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
    dirLight.position.set(2, 5, 5);
    dirLight.castShadow = true;
    dirLight.shadow.mapSize.width = 1024;
    dirLight.shadow.mapSize.height = 1024;
    scene.add(dirLight);
    
    const backLight = new THREE.DirectionalLight(0x6c5ce7, 0.5); // Rim light viola
    backLight.position.set(-2, 3, -5);
    scene.add(backLight);

    // --- PERSONAGGIO (Geometria Procedurale) ---
    const botGroup = new THREE.Group();
    scene.add(botGroup);

    // Materiali
    const mainMat = new THREE.MeshPhysicalMaterial({ 
      color: 0xeeeeee, 
      roughness: 0.2, 
      metalness: 0.1,
      clearcoat: 0.5 // Effetto plastica lucida
    });
    
    const colorMat = new THREE.MeshPhysicalMaterial({ 
      color: 0x00cec9, // Colore variabile
      roughness: 0.3,
      metalness: 0.0,
      emissive: 0x000000
    });

    const darkMat = new THREE.MeshStandardMaterial({ color: 0x333333 });

    // Corpo
    const bodyGeo = new THREE.SphereGeometry(1, 32, 32);
    const body = new THREE.Mesh(bodyGeo, mainMat);
    body.castShadow = true; body.receiveShadow = true;
    body.scale.set(1, 0.9, 1);
    botGroup.add(body);

    // Testa
    const headGroup = new THREE.Group();
    headGroup.position.y = 0.8;
    botGroup.add(headGroup);

    const headGeo = new THREE.SphereGeometry(0.75, 32, 32);
    const head = new THREE.Mesh(headGeo, mainMat);
    head.castShadow = true;
    headGroup.add(head);

    // Visiera (parte colorata)
    const visorGeo = new THREE.SphereGeometry(0.6, 32, 32, 0, Math.PI * 2, 0, Math.PI * 0.35);
    const visor = new THREE.Mesh(visorGeo, colorMat);
    visor.rotation.x = -Math.PI / 2;
    visor.position.y = 0.2;
    headGroup.add(visor);

    // Occhi
    const eyeGeo = new THREE.CapsuleGeometry(0.12, 0.2, 4, 8);
    const leftEye = new THREE.Mesh(eyeGeo, darkMat);
    leftEye.rotation.z = Math.PI / 2;
    leftEye.position.set(-0.25, 0.1, 0.55);
    visor.add(leftEye); // Attaccati alla visiera

    const rightEye = new THREE.Mesh(eyeGeo, darkMat);
    rightEye.rotation.z = Math.PI / 2;
    rightEye.position.set(0.25, 0.1, 0.55);
    visor.add(rightEye);

    // Braccia
    const armGroupRight = new THREE.Group();
    armGroupRight.position.set(1.1, 0.2, 0);
    botGroup.add(armGroupRight);

    const armGeo = new THREE.SphereGeometry(0.25, 16, 16);
    const armRight = new THREE.Mesh(armGeo, mainMat);
    armGroupRight.add(armRight);
    
    // Pollice (nascosto di default)
    const thumbGeo = new THREE.CylinderGeometry(0.06, 0.08, 0.3);
    const thumb = new THREE.Mesh(thumbGeo, mainMat);
    thumb.position.set(0, 0.3, 0);
    thumb.rotation.x = 0.2;
    armRight.add(thumb);
    thumb.scale.set(0,0,0); // Nascondi scalando

    const armLeft = new THREE.Mesh(armGeo, mainMat);
    armLeft.position.set(-1.1, 0.2, 0);
    botGroup.add(armLeft);

    // Ombra a terra (Fake shadow per performance)
    const shadowGeo = new THREE.PlaneGeometry(2.5, 2.5);
    const shadowMat = new THREE.MeshBasicMaterial({ 
      color: 0x000000, transparent: true, opacity: 0.15 
    });
    // Texture sfumata circolare generata via canvas per l'ombra
    const canvas = document.createElement('canvas');
    canvas.width = 128; canvas.height = 128;
    const ctx = canvas.getContext('2d');
    const grd = ctx.createRadialGradient(64, 64, 0, 64, 64, 64);
    grd.addColorStop(0, 'rgba(0,0,0,1)');
    grd.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle = grd; ctx.fillRect(0,0,128,128);
    const shadowTex = new THREE.CanvasTexture(canvas);
    shadowMat.map = shadowTex;
    shadowMat.alphaMap = shadowTex;
    
    const shadowPlane = new THREE.Mesh(shadowGeo, shadowMat);
    shadowPlane.rotation.x = -Math.PI / 2;
    shadowPlane.position.y = -1;
    botGroup.add(shadowPlane);


    // --- LOGICA ANIMAZIONE ---
    let targetTier = 'STARTER';
    let time = 0;
    
    // Mouse interaction
    let mouse = { x: 0, y: 0 };
    document.addEventListener('mousemove', (e) => {
      const rect = container.getBoundingClientRect();
      // Calcolo coordinate normalizzate relative al canvas
      if(e.clientX > rect.left && e.clientX < rect.right && e.clientY > rect.top && e.clientY < rect.bottom) {
          mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
          mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
      }
    });

    function animate() {
      requestAnimationFrame(animate);
      time += 0.02;

      // 1. Idle Floating
      botGroup.position.y = Math.sin(time * 2) * 0.1;
      shadowPlane.material.opacity = 0.15 - (botGroup.position.y * 0.05); // Ombra dinamica

      // 2. Head LookAt Mouse (Morbido)
      headGroup.rotation.y = THREE.MathUtils.lerp(headGroup.rotation.y, mouse.x * 0.5, 0.1);
      headGroup.rotation.x = THREE.MathUtils.lerp(headGroup.rotation.x, -mouse.y * 0.3, 0.1);

      // 3. Logica TIER
      if (targetTier === 'PRO') {
         // Animazione Saltellante Felice
         botGroup.position.y += Math.abs(Math.sin(time * 6)) * 0.2; // Salto pi√π alto e veloce
         botGroup.rotation.y = Math.sin(time) * 0.3; // Oscillazione corpo
         
         // Braccio in su (Lerp)
         armGroupRight.position.y = THREE.MathUtils.lerp(armGroupRight.position.y, 0.6, 0.1);
         armGroupRight.position.x = THREE.MathUtils.lerp(armGroupRight.position.x, 1.2, 0.1);
         
         // Pollice Visibile
         thumb.scale.lerp(new THREE.Vector3(1,1,1), 0.2);
         
         // Colore Emissivo Pulsante
         colorMat.emissive.setHex(0x6c5ce7);
         colorMat.emissiveIntensity = 0.2 + Math.sin(time * 10) * 0.2;

      } else {
         // Reset posizioni
         botGroup.rotation.y = THREE.MathUtils.lerp(botGroup.rotation.y, 0, 0.1);
         
         // Braccio gi√π
         armGroupRight.position.y = THREE.MathUtils.lerp(armGroupRight.position.y, 0.2, 0.1);
         armGroupRight.position.x = THREE.MathUtils.lerp(armGroupRight.position.x, 1.1, 0.1);
         
         // Nascondi pollice
         thumb.scale.lerp(new THREE.Vector3(0,0,0), 0.2);
         
         colorMat.emissiveIntensity = 0;
      }

      renderer.render(scene, camera);
    }
    animate();


    // --- GESTIONE INTERFACCIA ---
    window.setTier = function(tier) {
      targetTier = tier;
      
      // 1. Aggiorna Colori Robot
      let colorHex;
      switch(tier) {
        case 'STARTER': colorHex = 0x00cec9; break;
        case 'PLUS': colorHex = 0xf39c12; break;
        case 'PRO': colorHex = 0x6c5ce7; break;
      }
      colorMat.color.setHex(colorHex);
      
      // 2. Aggiorna UI Badge
      const badge = document.getElementById('current-badge');
      badge.innerText = tier;
      badge.setAttribute('data-tier', tier);
      
      // 3. Aggiorna Bottoni
      document.querySelectorAll('.tier-btn').forEach(b => {
        b.classList.toggle('active', b.innerText === tier);
      });

      // 4. Aggiorna Features List (Logica simulata)
      const feats = [
        {el: document.getElementById('feat-3'), unlock: ['PLUS', 'PRO']},
        {el: document.getElementById('feat-4'), unlock: ['PRO']},
        {el: document.getElementById('feat-5'), unlock: ['PRO']}
      ];
      
      feats.forEach(f => {
        const isUnlocked = f.unlock.includes(tier);
        f.el.className = isUnlocked ? 'is-active' : '';
        const icon = f.el.querySelector('i');
        icon.className = isUnlocked ? 'ph-fill ph-check-circle' : 'ph ph-lock-key';
      });

      // 5. Mostra testo esultanza se PRO
      const cheer = document.getElementById('cheer-text');
      if(tier === 'PRO') cheer.classList.add('visible');
      else cheer.classList.remove('visible');
    };
    
    // Resize Handler
    window.addEventListener('resize', () => {
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
    });

  </script>
</body>
</html>
