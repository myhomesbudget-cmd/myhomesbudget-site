<!doctype html>
<html lang="it" data-app="myhomesbudget">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard — MyHomesBudget</title>
  <meta name="robots" content="noindex, nofollow" />
  <meta name="description" content="Gestione intelligente del budget domestico" />
  <link rel="icon" href="/homes.png" type="image/png" sizes="32x32">

  <script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=LHrTmnecqKdPRiIRGu9K5wtIl14aFHRWoPYl4zelOj4FNPYM47_WAWsIfgZu-fcGG-YSs61LyQ70itB37UL5kvakYazBHWcDvrgDL4pqbUWFhAep_uXhhB7tBr2WO49Smf6WP0Sg6GNQ1nA9wTfLQP7-moaisA6q6i1v9b_MDUt_jrqSBbIeAx0SMMP9fRUUaY1VYT5VGHXQpNzfwQQDXNgjTqO6OtIAd_3LhR3wwPWY4zBRn4wH9FYtZKbnxdZBoEVTMlUOGughqMqvGaui0FeWDPf2JCNhFK55GdxHTX-qZbHbEq7kDyUimis5DgYDpNAB1AWOP7g-p6T1kvl_WsVJC6OWXrGwk3YS_KrwQAQLwcnCiuWV6lbbp0cNlITSsRsrCTgcXHlJxTheNPhJJXfbpY2JJTWcAR8I98pndqHvvbiavEH1A7WDUfd1jZ2fdajhJCzg1yNdFQdlpUbw8Nry08aoXaw_Q-_-tLI4ra2j90NoDT-vTBm1N1bAHFK3Jtn9MTr0ajM0-zOW4FTJ-Z1E-jTQRPqRpYIa2Dann6c8zsLMsb776YbksCAbZbcA5xkDOgg77rZCi3ClauO8dXghq0LuZyGStWIybss4v9RyLwhpeGp1tbyiHzJkhVFuwtBSbl4nTzVc0y2UGR46PiqWREGBdD9_TgZADwKl38ZSvRAwPlgQuhjtG-3K_8d7Q2bDgmyCMTnRUdeucdZQ0wM4DgN8r6sffUuYA9Zk01wAeas-80pSG0y0OkyRZ9K9-rUxYuyha2k7xaj6v-oZZc2BVi3wKbqmx-nPiE9PHRY_hC3BFX4BmP4MjKWOAhpzYzlcJisUqsva_aCIambC_baPWcGzHJWyRMf2brlhyjHh48MOqHTSa6vcdrug2cV6GtzLj1C_dXNacNnB0O6eJhCtK9Va5eQMy1emJz5BG5p4buYX9znL3E10Nm_qhuvMldGH2-aprAgtcM3zvviPSFxKVxDCHBqex1OpxBOx2HYjreyFAqsRAjEbEoRIW8H73aAJS7lxu4Js_p_gNSQCDDnVyqOlShGdUXJntF3qnSTJhLtJAuaRVyvltmfmnNXYhClmyVVADG1g-wRF0OhWB4pTlZQGMJRd2cR_vzqfMm9mf_874GaWMDUX_3eT7XlaNygKWpHkuBiCAE8JxNwlrRCXhCrmipOsSnoe--CZWuT1FjwZXeCYshI7dClG0feUnu9dzQtvaI6Z85ZC0bR9Ty_9E5f8BlW-ND-chINUUPBQ8i8A_rX6iYE4YpgEFXGDCNevYKtUps3SREwL5h-TWYnoQbCwZ4BXsNvxYHZ6j-ZXXuvltbS7fre1F_ClVdczlfYvMGELZn5i9dIzCZ25W1rKtzJKb1L7E91YOppuDl-2iUnSz4t5DZDEWx8sSMKo75NnMJo0YdMxJgwF6IQc01q1sFjtoL30x76v3pSQ01CYb-zrm_JiuLDmy8OyA8ptpldxZimSRbyBl4SzeVgKPQmqS0vF7cgHBY205wNkhh3UOwKaxJU4etF3yOIsUsx0ZcaZKtIrbOEbogD8v_32PIETKQhMhw1nTPg1kkZy73eUDG9_PVjn7FGnFH-0liMPsEyMZNbkS-T27CNYIhSy68JTVT7sH-T0CM-8fYIxeEL9x48Pg5KXctqcpIJVaYD2fn0j0QGWQ3sRPfEATMt_Twlnwkokxl85lXJJNl7FY6fOKbv9FkMGqMn4wZrmIb4PMScIOsFMy3nERaXap2QgEo-OGhJRvr6XXNoIpW235x0Us0wgdv_9SkDEzsvDIBDCb-Rn4VxE-o8PVlF_eDhjJuyTBgOY3X1vrxgv9ibuyLJIjWCwEHnoIgr_o54WwtdD5Ao9UtEIr8e9nwEdFJPfhyruGef4AiDQMgRGZSAvPYF8erTqnf_s2pRKTFZQtno8K24OAEP71Lyxn9TI6lNRWUDwJ1K4rpWFy9HT4iiHdfRYCGtzckWpfCxKrv_a4bTRLx_ELuvligIMfOcs7rqORF50OBZ6tuUPBAt5LvLgQr6duXh3WzbQmdlspvQk9L_u3lZIgKSPXe2Sqq2GlT9aY261Y5Z10e9mbjIxRgSw8YNUpWGsqqMHGPqZING8PnRno-wjrYqh83Dvn3K-chfteOkll_sh8XSpTw4BbGWniq8zfcffy5r0bnZh9RAO4xAGXNbVz-iWbsfhXxorkr0Gp6z6Ar_g14U1kpsfaawDzV9ggz73HlR6Z5NxT5DklDdbDJGPayj3EKACbv9ToE4crGwvpX9-X5VaBzIwThupl1xcU_rBIjgqtfy3aoETRIer3kXft3VUIL3_EiCQgmY4YQ71otRgHl1ZWAO-fUJwqryc2aXNl_m5_cv684vl1Rji" charset="UTF-8"></script><style>
    /* ============================================
       VARIABLES & RESET
       ============================================ */
    :root {
      --fg: #111;
      --bg: #f4f7fa;
      --glass: rgba(255, 255, 255, 0.6);
      --card-border: rgba(0, 0, 0, 0.08);
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.12);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --primary-color: #6c5ce7;
      --primary-hover: #5f4dd4;
      --danger-color: #d32f2f;
      --danger-hover: #b71c1c;
      --success-color: #2e7d32;
      --success-hover: #1b5e20;
      --warning-color: #f39c12;
      --warning-hover: #e67e22;
      --info-color: #00cec9;
      --font-sans: -apple-system, system-ui, "Segoe UI", Roboto, sans-serif;
      --grad: linear-gradient(135deg, #6c5ce7, #00cec9);
      --grad-danger: linear-gradient(135deg, #d32f2f, #ff7675);
      --grad-warning: linear-gradient(135deg, #f39c12, #fdd835);
      --grad-success: linear-gradient(135deg, #2e7d32, #66bb6a);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      font-family: var(--font-sans);
      background-color: var(--bg);
      font-size: 16px;
      line-height: 1.6;
    }

    body {
      margin: 0;
      color: var(--fg);
      min-height: 100svh;
      -webkit-overflow-scrolling: touch;
      position: relative;
    }

    /* ============================================
       BACKGROUND LAYER
       ============================================ */
    #bg {
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events: none;
    }

    #bg img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      image-rendering: auto;
      transform: translateZ(0);
      will-change: transform;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, rgba(108, 92, 231, 0.05), rgba(0, 206, 201, 0.05));
      z-index: 0;
      pointer-events: none;
    }

    /* ============================================
       TOPBAR
       ============================================ */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--glass);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--card-border);
      padding: 1rem 1.5rem;
      box-shadow: var(--shadow);
    }

    .topbar-container {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }

    .topbar-logo {
      font-size: 1.25rem;
      font-weight: 700;
      background: var(--grad);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-decoration: none;
    }

    .topbar-balance {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.125rem;
      font-weight: 600;
    }

    .topbar-actions {
      display: flex;
      gap: 0.5rem;
    }

    /* ============================================
       MAIN LAYOUT
       ============================================ */
    main {
      position: relative;
      z-index: 1;
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    /* ============================================
       CARDS
       ============================================ */
    .card {
      background: var(--glass);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      box-shadow: var(--shadow);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--card-border);
    }

    .card-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--fg);
    }

    .card-body {
      flex: 1;
    }

    /* Summary Cards */
    .summary-card {
      text-align: center;
      padding: 2rem 1.5rem;
    }

    .summary-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    .summary-label {
      font-size: 0.875rem;
      color: rgba(0, 0, 0, 0.6);
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 500;
    }

    .summary-value {
      font-size: 2rem;
      font-weight: 700;
      background: var(--grad);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .summary-value.income {
      background: var(--grad-success);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .summary-value.expense {
      background: var(--grad-danger);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* ============================================
       BUTTONS
       ============================================ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--radius-md);
      font-family: var(--font-sans);
      font-size: 0.9375rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      white-space: nowrap;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-primary {
      background: var(--grad);
      color: white;
      box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(108, 92, 231, 0.4);
    }

    .btn-danger {
      background: var(--grad-danger);
      color: white;
      box-shadow: 0 4px 15px rgba(211, 47, 47, 0.3);
    }

    .btn-danger:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(211, 47, 47, 0.4);
    }

    .btn-success {
      background: var(--grad-success);
      color: white;
      box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
    }

    .btn-success:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
    }

    .btn-secondary {
      background: rgba(0, 0, 0, 0.05);
      color: var(--fg);
    }

    .btn-secondary:hover:not(:disabled) {
      background: rgba(0, 0, 0, 0.1);
    }

    .btn-icon {
      padding: 0.75rem;
      aspect-ratio: 1;
    }

    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
    }

    /* ============================================
       FORMS
       ============================================ */
    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      font-size: 0.9375rem;
      color: var(--fg);
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 1px solid var(--card-border);
      border-radius: var(--radius-md);
      font-family: var(--font-sans);
      font-size: 1rem;
      background: white;
      transition: var(--transition);
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-error {
      color: var(--danger-color);
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }

    /* ============================================
       TRANSACTIONS LIST
       ============================================ */
    .transaction-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .transaction-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: white;
      border: 1px solid var(--card-border);
      border-radius: var(--radius-md);
      transition: var(--transition);
    }

    .transaction-item:hover {
      border-color: var(--primary-color);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .transaction-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      font-size: 1.25rem;
      flex-shrink: 0;
    }

    .transaction-icon.income {
      background: rgba(46, 125, 50, 0.1);
      color: var(--success-color);
    }

    .transaction-icon.expense {
      background: rgba(211, 47, 47, 0.1);
      color: var(--danger-color);
    }

    .transaction-details {
      flex: 1;
      min-width: 0;
    }

    .transaction-name {
      font-weight: 600;
      margin-bottom: 0.25rem;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .transaction-meta {
      font-size: 0.875rem;
      color: rgba(0, 0, 0, 0.6);
    }

    .transaction-amount {
      font-weight: 700;
      font-size: 1.125rem;
      flex-shrink: 0;
    }

    .transaction-amount.income {
      color: var(--success-color);
    }

    .transaction-amount.expense {
      color: var(--danger-color);
    }

    /* ============================================
       GOALS SECTION
       ============================================ */
    .goals-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-top: 1rem;
    }

    .goal-card {
      background: white;
      border: 1px solid var(--card-border);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      transition: var(--transition);
    }

    .goal-card:hover {
      box-shadow: var(--shadow);
      transform: translateY(-2px);
    }

    .goal-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
    }

    .goal-title {
      font-weight: 600;
      font-size: 1.125rem;
      margin-bottom: 0.25rem;
    }

    .goal-target {
      font-size: 0.875rem;
      color: rgba(0, 0, 0, 0.6);
    }

    .goal-progress {
      margin: 1rem 0;
    }

    .progress-bar-bg {
      width: 100%;
      height: 8px;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background: var(--grad);
      border-radius: 999px;
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .goal-stats {
      display: flex;
      justify-content: space-between;
      font-size: 0.875rem;
      margin-top: 0.5rem;
    }

    .goal-current {
      font-weight: 600;
      color: var(--primary-color);
    }

    .goal-percentage {
      font-weight: 600;
      color: rgba(0, 0, 0, 0.6);
    }

    /* ============================================
       MODALS
       ============================================ */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      animation: fadeIn 0.2s ease-out;
    }

    .modal.active {
      display: flex;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .modal-content {
      background: white;
      border-radius: var(--radius-lg);
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes slideUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      border-bottom: 1px solid var(--card-border);
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 700;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.25rem;
      line-height: 1;
      color: rgba(0, 0, 0, 0.5);
      transition: var(--transition);
    }

    .modal-close:hover {
      color: var(--fg);
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      padding: 1.5rem;
      border-top: 1px solid var(--card-border);
    }

    /* ============================================
       BADGES & CHIPS
       ============================================ */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge-primary {
      background: rgba(108, 92, 231, 0.1);
      color: var(--primary-color);
    }

    .badge-success {
      background: rgba(46, 125, 50, 0.1);
      color: var(--success-color);
    }

    .badge-danger {
      background: rgba(211, 47, 47, 0.1);
      color: var(--danger-color);
    }

    .badge-warning {
      background: rgba(243, 156, 18, 0.1);
      color: var(--warning-color);
    }

    /* ============================================
       UTILITIES
       ============================================ */
    .text-center {
      text-align: center;
    }

    .mt-1 { margin-top: 0.5rem; }
    .mt-2 { margin-top: 1rem; }
    .mt-3 { margin-top: 1.5rem; }
    .mt-4 { margin-top: 2rem; }

    .mb-1 { margin-bottom: 0.5rem; }
    .mb-2 { margin-bottom: 1rem; }
    .mb-3 { margin-bottom: 1.5rem; }
    .mb-4 { margin-bottom: 2rem; }

    .hidden {
      display: none !important;
    }

    /* ============================================
       RESPONSIVE
       ============================================ */
    @media (max-width: 768px) {
      .topbar {
        padding: 0.75rem 1rem;
      }

      .topbar-logo {
        font-size: 1.125rem;
      }

      .topbar-balance {
        font-size: 1rem;
      }

      main {
        padding: 1.5rem 1rem;
      }

      .dashboard-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .card {
        padding: 1rem;
      }

      .summary-card {
        padding: 1.5rem 1rem;
      }

      .summary-value {
        font-size: 1.75rem;
      }

      .modal-content {
        max-width: 100%;
        max-height: 95vh;
      }

      .btn {
        padding: 0.625rem 1.25rem;
        font-size: 0.875rem;
      }
    }

    /* ============================================
       LOADING & ANIMATIONS
       ============================================ */
    .spinner {
      border: 3px solid rgba(0, 0, 0, 0.1);
      border-top-color: var(--primary-color);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .loading-container {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 200px;
    }

    /* ============================================
       ACCORDION (Mobile)
       ============================================ */
    .accordion {
      border: 1px solid var(--card-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      background: white;
    }

    .accordion-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.25rem;
      cursor: pointer;
      user-select: none;
      transition: var(--transition);
      background: white;
    }

    .accordion-header:hover {
      background: rgba(0, 0, 0, 0.02);
    }

    .accordion-title {
      font-weight: 600;
      font-size: 1rem;
    }

    .accordion-icon {
      transition: transform 0.3s ease;
      font-size: 1.25rem;
      color: rgba(0, 0, 0, 0.5);
    }

    .accordion.active .accordion-icon {
      transform: rotate(180deg);
    }

    .accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .accordion.active .accordion-content {
      max-height: 2000px;
    }

    .accordion-body {
      padding: 0 1.25rem 1.25rem;
    }

    /* ============================================
       EMPTY STATES
       ============================================ */
    .empty-state {
      text-align: center;
      padding: 3rem 1.5rem;
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.3;
    }

    .empty-state-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--fg);
    }

    .empty-state-text {
      color: rgba(0, 0, 0, 0.6);
      margin-bottom: 1.5rem;
    }
  </style>
</head>
<body>
  <!-- Background Layer -->
  <div id="bg">
    <img src="/path/to/background.jpg" alt="" aria-hidden="true" />
  </div>

  <!-- Topbar -->
  <header class="topbar">
    <div class="topbar-container">
      <a href="/" class="topbar-logo">🏠 MyHomesBudget</a>

      <div class="topbar-balance">
        <span>Saldo:</span>
        <span id="topbar-balance-value">€ 0,00</span>
      </div>

      <div class="topbar-actions">
        <button class="btn btn-primary btn-sm" id="btn-new-transaction">
          ➕ Nuova
        </button>
        <button class="btn btn-secondary btn-icon btn-sm" id="btn-user-menu">
          👤
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main>
    <!-- Summary Cards -->
    <div class="dashboard-grid">
      <div class="card summary-card">
        <div class="summary-icon">💰</div>
        <div class="summary-label">Entrate Totali</div>
        <div class="summary-value income" id="summary-income">€ 0,00</div>
      </div>

      <div class="card summary-card">
        <div class="summary-icon">💸</div>
        <div class="summary-label">Uscite Totali</div>
        <div class="summary-value expense" id="summary-expense">€ 0,00</div>
      </div>

      <div class="card summary-card">
        <div class="summary-icon">📊</div>
        <div class="summary-label">Saldo Corrente</div>
        <div class="summary-value" id="summary-balance">€ 0,00</div>
      </div>
    </div>

    <!-- Upcoming Deadlines -->
    <section class="card mb-4">
      <div class="card-header">
        <h2 class="card-title">🔔 Scadenze & Incassi (30gg)</h2>
        <button class="btn btn-secondary btn-sm" id="btn-add-deadline">
          ➕ Aggiungi
        </button>
      </div>
      <div class="card-body">
        <div id="deadlines-list" class="transaction-list">
          <div class="empty-state">
            <div class="empty-state-icon">📅</div>
            <div class="empty-state-title">Nessuna scadenza</div>
            <div class="empty-state-text">
              Aggiungi le tue scadenze per tenerle sotto controllo
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Goals Section -->
    <section class="card mb-4">
      <div class="card-header">
        <h2 class="card-title">🎯 Obiettivi Finanziari</h2>
        <button class="btn btn-secondary btn-sm" id="btn-add-goal">
          ➕ Nuovo Obiettivo
        </button>
      </div>
      <div class="card-body">
        <div id="goals-container" class="goals-container">
          <div class="empty-state">
            <div class="empty-state-icon">🎯</div>
            <div class="empty-state-title">Nessun obiettivo</div>
            <div class="empty-state-text">
              Imposta i tuoi obiettivi finanziari e monitora i progressi
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Recent Income -->
    <section class="card mb-4">
      <div class="card-header">
        <h2 class="card-title">💰 Entrate Recenti</h2>
        <button class="btn btn-secondary btn-sm" id="btn-filter-income">
          🔍 Filtra
        </button>
      </div>
      <div class="card-body">
        <div id="income-list" class="transaction-list">
          <div class="empty-state">
            <div class="empty-state-icon">💰</div>
            <div class="empty-state-title">Nessuna entrata</div>
            <div class="empty-state-text">
              Le tue entrate appariranno qui
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Recent Expenses -->
    <section class="card mb-4">
      <div class="card-header">
        <h2 class="card-title">💸 Uscite Recenti</h2>
        <button class="btn btn-secondary btn-sm" id="btn-filter-expense">
          🔍 Filtra
        </button>
      </div>
      <div class="card-body">
        <div id="expense-list" class="transaction-list">
          <div class="empty-state">
            <div class="empty-state-icon">💸</div>
            <div class="empty-state-title">Nessuna uscita</div>
            <div class="empty-state-text">
              Le tue uscite appariranno qui
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal: New Transaction -->
  <div id="modal-transaction" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Nuova Transazione</h3>
        <button class="modal-close" aria-label="Chiudi">&times;</button>
      </div>
      <form id="transaction-form">
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label" for="kind">Tipo</label>
            <select id="kind" name="kind" class="form-select" required>
              <option value="">Seleziona tipo</option>
              <option value="income">💰 Entrata</option>
              <option value="expense">💸 Uscita</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label" for="category_id">Categoria</label>
            <select id="category_id" name="category_id" class="form-select" required>
              <option value="">Seleziona categoria</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label" for="amount">Importo (€)</label>
            <input
              type="number"
              id="amount"
              name="amount"
              class="form-input"
              step="0.01"
              min="0"
              placeholder="0.00"
              required
            />
          </div>

          <div class="form-group">
            <label class="form-label" for="description">Descrizione</label>
            <input
              type="text"
              id="description"
              name="description"
              class="form-input"
              placeholder="Es: Spesa supermercato"
              required
            />
          </div>

          <div class="form-group">
            <label class="form-label" for="transaction_date">Data</label>
            <input
              type="date"
              id="transaction_date"
              name="transaction_date"
              class="form-input"
              required
            />
          </div>

          <div class="form-group">
            <label class="form-label" for="notes">Note (opzionale)</label>
            <textarea
              id="notes"
              name="notes"
              class="form-textarea"
              placeholder="Aggiungi note aggiuntive..."
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="btn-cancel-transaction">
            Annulla
          </button>
          <button type="submit" class="btn btn-primary">
            💾 Salva
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: New Goal -->
  <div id="modal-goal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Nuovo Obiettivo</h3>
        <button class="modal-close" aria-label="Chiudi">&times;</button>
      </div>
      <form id="goal-form">
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label" for="goal_name">Nome Obiettivo</label>
            <input
              type="text"
              id="goal_name"
              name="goal_name"
              class="form-input"
              placeholder="Es: Vacanza estiva"
              required
            />
          </div>

          <div class="form-group">
            <label class="form-label" for="goal_target">Importo Obiettivo (€)</label>
            <input
              type="number"
              id="goal_target"
              name="goal_target"
              class="form-input"
              step="0.01"
              min="0"
              placeholder="0.00"
              required
            />
          </div>

          <div class="form-group">
            <label class="form-label" for="goal_current">Importo Attuale (€)</label>
            <input
              type="number"
              id="goal_current"
              name="goal_current"
              class="form-input"
              step="0.01"
              min="0"
              placeholder="0.00"
              value="0"
            />
          </div>

          <div class="form-group">
            <label class="form-label" for="goal_deadline">Scadenza (opzionale)</label>
            <input
              type="date"
              id="goal_deadline"
              name="goal_deadline"
              class="form-input"
            />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="btn-cancel-goal">
            Annulla
          </button>
          <button type="submit" class="btn btn-primary">
            🎯 Crea Obiettivo
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- JavaScript -->
  <script type="module">
    // ============================================
    // CONFIGURATION
    // ============================================
    // Import Supabase client from your existing configuration
    // import { supabase } from "/it/supabase-client.js";
    // window.supabase = supabase;

    // For demo purposes, we'll use a mock API
    const USE_MOCK_DATA = true;

    // ============================================
    // STATE MANAGEMENT
    // ============================================
    const state = {
      user: null,
      profile: null,
      categories: [],
      subcategories: [],
      transactions: [],
      goals: [],
      deadlines: []
    };

    // ============================================
    // UTILITY FUNCTIONS
    // ============================================
    const formatCurrency = (amount) => {
      return new Intl.NumberFormat('it-IT', {
        style: 'currency',
        currency: 'EUR'
      }).format(amount);
    };

    const formatDate = (dateString) => {
      return new Intl.DateTimeFormat('it-IT', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      }).format(new Date(dateString));
    };

    const formatDateShort = (dateString) => {
      return new Intl.DateTimeFormat('it-IT', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      }).format(new Date(dateString));
    };

    // ============================================
    // MODAL MANAGEMENT
    // ============================================
    const modalController = {
      open: (modalId) => {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.classList.add('active');
          document.body.style.overflow = 'hidden';
        }
      },

      close: (modalId) => {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.classList.remove('active');
          document.body.style.overflow = '';
        }
      },

      closeAll: () => {
        document.querySelectorAll('.modal').forEach(modal => {
          modal.classList.remove('active');
        });
        document.body.style.overflow = '';
      }
    };

    // Close modal on backdrop click
    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modalController.close(modal.id);
        }
      });
    });

    // Close buttons
    document.querySelectorAll('.modal-close').forEach(btn => {
      btn.addEventListener('click', () => {
        modalController.closeAll();
      });
    });

    // ============================================
    // DATA FETCHING
    // ============================================
    const mockData = {
      categories: [
        { id: 1, name: 'Stipendio', icon: '💼', kind: 'income' },
        { id: 2, name: 'Freelance', icon: '💻', kind: 'income' },
        { id: 3, name: 'Investimenti', icon: '📈', kind: 'income' },
        { id: 4, name: 'Alimentari', icon: '🛒', kind: 'expense' },
        { id: 5, name: 'Trasporti', icon: '🚗', kind: 'expense' },
        { id: 6, name: 'Utenze', icon: '💡', kind: 'expense' },
        { id: 7, name: 'Intrattenimento', icon: '🎬', kind: 'expense' },
        { id: 8, name: 'Salute', icon: '⚕️', kind: 'expense' }
      ],
      transactions: [
        {
          id: 1,
          kind: 'income',
          category_id: 1,
          amount: 2500.00,
          description: 'Stipendio Ottobre',
          transaction_date: '2025-10-01',
          notes: ''
        },
        {
          id: 2,
          kind: 'expense',
          category_id: 4,
          amount: 85.50,
          description: 'Spesa supermercato',
          transaction_date: '2025-10-02',
          notes: 'Spesa settimanale'
        },
        {
          id: 3,
          kind: 'expense',
          category_id: 6,
          amount: 120.00,
          description: 'Bolletta luce',
          transaction_date: '2025-10-03',
          notes: ''
        }
      ],
      goals: [
        {
          id: 1,
          name: 'Vacanza Estiva 2026',
          target_amount: 3000.00,
          current_amount: 850.00,
          deadline: '2026-06-01'
        },
        {
          id: 2,
          name: 'Fondo Emergenze',
          target_amount: 10000.00,
          current_amount: 4200.00,
          deadline: null
        }
      ]
    };

    const dataService = {
      async fetchCategories() {
        if (USE_MOCK_DATA) {
          return mockData.categories;
        }
        // Real Supabase query
        // const { data, error } = await supabase
        //   .from('categories')
        //   .select('*')
        //   .order('name');
        // return data || [];
      },

      async fetchTransactions() {
        if (USE_MOCK_DATA) {
          return mockData.transactions;
        }
        // Real Supabase query
        // const { data, error } = await supabase
        //   .from('transactions')
        //   .select('*')
        //   .order('transaction_date', { ascending: false });
        // return data || [];
      },

      async fetchGoals() {
        if (USE_MOCK_DATA) {
          return mockData.goals;
        }
        // Real Supabase query
        // const { data, error } = await supabase
        //   .from('goals')
        //   .select('*')
        //   .order('created_at', { ascending: false });
        // return data || [];
      },

      async saveTransaction(transaction) {
        if (USE_MOCK_DATA) {
          const newTransaction = {
            ...transaction,
            id: state.transactions.length + 1
          };
          state.transactions.unshift(newTransaction);
          return newTransaction;
        }
        // Real Supabase insert
        // const { data, error } = await supabase
        //   .from('transactions')
        //   .insert([transaction])
        //   .select()
        //   .single();
        // return data;
      },

      async saveGoal(goal) {
        if (USE_MOCK_DATA) {
          const newGoal = {
            ...goal,
            id: state.goals.length + 1
          };
          state.goals.push(newGoal);
          return newGoal;
        }
        // Real Supabase insert
        // const { data, error } = await supabase
        //   .from('goals')
        //   .insert([goal])
        //   .select()
        //   .single();
        // return data;
      }
    };

    // ============================================
    // UI RENDERING
    // ============================================
    const ui = {
      updateSummary() {
        const income = state.transactions
          .filter(t => t.kind === 'income')
          .reduce((sum, t) => sum + parseFloat(t.amount), 0);

        const expense = state.transactions
          .filter(t => t.kind === 'expense')
          .reduce((sum, t) => sum + parseFloat(t.amount), 0);

        const balance = income - expense;

        document.getElementById('summary-income').textContent = formatCurrency(income);
        document.getElementById('summary-expense').textContent = formatCurrency(expense);
        document.getElementById('summary-balance').textContent = formatCurrency(balance);
        document.getElementById('topbar-balance-value').textContent = formatCurrency(balance);
      },

      renderTransaction(transaction) {
        const category = state.categories.find(c => c.id === transaction.category_id);
        const isIncome = transaction.kind === 'income';

        return `
          <div class="transaction-item">
            <div class="transaction-icon ${transaction.kind}">
              ${category?.icon || (isIncome ? '💰' : '💸')}
            </div>
            <div class="transaction-details">
              <div class="transaction-name">${transaction.description}</div>
              <div class="transaction-meta">
                ${category?.name || 'Altro'} • ${formatDateShort(transaction.transaction_date)}
              </div>
            </div>
            <div class="transaction-amount ${transaction.kind}">
              ${isIncome ? '+' : '-'} ${formatCurrency(Math.abs(transaction.amount))}
            </div>
          </div>
        `;
      },

      renderGoal(goal) {
        const percentage = Math.min(100, (goal.current_amount / goal.target_amount) * 100);

        return `
          <div class="goal-card">
            <div class="goal-header">
              <div>
                <div class="goal-title">${goal.name}</div>
                <div class="goal-target">Obiettivo: ${formatCurrency(goal.target_amount)}</div>
                ${goal.deadline ? `<div class="goal-target">Scadenza: ${formatDateShort(goal.deadline)}</div>` : ''}
              </div>
            </div>
            <div class="goal-progress">
              <div class="progress-bar-bg">
                <div class="progress-bar-fill" style="width: ${percentage}%"></div>
              </div>
              <div class="goal-stats">
                <span class="goal-current">${formatCurrency(goal.current_amount)}</span>
                <span class="goal-percentage">${percentage.toFixed(1)}%</span>
              </div>
            </div>
          </div>
        `;
      },

      updateTransactionLists() {
        const incomeTransactions = state.transactions.filter(t => t.kind === 'income');
        const expenseTransactions = state.transactions.filter(t => t.kind === 'expense');

        // Render income
        const incomeList = document.getElementById('income-list');
        if (incomeTransactions.length > 0) {
          incomeList.innerHTML = incomeTransactions
            .slice(0, 5)
            .map(t => this.renderTransaction(t))
            .join('');
        } else {
          incomeList.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">💰</div>
              <div class="empty-state-title">Nessuna entrata</div>
              <div class="empty-state-text">Le tue entrate appariranno qui</div>
            </div>
          `;
        }

        // Render expenses
        const expenseList = document.getElementById('expense-list');
        if (expenseTransactions.length > 0) {
          expenseList.innerHTML = expenseTransactions
            .slice(0, 5)
            .map(t => this.renderTransaction(t))
            .join('');
        } else {
          expenseList.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">💸</div>
              <div class="empty-state-title">Nessuna uscita</div>
              <div class="empty-state-text">Le tue uscite appariranno qui</div>
            </div>
          `;
        }
      },

      updateGoalsList() {
        const goalsContainer = document.getElementById('goals-container');

        if (state.goals.length > 0) {
          goalsContainer.innerHTML = state.goals
            .map(g => this.renderGoal(g))
            .join('');
        } else {
          goalsContainer.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">🎯</div>
              <div class="empty-state-title">Nessun obiettivo</div>
              <div class="empty-state-text">Imposta i tuoi obiettivi finanziari e monitora i progressi</div>
            </div>
          `;
        }
      },

      populateCategorySelect() {
        const kindSelect = document.getElementById('kind');
        const categorySelect = document.getElementById('category_id');

        kindSelect.addEventListener('change', () => {
          const kind = kindSelect.value;
          const filteredCategories = state.categories.filter(c => c.kind === kind);

          categorySelect.innerHTML = '<option value="">Seleziona categoria</option>' +
            filteredCategories.map(c => 
              `<option value="${c.id}">${c.icon} ${c.name}</option>`
            ).join('');
        });
      },

      refresh() {
        this.updateSummary();
        this.updateTransactionLists();
        this.updateGoalsList();
      }
    };

    // ============================================
    // FORM HANDLERS
    // ============================================
    const forms = {
      async handleTransactionSubmit(e) {
        e.preventDefault();

        const formData = new FormData(e.target);
        const transaction = {
          kind: formData.get('kind'),
          category_id: parseInt(formData.get('category_id')),
          amount: parseFloat(formData.get('amount')),
          description: formData.get('description'),
          transaction_date: formData.get('transaction_date'),
          notes: formData.get('notes') || ''
        };

        try {
          await dataService.saveTransaction(transaction);
          e.target.reset();
          modalController.close('modal-transaction');
          ui.refresh();

          // Show success message (you can implement a toast notification)
          alert('✅ Transazione salvata con successo!');
        } catch (error) {
          console.error('Error saving transaction:', error);
          alert('❌ Errore nel salvataggio della transazione');
        }
      },

      async handleGoalSubmit(e) {
        e.preventDefault();

        const formData = new FormData(e.target);
        const goal = {
          name: formData.get('goal_name'),
          target_amount: parseFloat(formData.get('goal_target')),
          current_amount: parseFloat(formData.get('goal_current')) || 0,
          deadline: formData.get('goal_deadline') || null
        };

        try {
          await dataService.saveGoal(goal);
          e.target.reset();
          modalController.close('modal-goal');
          ui.refresh();

          alert('✅ Obiettivo creato con successo!');
        } catch (error) {
          console.error('Error saving goal:', error);
          alert('❌ Errore nella creazione dell'obiettivo');
        }
      }
    };

    // ============================================
    // EVENT LISTENERS
    // ============================================
    const setupEventListeners = () => {
      // Open modals
      document.getElementById('btn-new-transaction')?.addEventListener('click', () => {
        modalController.open('modal-transaction');
        // Set today's date as default
        document.getElementById('transaction_date').valueAsDate = new Date();
      });

      document.getElementById('btn-add-goal')?.addEventListener('click', () => {
        modalController.open('modal-goal');
      });

      // Cancel buttons
      document.getElementById('btn-cancel-transaction')?.addEventListener('click', () => {
        modalController.close('modal-transaction');
      });

      document.getElementById('btn-cancel-goal')?.addEventListener('click', () => {
        modalController.close('modal-goal');
      });

      // Form submissions
      document.getElementById('transaction-form')?.addEventListener('submit', forms.handleTransactionSubmit);
      document.getElementById('goal-form')?.addEventListener('submit', forms.handleGoalSubmit);

      // Close modal on Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          modalController.closeAll();
        }
      });
    };

    // ============================================
    // INITIALIZATION
    // ============================================
    const init = async () => {
      try {
        // Load data
        state.categories = await dataService.fetchCategories();
        state.transactions = await dataService.fetchTransactions();
        state.goals = await dataService.fetchGoals();

        // Setup UI
        ui.populateCategorySelect();
        ui.refresh();
        setupEventListeners();

        console.log('✅ Dashboard initialized successfully');
      } catch (error) {
        console.error('❌ Error initializing dashboard:', error);
      }
    };

    // Start the application
    init();
  </script>
</body>
</html>
