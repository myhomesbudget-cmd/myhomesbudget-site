<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fine Periodo di Prova — MyHomesBudget</title>
  <meta name="description" content="Il tuo periodo di prova è terminato. Scegli un piano per continuare a usare MyHomesBudget senza limiti.">
  <meta name="robots" content="noindex, nofollow">
  <meta name="color-scheme" content="light dark">

  <!-- CSP -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src 'self' https: data:;
                 style-src 'self' 'unsafe-inline';
                 script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com;
                 connect-src 'self' https://www.google-analytics.com https://region1.google-analytics.com https://upcusjlumfeadgbhziwq.supabase.co;
                 font-src 'self' https: data:;
                 frame-ancestors 'none';
                 base-uri 'self';
                 form-action 'self'">

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LSD3V9G957"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-LSD3V9G957', { anonymize_ip: true });
  </script>

  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
  <link rel="preconnect" href="https://www.google-analytics.com" crossorigin>
  <link rel="icon" href="/favicon.ico">

  <style>
    :root{
      --fg:#111; --glass:rgba(255,255,255,.58); --glass-strong:rgba(255,255,255,.68);
      --card-border:rgba(0,0,0,.06); --shadow:0 10px 30px rgba(0,0,0,.10);
      --radius-lg:16px; --radius-md:12px; --grad:linear-gradient(135deg,#6c5ce7,#00cec9);
    }
    *{box-sizing:border-box}
    html, body { font-family:-apple-system,system-ui,"Segoe UI",Roboto,sans-serif }
    body{
      margin:0; color:#fff; background:url("/bg.webp") no-repeat center center / cover fixed;
      min-height:100vh; display:flex; align-items:center; justify-content:center;
    }
    body::before{content:""; position:fixed; inset:0; background:rgba(0,0,0,.08); z-index:-1}
    .topbar{
      position:fixed; top:16px; left:50%; transform:translateX(-50%);
      width:min(920px, calc(100% - 40px)); z-index:20; pointer-events:none;
      display:flex; justify-content:flex-start;
    }
    .logo-link{display:flex; align-items:center; gap:8px; text-decoration:none; pointer-events:auto}
    .logo-image{height:32px}
    .logo-text{font-weight:600; color:#fff; font-size:1.05rem; text-shadow:0 1px 2px rgba(0,0,0,.35)}
    .paywall-panel{
      width:min(920px, calc(100% - 40px)); background:var(--glass);
      backdrop-filter:saturate(1.1) blur(8px); -webkit-backdrop-filter:saturate(1.1) blur(5px);
      color:var(--fg); border-radius:var(--radius-lg); padding:clamp(18px,4vw,26px); box-shadow:var(--shadow);
    }
    .header{text-align:center; margin-bottom:16px}
    .plans{
      background:var(--glass-strong); border:1px solid var(--card-border); border-radius:var(--radius-lg);
      padding:14px; display:grid; grid-template-columns:1fr 1fr; gap:14px; margin:14px 0 18px;
    }
    @media(max-width:680px){ .plans{ grid-template-columns:1fr } }
    .price-card{
      background:rgba(255,255,255,.52); border:1px solid var(--card-border); border-radius:var(--radius-md);
      padding:16px; text-align:center; box-shadow:var(--shadow);
      display:flex; flex-direction:column; gap:12px; justify-content:center;
    }
    .plan-title{margin:0; font-size:1.08rem}
    .cta-group{display:flex; flex-direction:column; gap:8px}
    .btn{
      display:flex; align-items:center; justify-content:center;
      padding:11px 14px; border-radius:12px; font-weight:700; text-decoration:none;
      box-shadow:0 8px 22px rgba(0,0,0,.14); transition:transform .15s ease, filter .15s ease;
      color:#fff; background:var(--grad);
    }
  </style>
</head>
<body>
  <nav class="topbar">
    <a href="/it/" class="logo-link">
      <img src="/homes.png" alt="Logo MyHomesBudget" class="logo-image">
      <span class="logo-text">MyHomesBudget</span>
    </a>
  </nav>

  <main class="paywall-panel">
    <header class="header">
      <h1>Il tuo periodo di prova è terminato</h1>
      <p>Continua a usare MyHomesBudget senza limiti scegliendo un piano.</p>
    </header>

    <section class="plans">
      <article class="price-card">
        <h2 class="plan-title">Piano Mensile — 2,99€ / mese</h2>
        <div class="cta-group">
          <a class="btn" href="#" onclick="startCheckout('monthly')">Paga con Stripe</a>
          <a class="btn" href="/checkout/paypal?plan=monthly">Paga con PayPal</a>
        </div>
      </article>

      <article class="price-card">
        <h2 class="plan-title">Una Tantum — 19,99€ / per sempre</h2>
        <div class="cta-group">
          <a class="btn" href="#" onclick="startCheckout('lifetime')">Paga con Stripe</a>
          <a class="btn" href="/checkout/paypal?plan=lifetime">Paga con PayPal</a>
        </div>
      </article>
    </section>
  </main>

  <script>
    const SUPABASE_FN_URL = "https://upcusjlumfeadgbhziwq.supabase.co/functions/v1/create-checkout-session";
    const SUPABASE_ANON_KEY = "<?= la tua ANON KEY qui ?>";

    const PRICES = {
      monthly:  { priceId: "price_1S48NcDB9gH9Ve2r35nt7JRQ", mode: "subscription" },
      lifetime: { priceId: "price_1S48PBDB9gH9Ve2rIMnB6zFd", mode: "payment" }
    };

    async function startCheckout(plan) {
      try {
        const res = await fetch(SUPABASE_FN_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${SUPABASE_ANON_KEY}`
          },
          body: JSON.stringify({
            priceId: PRICES[plan].priceId,
            mode: PRICES[plan].mode
          })
        });
        const data = await res.json();
        if (data.url) {
          window.location.href = data.url;
        } else {
          alert("Errore pagamento: " + (data.error || "URL mancante"));
        }
      } catch (err) {
        console.error(err);
        alert("Impossibile avviare il pagamento.");
      }
    }
  </script>
</body>
</html>
