<!DOCTYPE html>
<html lang="it" data-app="myhomesbudget">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>Il Tuo Profilo — MyHomesBudget</title>
    <meta name="robots" content="noindex, nofollow" />
    <link rel="icon" href="/homes.png" type="image/png" sizes="32x32">

    <!-- Stile unificato dall'app -->
    <style>
      :root{
        --fg:#111;--bg:#f4f7fa;--glass:rgba(255,255,255,.6);
        --card-border:rgba(0,0,0,.08);--shadow:0 15px 35px rgba(0,0,0,.1);
        --radius-lg:16px;--primary-color:#6c5ce7;--danger-color:#d32f2f;--success-color:#2e7d32;
        --warning-color:#f39c12;
        --font-sans:-apple-system,system-ui,"Segoe UI",Roboto,sans-serif;
        --grad:linear-gradient(135deg,#6c5ce7,#00cec9);
        --grad-danger:linear-gradient(135deg,#d32f2f,#ff7675);
      }
      *{box-sizing:border-box}
      html{font-family:var(--font-sans);background-color:var(--bg)}
      body{
        margin:0;color:var(--fg);
        background:url("/bg.webp") no-repeat center/cover fixed;
        min-height:100vh;
        display: flex;
        flex-direction: column;
        overflow-x: hidden; /* Previene lo scorrimento orizzontale */
      }
      body::before{content:"";position:fixed;inset:0;background:linear-gradient(135deg,rgba(108,92,231,.05),rgba(0,206,201,.05));z-index:-1}

      /* ====== TOPBAR ====== */
      .topbar{position:fixed;top:0;left:0;right:0;height:60px;padding:0 16px;display:flex;align-items:center;justify-content:space-between;background:var(--glass);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-bottom:1px solid var(--card-border);z-index:100}
      .logo-link{display:flex;align-items:center;gap:8px;text-decoration:none}
      .logo-text{font-weight:600;color:#fff;font-size:1.1rem;text-shadow:0 1px 2px rgba(0,0,0,.35)}
      .top-center{ position: absolute; left: 50%; transform: translateX(-50%); }
      .top-actions{display:flex;gap:12px;align-items:center}
      .top-link,.top-btn{display:flex;align-items:center;justify-content:center;height:34px;color:#fff;text-decoration:none;padding:6px 12px;border-radius:10px;font-size:.9rem;font-weight:600;background:var(--grad);border:none;box-shadow:0 4px 12px rgba(0,0,0,.15);transition:transform .2s ease,filter .2s ease,box-shadow .2s ease;cursor:pointer; white-space: nowrap;}
      .top-link:hover,.top-btn:hover{transform:translateY(-2px);filter:brightness(1.08);box-shadow:0 6px 16px rgba(0,0,0,.20)}
      .notification-bell { position: relative; }
      #scheduler-btn, #notifications-btn { width: 38px; padding: 0; }
      .notification-badge { position: absolute; top: -5px; right: -5px; background: var(--danger-color); color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; font-weight: bold; display: flex; align-items: center; justify-content: center; border: 2px solid white; display: none; }
      .notification-badge.is-visible { display: flex; }
      .mobile-menu-toggle{display:none;background:var(--grad);border:none;border-radius:10px;width:40px;height:38px;cursor:pointer;padding:0;z-index:101;box-shadow:0 4px 12px rgba(0,0,0,.15)}
      .mobile-menu-toggle svg{width:24px;height:24px;stroke:#fff;stroke-width:2.5;stroke-linecap:round}

      @media (max-width: 1200px) { .top-center { display: none; } }
      @media (max-width:960px){
        .mobile-menu-toggle{display:block}
        .top-actions{position:fixed;top:70px;right:16px;background:rgba(255,255,255,0.9);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-radius:var(--radius-lg);box-shadow:var(--shadow);padding:16px;flex-direction:column;gap:16px;align-items:stretch;width:220px;transform:translateY(-20px) scale(.95);opacity:0;pointer-events:none;transition:transform .2s ease-out,opacity .2s ease-out;z-index:100;border:1px solid var(--card-border)}
        .top-actions.is-open{transform:translateY(0) scale(1);opacity:1;pointer-events:auto}
        .top-actions .top-link,.top-actions .top-btn{width:100%;text-align:center;}
        #scheduler-btn, #notifications-btn { width: 100%; }
      }

      /* ====== Contenuto Principale ====== */
      main.container{ padding: 16px; padding-top: 72px; width:100%; max-width: 1280px; margin: 0 auto; flex-grow: 1; display: flex; flex-direction: column; }
      .dash-nav{display:flex;flex-wrap: wrap;gap:8px;border-bottom:1px solid rgba(0,0,0,.1);padding-bottom:12px;margin-bottom:24px}
      .dash-nav a{text-decoration:none;padding:8px 16px;border-radius:10px;font-weight:600;transition:all .2s ease;background:rgba(255,255,255,.7);color:var(--fg);border:1px solid var(--card-border);box-shadow:0 4px 12px rgba(0,0,0,.05);}
      .dash-nav a:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,.1)}
      .dash-nav a.is-active{background:var(--grad);color:#fff;box-shadow:0 6px 16px rgba(0,0,0,.20),inset 0 1px 2px rgba(255,255,255,0.2)}
      
      /* ====== ANIMAZIONI E MIGLIORAMENTI GRAFICI ====== */
      @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
      @keyframes shimmer { 0% { background-position: -468px 0; } 100% { background-position: 468px 0; } }
      @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

      .skeleton{ animation: shimmer 1.5s linear infinite; background: linear-gradient(to right, #eeeeee 8%, #dddddd 18%, #eeeeee 33%); background-size: 800px 104px; height: 1.5rem; width: 60%; border-radius: 8px; display: inline-block; }
      .skeleton.skeleton-text { height: 1em; }
      .skeleton.skeleton-title { height: 2.2rem; width: 40%; margin-bottom: 8px; }
      .skeleton.skeleton-avatar { width: 120px; height: 120px; border-radius: 50%; }
      
      .dashboard-panel{ background:rgba(255,255,255,0.6); backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px); border-radius:var(--radius-lg);padding:16px;border:1px solid var(--card-border); box-shadow:var(--shadow); max-width: 800px; width: 100%; margin: 24px auto; animation: fadeInUp 0.5s ease-out forwards; }

      /* ====== Stili Profilo con Miglioramenti ====== */
      .profile-header{display:flex;flex-direction:column;align-items:center;text-align:center;margin-top:-80px;}
      .profile-avatar{position:relative;width:120px;height:120px;border:4px solid rgba(255,255,255,0.8);border-radius:50%;box-shadow:var(--shadow); flex-shrink: 0;}
      .profile-avatar img, .profile-avatar .skeleton-avatar{width:100%;height:100%;border-radius:50%;object-fit:cover;}
      .profile-avatar .avatar-overlay{position:absolute;inset:0;background:rgba(0,0,0,0.5);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;opacity:0;transition:opacity .3s ease;}
      .profile-avatar:hover .avatar-overlay{opacity:1;}
      .profile-avatar .avatar-overlay.is-loading{opacity:1; cursor:progress;}
      .profile-avatar .avatar-loader{width:32px; height:32px; border:4px solid rgba(255,255,255,0.3); border-top-color:#fff; border-radius:50%; animation: spin 1s linear infinite; display:none;}
      .profile-avatar .avatar-overlay.is-loading .avatar-loader{display:block;}
      .profile-avatar .avatar-overlay.is-loading svg{display:none;}
      .profile-avatar input{display:none;}
      .profile-name{font-size:2.2rem;font-weight:800;margin:16px 0 8px;min-height: 2.2rem;line-height:1.2;letter-spacing:-0.5px;}
      .profile-plan{font-size:0.9rem;font-weight:700;color: var(--primary-color);background:rgba(255,255,255,0.9);padding:6px 16px;border-radius:999px;border:1px solid var(--card-border); min-height: 1.5rem;}

      .profile-content{margin-top:24px;display:grid;gap:16px;}
      .profile-section-title{text-align:center;font-weight:700;color:#333;margin-bottom:20px;font-size:1.3rem;letter-spacing:0.5px;display:flex;align-items:center;justify-content:center;gap:8px;line-height:1.3;}
      .profile-info-row{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.6);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid var(--card-border);border-radius:var(--radius-lg);padding:16px;margin-bottom:24px;box-shadow:var(--shadow);transition: all .3s ease;}
      .profile-info-row:hover { box-shadow: 0 8px 25px rgba(0,0,0,.12); transform: translateY(-2px); }
      .info-label{font-weight:600;color:#444;display:flex;align-items:center;gap:8px;font-size:0.95rem;line-height:1.6;}
      .info-value{font-weight:500;font-size:1rem;min-height:1.5rem;line-height:1.6;}

      .personal-info-grid{display:grid;grid-template-columns:1fr;gap:0;}
      .info-field{background:rgba(255,255,255,0.6);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid var(--card-border);border-radius:var(--radius-lg);padding:16px;margin-bottom:24px;box-shadow:var(--shadow);transition: all .3s ease;}
      .info-field:hover { box-shadow: 0 8px 25px rgba(0,0,0,.12); transform: translateY(-2px); }
      .info-field label{font-size:0.8rem;font-weight:600;color:#666;display:flex; align-items:center; gap:8px; margin-bottom:4px;}
      .info-field .data-display{font-size:1rem;font-weight:500;color:#333;min-height:24px;transition: opacity .3s ease;text-align:center;line-height:1.6;}
      .info-field .data-display.is-empty{color:#888;font-style:italic;}
      .info-field .data-input{display:none;width:100%;padding:8px;border-radius:8px;border:1px solid #ccc;background:#fff;font-size:1rem;font-family:var(--font-sans); transition: opacity .3s ease; text-align: center;}
      .is-editing .info-field .data-display { display: none; }
      .is-editing .info-field .data-input { display: block; }

      .profile-actions{display:flex;justify-content:center;gap:16px;margin-top:16px;}
      .btn{cursor:pointer;border:none;border-radius:10px;padding:10px 20px;height:42px;font-weight:600;font-size:0.9rem;transition:transform .2s ease,filter .2s ease,box-shadow .2s ease;display:flex;align-items:center;justify-content:center;}
      .btn:hover:not(:disabled){transform:translateY(-2px);filter:brightness(1.08)}
      .btn:active:not(:disabled){transform:translateY(-1px) scale(0.98);}
      .btn:disabled{opacity:.6;cursor:not-allowed;}
      .btn-primary{background:var(--grad);color:#fff;box-shadow:0 10px 24px rgba(0,0,0,.18)}
      .btn-primary:hover:not(:disabled){box-shadow:0 14px 28px rgba(0,0,0,.22)}
      .btn-secondary{background:#f0f0f0;color:#555;border:1px solid #ddd;box-shadow:0 4px 8px rgba(0,0,0,0.05)}
      .btn-secondary:hover:not(:disabled){background:#e5e5e5;border-color:#ccc;color:#333}
      #save-button{display:none;}
      
      .status-toast{position:fixed;top:80px;left:50%;transform:translateX(-50%);padding:12px 24px;border-radius:999px;color:#fff;font-weight:600;box-shadow:0 10px 25px rgba(0,0,0,0.2);z-index:1001;opacity:0;visibility:hidden;transition:opacity .3s ease, top .3s ease, visibility .3s ease;}
      .status-toast.show{top:90px;opacity:1;visibility:visible;}
      .status-toast.success{background:var(--success-color);}
      .status-toast.error{background:var(--danger-color);}

      .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
      .modal-overlay.is-visible { opacity: 1; pointer-events: auto; }
      .modal-content { background: var(--bg); border-radius: var(--radius-lg); padding: 24px; width: 90%; max-width: 700px; max-height: 80vh; overflow-y: auto; box-shadow: var(--shadow); transform: scale(0.95); transition: transform 0.3s ease; }
      .modal-overlay.is-visible .modal-content { transform: scale(1); }
      .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--card-border); padding-bottom: 12px; margin-bottom: 16px; }
      .modal-title { margin: 0; font-size: 1.3rem; }
      .modal-close { background: none; border: none; font-size: 2rem; cursor: pointer; color: #888; line-height: 1; padding: 0; }
      .modal-body { list-style: none; padding: 0; margin: 0; }
      .deadline-item { display: grid; grid-template-columns: 1fr auto auto; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--card-border); }
      .deadline-item:last-child { border-bottom: none; }
      .item-details{display:flex;flex-direction:column;min-width:0}
      .item-details .note{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
      .item-details .category{font-size:.9rem;color:#555;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
      .item-amount{text-align:right;white-space:nowrap;flex-shrink:0; font-weight: 700;}
      .item-amount.expense{color:var(--danger-color);}
      .item-amount.income{color:var(--success-color);}
      .days-left { font-weight: 700; color: var(--warning-color); }

      @media(min-width: 640px) {
        .personal-info-grid{ grid-template-columns:1fr 1fr; }
        .dashboard-panel{ padding: 24px; }
        .profile-name{ font-size: 2rem; }
        .info-label { font-size: 1rem; }
        .info-value { font-size: 1.1rem; }
        .info-field .data-display, .info-field .data-input { font-size: 1.1rem; }
      }
      @media(min-width: 768px) {
        .topbar { padding: 0 24px; }
        main.container { padding: 24px; padding-top: 84px; }
      }

      /* PROFILE MOBILE REDESIGN - 25/09/2025 */
      
      /* Utility Classes per Gestione Testi Lunghi */
      .text-wrap {
        white-space: normal;
        word-break: break-word;
        overflow-wrap: anywhere;
      }
      
      .text-clip {
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      
      .show-more-btn {
        color: var(--primary-color);
        text-decoration: none;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        margin-left: 8px;
        padding: 2px 6px;
        border-radius: 4px;
        background: rgba(108, 92, 231, 0.1);
        transition: all 0.2s ease;
      }
      
      .show-more-btn:hover {
        background: rgba(108, 92, 231, 0.2);
        transform: translateY(-1px);
      }

      /* Typography Fluida - Mobile (≤480px) */
      body.is-mobile h1, body.is-mobile .profile-name {
        font-size: clamp(1.3rem, 6vw, 1.8rem);
        line-height: 1.2;
      }
      
      body.is-mobile h2, body.is-mobile .profile-section-title {
        font-size: clamp(1.1rem, 4.8vw, 1.4rem);
        line-height: 1.25;
      }
      
      body.is-mobile body, body.is-mobile p, body.is-mobile .info-value, body.is-mobile .data-display {
        font-size: clamp(0.95rem, 2.8vw, 1rem);
        line-height: 1.6;
        word-break: break-word;
        overflow-wrap: anywhere;
      }

      /* Typography Fluida - Tablet (481-1024px) */
      body.is-tablet h1, body.is-tablet .profile-name {
        font-size: clamp(1.6rem, 3.8vw, 2.1rem);
        line-height: 1.2;
      }
      
      body.is-tablet h2, body.is-tablet .profile-section-title {
        font-size: clamp(1.2rem, 3.2vw, 1.6rem);
        line-height: 1.25;
      }

      /* Layout Mobile Stacked per dettagli profilo */
      body.is-mobile .profile-info-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
        text-align: left;
      }
      
      body.is-mobile .profile-info-row .info-label {
        font-weight: 600;
        color: #333;
        font-size: 0.9rem;
      }
      
      body.is-mobile .profile-info-row .info-value {
        font-weight: 500;
        color: #555;
        font-size: 1rem;
        word-break: break-word;
        overflow-wrap: anywhere;
        min-width: 0;
      }
      
      body.is-mobile .info-field {
        text-align: left;
      }
      
      body.is-mobile .info-field .data-display,
      body.is-mobile .info-field .data-input {
        text-align: left;
        word-break: break-word;
        overflow-wrap: anywhere;
        min-width: 0;
      }

      /* Pulsanti e Input con Tap Target */
      body.is-mobile button, body.is-mobile .btn, body.is-mobile [role="button"] {
        min-height: 44px;
        padding: 10px 14px;
        font-size: 0.95rem;
        border-radius: 12px;
      }
      
      body.is-mobile input, body.is-mobile select, body.is-mobile textarea {
        min-height: 44px;
        padding: 12px;
        font-size: 1rem;
        border-radius: 12px;
      }
      
      body.is-mobile .top-btn, body.is-mobile .top-link {
        min-height: 44px;
        padding: 12px 16px;
        font-size: 0.95rem;
        border-radius: 12px;
      }

      /* Card e Contenitori */
      body.is-mobile main.container {
        padding: 16px;
        padding-top: 72px;
      }
      
      body.is-mobile .dashboard-panel,
      body.is-mobile .profile-info-row,
      body.is-mobile .info-field {
        border-radius: 16px;
        padding: 16px;
      }
      
      body.is-mobile .dashboard-panel {
        margin: 16px auto;
      }
      
      body.is-mobile .profile-info-row,
      body.is-mobile .info-field {
        margin-bottom: 16px;
        gap: 12px;
      }
      
      body.is-mobile .profile-content > section {
        margin-bottom: 20px;
      }

      /* Tabelle/Listati con Scroll Orizzontale */
      body.is-mobile .modal-body {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      body.is-mobile .deadline-item {
        table-layout: fixed;
        min-width: 300px;
        white-space: nowrap;
      }
      
      body.is-mobile .item-details .note,
      body.is-mobile .item-details .category {
        max-width: 120px;
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: nowrap;
      }
      
      body.is-mobile .item-amount {
        white-space: nowrap;
        min-width: 80px;
      }

      /* Pulsanti Profilo */
      body.is-mobile .profile-actions {
        flex-direction: column;
        gap: 12px;
        margin-top: 20px;
      }
      
      body.is-mobile .profile-actions .btn {
        width: 100%;
        justify-content: center;
        min-height: 44px;
      }

      /* Avatar Responsive */
      body.is-mobile .profile-avatar {
        width: 100px;
        height: 100px;
      }
      
      body.is-tablet .profile-avatar {
        width: 110px;
        height: 110px;
      }

      /* Grid Responsive */
      body.is-mobile .personal-info-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      body.is-tablet .personal-info-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      /* Navigation Responsive */
      body.is-mobile .dash-nav {
        flex-direction: column;
        gap: 8px;
        margin-bottom: 20px;
      }
      
      body.is-mobile .dash-nav a {
        text-align: center;
        padding: 12px 16px;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Modal Responsive */
      body.is-mobile .modal-content {
        width: 95%;
        padding: 20px;
        max-height: 85vh;
        border-radius: 16px;
      }
      
      body.is-mobile .modal-title {
        font-size: clamp(1.1rem, 4.8vw, 1.4rem);
      }

      /* Status Toast Responsive */
      body.is-mobile .status-toast {
        left: 16px;
        right: 16px;
        transform: none;
        border-radius: 12px;
        font-size: 0.95rem;
      }

      /* Tablet Specifici */
      body.is-tablet .dashboard-panel {
        max-width: 600px;
        padding: 20px;
      }
      
      body.is-tablet .profile-actions {
        flex-direction: row;
        justify-content: center;
        gap: 16px;
      }
      
      body.is-tablet .btn {
        min-width: 120px;
        min-height: 44px;
      }

      /* Desktop Miglioramenti */
      body.is-desktop .dashboard-panel {
        max-width: 800px;
      }
      
      body.is-desktop .personal-info-grid {
        grid-template-columns: 1fr 1fr;
      }

      /* Accessibilità - Stati Focus Visibili */
      button:focus, .btn:focus, a:focus, input:focus, select:focus, textarea:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
        border-radius: 8px;
      }
      
      /* Contrasto Migliorato */
      body.is-mobile .info-label, body.is-tablet .info-label {
        color: #222;
      }
      
      body.is-mobile .info-value, body.is-tablet .info-value {
        color: #333;
      }
      
      body.is-mobile .data-display.is-empty, body.is-tablet .data-display.is-empty {
        color: #666;
      }

      /* PROFILE COMPACT MOBILE - 25/09/2025 */
      /* Modalità compatta per schermi ≤480px - Ottimizza l'altezza verticale */
      
      /* Tipografia compatta */
      body.compact-mobile h1, body.compact-mobile .profile-name {
        font-size: 1.4rem !important;
        margin-block: 8px !important;
        line-height: 1.2;
      }
      
      body.compact-mobile h2, body.compact-mobile .profile-section-title {
        font-size: 1.1rem !important;
        margin-block: 6px !important;
        line-height: 1.25;
      }
      
      body.compact-mobile body, body.compact-mobile p, body.compact-mobile .info-value, 
      body.compact-mobile .data-display, body.compact-mobile .info-label {
        font-size: 0.95rem !important;
        line-height: 1.45 !important;
      }
      
      /* Tab navigation compatti */
      body.compact-mobile .dash-nav {
        margin-bottom: 8px;
        gap: 6px;
      }
      
      body.compact-mobile .dash-nav a {
        padding: 6px 12px;
        min-height: 44px;
        font-size: 0.95rem;
        border-radius: 12px;
      }
      
      /* Card più dense */
      body.compact-mobile .dashboard-panel {
        padding: 12px;
        border-radius: 12px;
        margin: 10px auto;
        box-shadow: 0 8px 20px rgba(0,0,0,.08);
      }
      
      body.compact-mobile .profile-info-row,
      body.compact-mobile .info-field {
        padding: 12px;
        border-radius: 12px;
        margin-bottom: 10px;
        gap: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,.06);
      }
      
      body.compact-mobile .profile-content {
        gap: 10px;
      }
      
      body.compact-mobile .profile-content > section {
        margin-bottom: 12px;
      }
      
      /* Header profilo compatto */
      body.compact-mobile .profile-header {
        margin-top: -60px;
      }
      
      body.compact-mobile .profile-avatar {
        width: 72px;
        height: 72px;
        margin-bottom: 8px;
      }
      
      body.compact-mobile .profile-plan {
        font-size: 0.85rem;
        padding: 4px 12px;
        height: 24px;
        min-height: 24px;
        border-radius: 999px;
      }
      
      /* Righe dettaglio compatte */
      body.compact-mobile .profile-info-row {
        gap: 6px;
        line-height: 1.35;
      }
      
      body.compact-mobile .profile-info-row .info-label {
        font-weight: 600;
        font-size: 0.9rem;
        margin-bottom: 2px;
      }
      
      body.compact-mobile .profile-info-row .info-value {
        font-weight: 500;
        font-size: 0.95rem;
      }
      
      /* Container orizzontali compatti */
      body.compact-mobile main.container {
        padding: 12px;
        padding-top: 72px;
      }
      
      /* Pulsanti con tap target appropriati */
      body.compact-mobile button, body.compact-mobile .btn, body.compact-mobile [role="button"] {
        min-height: 40px;
        padding: 8px 12px;
        font-size: 0.9rem;
        border-radius: 10px;
      }
      
      body.compact-mobile .profile-actions {
        margin-top: 16px;
        gap: 10px;
      }
      
      /* Sezioni accordion compatte (se presenti) */
      body.compact-mobile details {
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 8px 12px;
        margin-bottom: 10px;
        background: rgba(255,255,255,0.6);
        backdrop-filter: blur(12px);
        box-shadow: 0 4px 12px rgba(0,0,0,.06);
      }
      
      body.compact-mobile summary {
        cursor: pointer;
        font-weight: 600;
        font-size: 1.05rem;
        padding: 8px 0;
        min-height: 40px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        user-select: none;
        list-style: none;
      }
      
      body.compact-mobile summary::-webkit-details-marker {
        display: none;
      }
      
      body.compact-mobile summary::after {
        content: '▼';
        font-size: 0.8rem;
        color: var(--primary-color);
        transition: transform 0.2s ease;
      }
      
      body.compact-mobile details[open] summary::after {
        transform: rotate(180deg);
      }
      
      body.compact-mobile details .personal-info-grid {
        margin-top: 8px;
        padding-top: 8px;
        border-top: 1px solid rgba(0,0,0,0.1);
      }
      
      /* Modal compatti */
      body.compact-mobile .modal-content {
        padding: 16px;
        border-radius: 16px;
        max-height: 90vh;
      }
      
      body.compact-mobile .modal-title {
        font-size: 1.1rem;
      }
      
      body.compact-mobile .modal-header {
        padding-bottom: 8px;
        margin-bottom: 12px;
      }
      
      /* Toast compatti */
      body.compact-mobile .status-toast {
        padding: 8px 16px;
        font-size: 0.9rem;
        border-radius: 10px;
      }
      
      /* Focus states accessibili */
      body.compact-mobile button:focus, body.compact-mobile .btn:focus, 
      body.compact-mobile a:focus, body.compact-mobile summary:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 1px;
      }
    </style>
</head>
<body>
    <div id="status-toast" class="status-toast"></div>

    <nav class="topbar">
      <a href="/it/dashboard.html" class="logo-link">
          <img src="/homes.png" alt="Logo" style="height:32px;border-radius:6px">
          <span class="logo-text">MyHomesBudget</span>
      </a>
      <!-- MODIFICA: Aggiunto l'elemento HTML per il bottone abbonamento -->
      <div class="top-center">
        <a href="/it/pricing.html" id="subscription-status-btn" class="top-link" style="display: none;"></a>
      </div>
      <div class="top-nav-right">
          <button id="mobile-menu-btn" class="mobile-menu-toggle" aria-label="Apri menu">
              <svg viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
          </button>
          <div class="top-actions">
              <a href="/it/onboarding.html?edit=1" class="top-link">🎯 Obiettivo</a>
              <button id="scheduler-btn" class="top-btn" aria-label="Apri scadenziario">🗓️</button>
              <button id="notifications-btn" class="top-btn notification-bell" aria-label="Apri notifiche">
                <span>🔔</span>
                <span id="notification-badge" class="notification-badge"></span>
              </button>
              <a href="#" id="logout-btn" class="top-link">Esci</a>
          </div>
      </div>
    </nav>

    <main class="container">
        <nav id="dash-nav" class="dash-nav">
          <a href="/it/profile.html" class="is-active" aria-current="page">Profilo</a>
          <a href="/it/dashboard.html">Operazioni</a>
          <a href="/it/dashboard-riepilogo.html">Riepilogo</a>
        </nav>

        <div class="dashboard-panel">
            <!-- Il contenuto del profilo verrà inserito qui dinamicamente da JavaScript -->
        </div>
    </main>

    <!-- Modal per Scadenziario/Notifiche -->
    <div id="details-modal" class="modal-overlay">
      <div class="modal-content">
          <div class="modal-header">
              <h3 id="modal-title" class="modal-title"></h3>
              <button class="modal-close">&times;</button>
          </div>
          <div id="modal-body" class="modal-body"></div>
      </div>
    </div>

    <script type="module">
        // PROFILE RESPONSIVE OPTIMIZER - Device Detection - 25/09/2025
        function updateDeviceClass() {
            const width = window.innerWidth;
            const body = document.body;
            
            // Rimuovi tutte le classi device esistenti
            body.classList.remove('is-mobile', 'is-tablet', 'is-desktop', 'compact-mobile');
            
            // Aggiungi la classe appropriata
            if (width <= 480) {
                body.classList.add('is-mobile');
                body.classList.add('compact-mobile'); // PROFILE COMPACT MOBILE - 25/09/2025
            } else if (width <= 1024) {
                body.classList.add('is-tablet');
            } else {
                body.classList.add('is-desktop');
            }
        }
        
        // Inizializza al caricamento
        updateDeviceClass();
        
        // Aggiorna al ridimensionamento con debounce
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(updateDeviceClass, 100);
        });

        import { supabase } from "/it/supabase-client.js";
        
        let currentUser = null;
        const emptyPlaceholder = 'Non impostato';
        const toast = document.getElementById('status-toast');
        const MAX_AVATAR_SIZE_MB = 2;
        const detailsModal = document.getElementById('details-modal');
        const notificationBadge = document.getElementById('notification-badge');
        const subscriptionStatusBtn = document.getElementById('subscription-status-btn');

        function showToast(message, type = 'success') {
            toast.textContent = message;
            toast.className = `status-toast ${type} show`;
            setTimeout(() => { toast.classList.remove('show'); }, 3000);
        }

        function renderProfileData(profile, details) {
            document.getElementById('avatar-container').innerHTML = `<img id="profile-pic" src="${profile?.avatar_url || `https://placehold.co/128x128/6c5ce7/FFFFFF?text=${(profile?.name || 'U').charAt(0)}`}" alt="Immagine del profilo"><label for="avatar-upload" class="avatar-overlay"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path><circle cx="12" cy="13" r="3"></circle></svg><div class="avatar-loader"></div></label><input type="file" id="avatar-upload" accept="image/*">`;
            document.getElementById('avatar-upload').addEventListener('change', uploadAvatar);
            document.getElementById('user-name').textContent = profile?.name || 'Utente';
            document.getElementById('plan-type').textContent = profile?.plan_type || 'STANDARD';
            document.getElementById('user-email').textContent = currentUser?.email || '...';
            document.getElementById('plan-type-detail').textContent = profile?.plan_type || 'STANDARD';
            document.getElementById('goal-name').textContent = profile?.goal_name || 'Nessun obiettivo';
            const form = document.getElementById('personal-info-form');
            const detailsData = details || {};
            const genderDisplay = form.querySelector('.info-field:nth-child(1) .data-display');
            genderDisplay.textContent = detailsData.gender || emptyPlaceholder;
            genderDisplay.classList.toggle('is-empty', !detailsData.gender);
            document.getElementById('gender-input').value = detailsData.gender || '';
            const birthdateDisplay = form.querySelector('.info-field:nth-child(2) .data-display');
            birthdateDisplay.textContent = detailsData.birthdate ? new Date(detailsData.birthdate).toLocaleDateString('it-IT') : 'Non impostata';
            birthdateDisplay.classList.toggle('is-empty', !detailsData.birthdate);
            document.getElementById('birthdate-input').value = detailsData.birthdate || '';
            const countryDisplay = form.querySelector('.info-field:nth-child(3) .data-display');
            countryDisplay.textContent = detailsData.country || emptyPlaceholder;
            countryDisplay.classList.toggle('is-empty', !detailsData.country);
            document.getElementById('country-input').value = detailsData.country || '';
            const phoneDisplay = form.querySelector('.info-field:nth-child(4) .data-display');
            phoneDisplay.textContent = detailsData.phone || emptyPlaceholder;
            phoneDisplay.classList.toggle('is-empty', !detailsData.phone);
            document.getElementById('phone-input').value = detailsData.phone || '';
        }
        
        async function uploadAvatar(event) {
            const input = event.target;
            if (!currentUser || !input.files || !input.files.length === 0) return;
            const file = input.files[0];
            if (file.size > MAX_AVATAR_SIZE_MB * 1024 * 1024) {
                showToast(`Il file è troppo grande. Limite: ${MAX_AVATAR_SIZE_MB}MB.`, 'error');
                input.value = '';
                return;
            }
            const fileExt = file.name.split('.').pop();
            const filePath = `${currentUser.id}.${fileExt}`;
            const overlay = document.querySelector('.avatar-overlay');
            overlay.classList.add('is-loading');
            try {
                const { error: uploadError } = await supabase.storage.from('avatars').upload(filePath, file, { upsert: true });
                if (uploadError) throw uploadError;
                const { data: urlData } = supabase.storage.from('avatars').getPublicUrl(filePath, { transform: { ts: Date.now() } });
                if (!urlData || !urlData.publicUrl) throw new Error("URL non trovato");
                const publicUrl = urlData.publicUrl;
                const { error: dbError } = await supabase.from('profiles').update({ avatar_url: publicUrl }).eq('id', currentUser.id);
                if (dbError) throw dbError;
                document.getElementById('profile-pic').src = publicUrl;
                showToast('Immagine del profilo aggiornata!', 'success');
            } catch (error) {
                console.error("Errore durante l'upload dell'avatar:", error);
                showToast("Errore nell'aggiornamento dell'immagine.", 'error');
            } finally {
                overlay.classList.remove('is-loading');
                input.value = '';
            }
        }

        async function saveUserData() {
            if (!currentUser) return;
            const saveButton = document.getElementById('save-button');
            saveButton.disabled = true;
            saveButton.textContent = 'Salvataggio...';
            const dataToSave = { id: currentUser.id, gender: document.getElementById('gender-input').value || null, birthdate: document.getElementById('birthdate-input').value || null, country: document.getElementById('country-input').value || null, phone: document.getElementById('phone-input').value || null, };
            const { data, error } = await supabase.from('personal_details').upsert(dataToSave).select().single();
            saveButton.disabled = false;
            saveButton.textContent = 'Salva Modifiche';
            if (error) { console.error('Errore durante il salvataggio:', error); showToast('Errore durante il salvataggio.', 'error'); return; }
            showToast('Profilo aggiornato con successo!', 'success');
            const { data: currentProfile } = await supabase.from('profiles').select('*').eq('id', currentUser.id).single();
            renderProfileData(currentProfile, data);
            toggleEditMode(false);
        }

        function toggleEditMode(isEditing) {
            document.getElementById('personal-info-form').classList.toggle('is-editing', isEditing);
            document.getElementById('edit-button').style.display = isEditing ? 'none' : 'block';
            document.getElementById('save-button').style.display = isEditing ? 'block' : 'none';
        }

        function renderSubscriptionStatus(profile) {
            if (!profile || !profile.plan_type) { subscriptionStatusBtn.style.display = 'none'; return; }
            let text = '', link = '#';
            switch(profile.plan_type) {
                case 'starter': case 'trial':
                    if (profile.trial_end) {
                        const endDate = new Date(profile.trial_end);
                        const today = new Date(); today.setHours(0,0,0,0);
                        const diffTime = endDate - today;
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        if (diffDays >= 0) {
                            if (diffDays > 10) text = `✨ Sblocca tutto! ${diffDays} giorni rimasti`;
                            else if (diffDays > 3) text = `⏰ L'offerta scade! ${diffDays} giorni rimasti`;
                            else text = diffDays > 1 ? `🔥 Affrettati! Solo ${diffDays} giorni` : `🔥 Ultimo giorno! Aggiorna ora`;
                            link = '/it/pricing.html';
                        } else { text = '😭 Prova Scaduta. Aggiorna ora!'; link = '/it/pricing.html'; }
                    } break;
                case 'plus': text = 'MyHomesBudget PLUS'; link = '/it/account.html'; break;
                case 'pro': text = 'MyHomesBudget PRO'; link = '/it/account.html'; break;
            }
            if (text) { subscriptionStatusBtn.textContent = text; subscriptionStatusBtn.href = link; subscriptionStatusBtn.style.display = 'flex'; }
            else { subscriptionStatusBtn.style.display = 'none'; }
        }

        function positionSubscriptionButton() {
            const topCenter = document.querySelector('.top-center');
            const topActions = document.querySelector('.top-actions');
            if (!topCenter || !topActions || !subscriptionStatusBtn) return;
            if (window.innerWidth <= 1200) { if (subscriptionStatusBtn.parentElement !== topActions) topActions.prepend(subscriptionStatusBtn); }
            else { if (subscriptionStatusBtn.parentElement !== topCenter) topCenter.appendChild(subscriptionStatusBtn); }
        }
        
        const safeToNumber = (v) => { const n = parseFloat(v); return Number.isFinite(n) ? n : 0; };

        async function getScheduledTransactions(startDate, endDate) {
            const { data, error } = await supabase.from('transactions').select(`*, categories(name, icon)`).eq('created_by', currentUser.id).eq('is_paid', false).gte('due_date', startDate.toISOString().split('T')[0]).lte('due_date', endDate.toISOString().split('T')[0]).order('due_date', { ascending: true });
            if (error) { console.error("Errore caricamento scadenze:", error); return []; }
            return data;
        }

        function renderDeadlinesList(container, transactions) {
            if (transactions.length === 0) { container.innerHTML = '<div class="empty-state" style="padding: 40px 20px;"><p>Nessuna scadenza in questo periodo.</p></div>'; return; }
            const today = new Date(); today.setHours(0,0,0,0);
            container.innerHTML = transactions.map(tx => {
                const dueDate = new Date(tx.due_date);
                const diffTime = dueDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                const daysLeftText = diffDays < 0 ? 'Scaduta' : (diffDays === 0 ? 'Oggi' : `${diffDays} giorni`);
                const amountClass = tx.kind === 'income' ? 'income' : 'expense';
                const amountSign = tx.kind === 'income' ? '+' : '-';
                return `<div class="deadline-item"><div class="item-details"><span class="note">${tx.note}</span><span class="category">${tx.categories?.name || ''}</span></div><span class="item-amount ${amountClass}">${amountSign}${safeToNumber(tx.amount).toFixed(2)}€</span><span class="days-left">${daysLeftText}</span></div>`;
            }).join('');
        }

        async function updateNotifications() {
            const today = new Date();
            const futureDate = new Date(); futureDate.setDate(today.getDate() + 7);
            const upcoming = await getScheduledTransactions(today, futureDate);
            if(upcoming.length > 0) {
                notificationBadge.textContent = upcoming.length;
                notificationBadge.classList.add('is-visible');
            } else {
                notificationBadge.classList.remove('is-visible');
            }
        }
        
        async function initializePage() {
            const { data: { session }, error: sessionError } = await supabase.auth.getSession();
            if (sessionError || !session) {
                window.location.href = '/it/login.html'; return;
            }
            currentUser = session.user;

            const [profileResponse, detailsResponse] = await Promise.all([
                supabase.from('profiles').select('*').eq('id', currentUser.id).single(),
                supabase.from('personal_details').select('*').eq('id', currentUser.id).single()
            ]);

            if (profileResponse.error && profileResponse.error.code !== 'PGRST116') {
                 console.error("Errore caricamento profilo:", profileResponse.error);
                 showToast("Impossibile caricare il profilo.", "error"); return;
            }
            if (detailsResponse.error && detailsResponse.error.code !== 'PGRST116') {
                 console.error("Errore caricamento dettagli personali:", detailsResponse.error);
            }
            
            document.querySelector('.dashboard-panel').innerHTML = `<div class="profile-header"><div id="avatar-container" class="profile-avatar"><div class="skeleton skeleton-avatar"></div></div><h1 id="user-name" class="profile-name"><span class="skeleton skeleton-title"></span></h1><div id="plan-type" class="profile-plan"><span class="skeleton skeleton-text" style="width: 50px;"></span></div></div><div class="profile-content"><section><div class="profile-info-row"><span class="info-label">📧 Mail di Registrazione</span><span id="user-email" class="info-value"><span class="skeleton skeleton-text"></span></span></div></section><section><h2 class="profile-section-title">✨ Dettagli</h2><div style="display:grid; gap:12px;"><div class="profile-info-row"><span class="info-label">💳 Abbonamento</span><span id="plan-type-detail" class="info-value"><span class="skeleton skeleton-text"></span></span></div><div class="profile-info-row"><span class="info-label">🎯 Obiettivo Configurato</span><span id="goal-name" class="info-value"><span class="skeleton skeleton-text"></span></span></div></div></section><section><h2 class="profile-section-title">👤 Informazioni Personali</h2><div id="personal-info-form" class="personal-info-grid"><div class="info-field"><label>🧑 Genere</label><div class="data-display"><span class="skeleton skeleton-text"></span></div><select class="data-input" id="gender-input"><option value="">Non specificato</option><option value="Uomo">Uomo</option><option value="Donna">Donna</option><option value="Altro">Altro</option></select></div><div class="info-field"><label>🎂 Data di Nascita</label><div class="data-display"><span class="skeleton skeleton-text"></span></div><input type="date" class="data-input" id="birthdate-input"></div><div class="info-field"><label>🌍 Paese</label><div class="data-display"><span class="skeleton skeleton-text"></span></div><input type="text" placeholder="Es. Italia" class="data-input" id="country-input"></div><div class="info-field"><label>📱 Numero di Telefono</label><div class="data-display"><span class="skeleton skeleton-text"></span></div><input type="tel" placeholder="Es. +39 123..." class="data-input" id="phone-input"></div></div></section><div class="profile-actions"><button id="edit-button" class="btn btn-secondary">Modifica</button><button id="save-button" class="btn btn-primary">Salva Modifiche</button></div></div>`;

            renderProfileData(profileResponse.data, detailsResponse.data);
            renderSubscriptionStatus(profileResponse.data);
            positionSubscriptionButton();
            updateNotifications();

            document.getElementById('edit-button').addEventListener('click', () => toggleEditMode(true));
            document.getElementById('save-button').addEventListener('click', saveUserData);
            document.getElementById('logout-btn').addEventListener('click', async (e) => { e.preventDefault(); await supabase.auth.signOut(); window.location.href = "/it/"; });
            document.getElementById('scheduler-btn').addEventListener('click', async () => { const today = new Date(); const futureDate = new Date(); futureDate.setDate(today.getDate() + 30); const scheduled = await getScheduledTransactions(today, futureDate); detailsModal.querySelector('.modal-title').textContent = `Scadenziario (Prossimi 30 giorni)`; renderDeadlinesList(detailsModal.querySelector('#modal-body'), scheduled); detailsModal.classList.add('is-visible'); });
            document.getElementById('notifications-btn').addEventListener('click', async () => { const today = new Date(); const futureDate = new Date(); futureDate.setDate(today.getDate() + 7); const upcoming = await getScheduledTransactions(today, futureDate); detailsModal.querySelector('.modal-title').textContent = `Notifiche (Prossimi 7 giorni)`; renderDeadlinesList(detailsModal.querySelector('#modal-body'), upcoming); detailsModal.classList.add('is-visible'); });
            detailsModal.addEventListener('click', (e) => { if (e.target.classList.contains('modal-overlay') || e.target.closest('.modal-close')) { detailsModal.classList.remove('is-visible'); } });

            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const topActions = document.querySelector('.top-actions');
            if (mobileMenuBtn && topActions) {
              mobileMenuBtn.addEventListener('click', (e) => { e.stopPropagation(); topActions.classList.toggle('is-open'); });
              document.addEventListener('click', (e) => { if (!topActions.contains(e.target) && !mobileMenuBtn.contains(e.target)) { topActions.classList.remove('is-open'); } });
            }
            window.addEventListener('resize', positionSubscriptionButton);
        }

        document.addEventListener('DOMContentLoaded', initializePage);

        // PROFILE MOBILE REDESIGN - Text Overflow Handler - 25/09/2025
        (function() {
            'use strict';
            
            // Funzione per applicare gestione testi lunghi
            function initTextOverflowHandling() {
                const longTextElements = document.querySelectorAll('#user-email, #plan-type-detail, #goal-name, .info-value, .data-display');
                
                longTextElements.forEach(element => {
                    const text = element.textContent.trim();
                    
                    // Applica gestione solo a testi lunghi (>30 caratteri) su mobile
                    if (text.length > 30 && document.body.classList.contains('is-mobile')) {
                        // Verifica se non ha già un bottone "Mostra tutto"
                        if (!element.nextElementSibling || !element.nextElementSibling.classList.contains('show-more-btn')) {
                            element.classList.add('text-clip');
                            
                            // Crea bottone "Mostra tutto"
                            const showMoreBtn = document.createElement('a');
                            showMoreBtn.href = '#';
                            showMoreBtn.className = 'show-more-btn';
                            showMoreBtn.textContent = 'Mostra tutto';
                            showMoreBtn.setAttribute('role', 'button');
                            showMoreBtn.setAttribute('tabindex', '0');
                            showMoreBtn.setAttribute('aria-label', `Mostra il testo completo: ${text}`);
                            
                            // Event handlers per click e keyboard
                            const toggleText = (e) => {
                                e.preventDefault();
                                e.stopPropagation();
                                
                                if (element.classList.contains('text-clip')) {
                                    element.classList.remove('text-clip');
                                    element.classList.add('text-wrap');
                                    showMoreBtn.textContent = 'Nascondi';
                                    showMoreBtn.setAttribute('aria-label', 'Nascondi il testo completo');
                                } else {
                                    element.classList.remove('text-wrap');
                                    element.classList.add('text-clip');
                                    showMoreBtn.textContent = 'Mostra tutto';
                                    showMoreBtn.setAttribute('aria-label', `Mostra il testo completo: ${text}`);
                                }
                            };
                            
                            showMoreBtn.addEventListener('click', toggleText);
                            showMoreBtn.addEventListener('keydown', (e) => {
                                if (e.key === 'Enter' || e.key === ' ') {
                                    toggleText(e);
                                }
                            });
                            
                            // Inserisci il bottone dopo l'elemento
                            element.parentNode.insertBefore(showMoreBtn, element.nextSibling);
                        }
                    }
                });
            }
            
            // Gestione al ridimensionamento finestra
            function handleResize() {
                const isMobile = document.body.classList.contains('is-mobile');
                const showMoreBtns = document.querySelectorAll('.show-more-btn');
                
                if (!isMobile) {
                    // Rimuovi gestione su desktop/tablet
                    showMoreBtns.forEach(btn => {
                        const element = btn.previousElementSibling;
                        if (element) {
                            element.classList.remove('text-clip', 'text-wrap');
                        }
                        btn.remove();
                    });
                } else {
                    // Applica gestione su mobile se non già presente
                    if (showMoreBtns.length === 0) {
                        initTextOverflowHandling();
                    }
                }
            }
            
            // Observer per contenuti aggiunti dinamicamente
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                        // Attendi che il contenuto sia renderizzato
                        setTimeout(() => {
                            if (document.body.classList.contains('is-mobile')) {
                                initTextOverflowHandling();
                            }
                        }, 100);
                    }
                });
            });
            
            // Inizializza osservatore per il pannello dashboard
            const dashboardPanel = document.querySelector('.dashboard-panel');
            if (dashboardPanel) {
                observer.observe(dashboardPanel, {
                    childList: true,
                    subtree: true
                });
            }
            
            // Event listener per ridimensionamento
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(handleResize, 200);
            });
            
            // Inizializzazione iniziale dopo il caricamento del contenuto
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(() => {
                    if (document.body.classList.contains('is-mobile')) {
                        initTextOverflowHandling();
                    }
                }, 1000); // Attendi che tutto il contenuto dinamico sia caricato
            });
            
        })();
    </script>
</body>
</html>
