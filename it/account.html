<!doctype html>
<html lang="it" data-app="myhomesbudget">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Il Mio Account — MyHomesBudget</title>
  <meta name="robots" content="noindex, nofollow" />
  
  <!-- Three.js: Usiamo una versione stabile e compatibile -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <!-- Phosphor Icons -->
  <script src="https://unpkg.com/@phosphor-icons/web"></script>

  <style>
    :root {
      --fg: #111;
      --bg: #f4f7fa;
      --glass: rgba(255,255,255,.6);
      --card-border: rgba(0,0,0,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --radius-lg: 16px;
      --primary-color: #6c5ce7;
      --grad: linear-gradient(135deg, #6c5ce7, #00cec9);
    }

    * { box-sizing: border-box; }
    html { font-family: -apple-system, system-ui, sans-serif; background-color: var(--bg); }
    
    body {
      margin: 0;
      color: var(--fg);
      background: url("/bg.webp") no-repeat center/cover fixed;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    body::before {
      content: ""; position: fixed; inset: 0;
      background: linear-gradient(135deg, rgba(108,92,231,.05), rgba(0,206,201,.05));
      z-index: -1;
    }

    /* ====== TOPBAR ====== */
    .topbar {
      position: fixed; top: 0; left: 0; right: 0; height: 60px; padding: 0 24px;
      display: flex; align-items: center; justify-content: space-between;
      background: var(--glass); backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--card-border); z-index: 100;
    }
    .logo-link { display: flex; align-items: center; gap: 8px; text-decoration: none; }
    .logo-text { font-weight: 600; color: #333; font-size: 1.1rem; }
    
    .top-link {
      display: flex; align-items: center; justify-content: center; height: 34px;
      color: #fff; text-decoration: none; padding: 6px 12px; border-radius: 10px;
      font-size: .9rem; font-weight: 600; background: var(--grad);
      border: none; box-shadow: 0 4px 12px rgba(0,0,0,.15);
      cursor: pointer; transition: transform 0.2s;
    }
    .top-link:hover { transform: translateY(-2px); }

    /* ====== CONTAINER ====== */
    main.container {
      padding: 100px 24px 40px; 
      max-width: 1000px; 
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 85vh;
    }

    /* AREA 3D */
    .character-stage {
      width: 100%;
      height: 450px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    #canvas-container {
      width: 100%; height: 100%;
      display: block;
    }

    /* BUBBLE MESSAGGIO */
    .message-bubble {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(8px);
      padding: 20px 30px;
      border-radius: 30px;
      font-weight: 800;
      font-size: 1.2rem;
      color: #333;
      box-shadow: 0 15px 40px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.5);
      text-align: center;
      margin-top: -50px; 
      z-index: 10;
      opacity: 0;
      transform: translateY(20px) scale(0.9);
      transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .message-bubble.visible { opacity: 1; transform: translateY(0) scale(1); }
    .message-bubble strong { color: var(--primary-color); }

    /* SIMULATORE */
    .plan-simulator {
      margin-top: 40px;
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: var(--shadow);
      text-align: center;
      border: 1px solid var(--card-border);
    }
    .tier-switcher { display: flex; gap: 10px; justify-content: center; margin-top: 10px; }
    .tier-btn {
      padding: 8px 16px; border: 1px solid #ddd; background: #f9f9f9;
      border-radius: 8px; cursor: pointer; font-weight: 600; color: #666;
    }
    .tier-btn.active { 
      background: var(--primary-color); color: #fff; border-color: var(--primary-color);
    }

  </style>
</head>
<body>

  <nav class="topbar">
    <a href="index.html" class="logo-link">
      <img src="/homes.png" alt="Logo" style="height:32px;border-radius:6px; background:#eee;"> 
      <span class="logo-text">MyHomesBudget</span>
    </a>
    <div class="top-nav-right">
      <!-- Tasto Dashboard corretto -->
      <a href="dashboard.html" class="top-link">
        <i class="ph ph-arrow-left" style="margin-right:8px"></i> Dashboard
      </a>
    </div>
  </nav>

  <main class="container">
    
    <div class="character-stage">
      <div id="canvas-container"></div>
    </div>

    <div id="status-message" class="message-bubble">
      Caricamento profilo...
    </div>

    <div class="plan-simulator">
      <p style="font-size:0.85rem; text-transform:uppercase; color:#999; font-weight:700; margin:0;">Simulazione Stato Profilo:</p>
      <div class="tier-switcher">
        <button class="tier-btn active" onclick="updateProfileTier('STARTER')">STARTER</button>
        <button class="tier-btn" onclick="updateProfileTier('PLUS')">PLUS</button>
        <button class="tier-btn" onclick="updateProfileTier('PRO')">PRO</button>
      </div>
    </div>

  </main>

  <script>
    // --- 1. SETUP SCENA 3D ---
    const container = document.getElementById('canvas-container');
    const scene = new THREE.Scene();
    
    const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
    camera.position.set(0, 0.5, 5);

    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    container.appendChild(renderer.domElement);

    // Luci
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambientLight);
    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
    dirLight.position.set(2, 5, 5);
    scene.add(dirLight);

    // --- 2. COSTRUZIONE ROBOT (Geometrie Sicure) ---
    const botGroup = new THREE.Group();
    scene.add(botGroup);

    // Materiali
    const mainMat = new THREE.MeshPhongMaterial({ color: 0xecf0f1, flatShading: false });
    const accentMat = new THREE.MeshPhongMaterial({ color: 0xbdc3c7 }); // Cambierà colore
    const darkMat = new THREE.MeshPhongMaterial({ color: 0x2c3e50 });

    // Corpo
    const body = new THREE.Mesh(new THREE.SphereGeometry(0.9, 32, 32), mainMat);
    body.scale.set(1, 0.85, 1);
    botGroup.add(body);

    // Testa
    const headGroup = new THREE.Group();
    headGroup.position.y = 0.75;
    botGroup.add(headGroup);

    const head = new THREE.Mesh(new THREE.SphereGeometry(0.65, 32, 32), mainMat);
    headGroup.add(head);

    // Visiera
    const visor = new THREE.Mesh(new THREE.SphereGeometry(0.56, 32, 32, 0, 6.3, 0, 1.1), accentMat);
    visor.rotation.x = -Math.PI / 2;
    visor.position.y = 0.14;
    headGroup.add(visor);

    // Occhi (Sfere schiacciate invece di Capsule per compatibilità)
    const leftEye = new THREE.Mesh(new THREE.SphereGeometry(0.12, 16, 16), darkMat);
    leftEye.scale.set(1, 1.5, 0.5);
    leftEye.position.set(-0.22, 0.15, 0.52);
    leftEye.rotation.x = -0.2;
    visor.add(leftEye);

    const rightEye = new THREE.Mesh(new THREE.SphereGeometry(0.12, 16, 16), darkMat);
    rightEye.scale.set(1, 1.5, 0.5);
    rightEye.position.set(0.22, 0.15, 0.52);
    rightEye.rotation.x = -0.2;
    visor.add(rightEye);

    // Braccia
    const armGeo = new THREE.SphereGeometry(0.22, 16, 16);
    
    const armRightGroup = new THREE.Group(); // Perno spalla DX
    armRightGroup.position.set(0.9, 0, 0);
    botGroup.add(armRightGroup);
    const armRight = new THREE.Mesh(armGeo, mainMat);
    armRight.scale.set(1, 1.5, 1);
    armRightGroup.add(armRight);

    // Pollice (inizialmente nascosto o piccolo)
    const thumb = new THREE.Mesh(new THREE.CylinderGeometry(0.06, 0.06, 0.25), mainMat);
    thumb.position.set(0, 0.25, 0.1);
    thumb.rotation.x = 0.5;
    armRight.add(thumb);
    thumb.visible = false;

    const armLeftGroup = new THREE.Group(); // Perno spalla SX
    armLeftGroup.position.set(-0.9, 0, 0);
    botGroup.add(armLeftGroup);
    const armLeft = new THREE.Mesh(armGeo, mainMat);
    armLeft.scale.set(1, 1.5, 1);
    armLeftGroup.add(armLeft);


    // --- 3. LOGICA E ANIMAZIONE ---
    let currentTier = 'LOADING';
    let time = 0;

    function animate() {
      requestAnimationFrame(animate);
      time += 0.05;

      if (currentTier === 'STARTER') {
         // --- TRISTE ---
         // Testa bassa
         headGroup.rotation.x = THREE.MathUtils.lerp(headGroup.rotation.x, 0.5, 0.05);
         // Scuote la testa lentamente (no no)
         headGroup.rotation.y = Math.sin(time * 0.5) * 0.1;
         
         // Corpo fermo e basso
         botGroup.position.y = Math.sin(time) * 0.02 - 0.2;
         
         // Braccia giù
         armRightGroup.rotation.z = THREE.MathUtils.lerp(armRightGroup.rotation.z, 0, 0.1);
         armLeftGroup.rotation.z = THREE.MathUtils.lerp(armLeftGroup.rotation.z, 0, 0.1);
         thumb.visible = false;

      } else if (currentTier === 'PLUS') {
         // --- RIDE / FELICE ---
         // Testa su
         headGroup.rotation.x = THREE.MathUtils.lerp(headGroup.rotation.x, -0.2, 0.05);
         // Ride (vibra un po')
         headGroup.position.y = 0.75 + Math.abs(Math.sin(time * 10)) * 0.02; 
         
         // Corpo saltella piano
         botGroup.position.y = Math.sin(time * 3) * 0.05;

         // Braccia aperte
         armRightGroup.rotation.z = THREE.MathUtils.lerp(armRightGroup.rotation.z, 0.5, 0.1);
         armLeftGroup.rotation.z = THREE.MathUtils.lerp(armLeftGroup.rotation.z, -0.5, 0.1);
         thumb.visible = false;

      } else if (currentTier === 'PRO') {
         // --- ECCITATO ---
         // Testa guarda ovunque
         headGroup.rotation.x = Math.sin(time * 2) * 0.1 - 0.1;
         headGroup.rotation.y = Math.sin(time) * 0.2;
         
         // Salto alto (Jump!)
         botGroup.position.y = Math.abs(Math.sin(time * 4)) * 0.5 - 0.2;
         
         // Braccia in alto
         armRightGroup.rotation.z = THREE.MathUtils.lerp(armRightGroup.rotation.z, 2.5, 0.1); // Su in alto
         armLeftGroup.rotation.z = THREE.MathUtils.lerp(armLeftGroup.rotation.z, -2.5, 0.1); // Su in alto
         
         thumb.visible = true;
      }

      renderer.render(scene, camera);
    }
    animate();

    // --- 4. GESTIONE STATI ---
    window.updateProfileTier = function(tier) {
      currentTier = tier;
      
      // Aggiorna bottoni UI
      document.querySelectorAll('.tier-btn').forEach(b => {
        b.classList.toggle('active', b.innerText === tier);
      });

      const bubble = document.getElementById('status-message');
      bubble.classList.remove('visible');

      setTimeout(() => {
        let msg = "";
        let color = 0xcccccc;

        if(tier === 'STARTER') {
           // Triste
           msg = "Che tristezza... sei ancora <strong>Starter</strong>.<br>Passa a PLUS per iniziare a sorridere!";
           color = 0x34495e; // Blu scuro spento
        } else if(tier === 'PLUS') {
           // Ride
           msg = "Ahah! Grande! Sei <strong>Plus</strong>.<br>Ma se passi a PRO è ancora meglio!";
           color = 0xf1c40f; // Oro
        } else if(tier === 'PRO') {
           // Eccitato
           msg = "WOW! Sei <strong>PRO</strong>!<br>Stai andando alla grande!";
           color = 0x9b59b6; // Viola
        }

        accentMat.color.setHex(color);
        bubble.innerHTML = msg;
        bubble.classList.add('visible');
      }, 200);
    };

    // Init (simulazione caricamento da DB)
    setTimeout(() => updateProfileTier('STARTER'), 500);

    // Resize
    window.addEventListener('resize', () => {
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
    });

  </script>
</body>
</html>
