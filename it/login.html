<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <title>Accedi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <h1>Accesso</h1>

  <!-- Form login con email + password -->
  <form id="login-form">
    <input type="email" id="li-email" placeholder="Email" required />
    <input type="password" id="li-pass" placeholder="Password" required />
    <button type="submit">Accedi</button>
  </form>

  <!-- Pulsante logout -->
  <button id="logout-btn">Esci</button>

  <p><a href="/it/signup.html">Non hai un account? Registrati</a></p>

  <!-- Import client Supabase -->
  <script type="module" src="/it/supabase-client.js"></script>
  <script type="module">
    import { supabase } from "/it/supabase-client.js";

    // Login email + password
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('li-email').value.trim();
      const password = document.getElementById('li-pass').value.trim();

      const { error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) return alert('Errore accesso: ' + error.message);

      // OK â†’ vai in homepage o dashboard
      location.href = "/";
    });

    // Logout
    document.getElementById('logout-btn').addEventListener('click', async () => {
      await supabase.auth.signOut();
      alert('Disconnesso');
    });

    // Monitoraggio stato auth
    supabase.auth.onAuthStateChange((_event, session) => {
      console.log('Auth change:', _event, session);
    });
  </script>
</body>
</html>
