<!doctype html>
<html lang="it" data-app="myhomesbudget">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard — MyHomesBudget (Pro Layout)</title>
  <meta name="robots" content="noindex, nofollow" />
  <link rel="icon" href="/homes.png" type="image/png" sizes="32x32">
  <style>
    /* =====================================================
       DESIGN SYSTEM — MyHomesBudget
       (Mantiene palette e DNA visivo esistenti, eleva UI/UX)
    ====================================================== */
    :root{
      --fg:#0e1116; --bg:#0b1620; /* dark glass background */
      --panel:#0f1d2a; --glass:rgba(255,255,255,.06);
      --border:rgba(255,255,255,.08);
      --shadow:0 12px 40px rgba(0,0,0,.35);
      --radius:16px; --radius-lg:22px; --radius-xl:28px;
      --grad:linear-gradient(135deg,#6c5ce7,#00cec9);
      --grad-2:linear-gradient(135deg,#00cec9,#6c5ce7);
      --danger:#ff5a5f; --success:#0fd47a; --warning:#f5b94c;
      --muted:#8ea0b5; --muted-2:#a9b7c5;
      --ring-blur: 10px;
      --font:-apple-system,system-ui,"Segoe UI",Roboto,Inter,ui-sans-serif,sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    html{font-family:var(--font);color-scheme:dark;}
    body{
      margin:0;color:#eaf1f7;background:radial-gradient(1200px 600px at 20% -10%,rgba(108,92,231,.25),transparent 55%),radial-gradient(900px 600px at 120% 10%,rgba(0,206,201,.20),transparent 50%),var(--bg);
      background-attachment: fixed;
    }
    .visually-hidden{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    /* ===================== Topbar (glass, full-width) ===================== */
    .topbar{position:fixed;inset:12px 12px auto; height:64px; padding:0 16px;display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.04));backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);z-index:1000}
    .logo-link{display:flex;align-items:center;gap:10px;text-decoration:none}
    .logo-link img{height:32px;border-radius:8px}
    .logo-text{font-weight:800;letter-spacing:.2px;color:#fff}
    .top-center{position:absolute;left:50%;transform:translateX(-50%);}
    .top-actions{display:flex;gap:10px;align-items:center}
    .chip, .top-link, .top-btn{display:inline-flex;align-items:center;gap:8px;height:36px;padding:8px 12px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.06);color:#fff;text-decoration:none;font-weight:700;letter-spacing:.2px;box-shadow:0 1px 0 rgba(255,255,255,.05) inset;transition:transform .15s ease,filter .15s ease}
    .top-link:hover,.top-btn:hover{transform:translateY(-1px);filter:brightness(1.08)}
    .chip.primary{background:var(--grad);border:none}

    .date-selectors{display:flex;gap:8px}
    .select{appearance:none;background:rgba(255,255,255,.06);border:1px solid var(--border);color:#fff;padding:8px 36px 8px 12px;border-radius:12px;font-weight:700;position:relative}
    .select-wrap{position:relative}
    .select-wrap::after{content:'▾';position:absolute;right:10px;top:50%;transform:translateY(-50%);opacity:.7}

    .mobile-menu-toggle{display:none}
    @media (max-width:1100px){ .top-center{display:none} }
    @media (max-width:960px){ .mobile-menu-toggle{display:block} }

    /* ===================== Layout grid ===================== */
    main.container{padding:100px 16px 28vh; max-width:1240px; margin:0 auto}
    .grid{display:grid;gap:16px}
    .grid-cols{grid-template-columns:1.2fr .8fr}
    @media (max-width:1024px){ .grid-cols{grid-template-columns:1fr} }

    .panel{background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.04));backdrop-filter:blur(var(--ring-blur));-webkit-backdrop-filter:blur(var(--ring-blur));border:1px solid var(--border);border-radius:var(--radius-lg);box-shadow:var(--shadow)}
    .panel-header{display:flex;align-items:center;justify-content:space-between;padding:16px 18px;border-bottom:1px solid var(--border)}
    .panel-title{display:flex;align-items:center;gap:10px;font-size:1.05rem;font-weight:800;color:#fff;margin:0}
    .panel-body{padding:16px 18px}

    /* ===================== Hero block ===================== */
    .hero{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;margin-bottom:16px}
    @media (max-width:1024px){ .hero{grid-template-columns:1fr} }
    .hero-metric{position:relative;overflow:hidden}
    .rings{display:flex;gap:18px}
    .ring{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;aspect-ratio:1/1;border-radius:20px;background:radial-gradient(64% 64% at 50% 50%,rgba(255,255,255,.12),rgba(255,255,255,.04));border:1px solid var(--border)}
    .ring .value{font-size:1.6rem;font-weight:900}
    .ring .label{color:var(--muted)}

    .insights{display:grid;gap:10px}
    .insight{display:flex;align-items:center;gap:10px;padding:12px;border-radius:14px;background:rgba(255,255,255,.06);border:1px solid var(--border)}
    .insight .dot{width:10px;height:10px;border-radius:50%;background:var(--success);box-shadow:0 0 20px var(--success)}

    /* ===================== To-Do Finanziario (Scadenze) ===================== */
    .deadlines-list{display:grid;gap:10px}
    .deadline-item{display:grid;grid-template-columns:1fr auto auto;gap:10px;align-items:center;padding:12px;border-radius:12px;background:rgba(255,255,255,.06);border:1px solid var(--border)}
    .deadline-item .badge{font-weight:800}
    .deadline-item .amount{font-weight:900}
    .badge.warn{color:var(--warning)}
    .amount.expense{color:var(--danger)}
    .amount.income{color:var(--success)}

    /* ===================== Quick Add Bar (mobile-first) ===================== */
    .quickbar{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);width:min(1080px,calc(100% - 24px));background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,.06));border:1px solid var(--border);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-radius:18px;padding:12px;box-shadow:0 20px 50px rgba(0,0,0,.45);z-index:1200}
    .quickbar form{display:grid;grid-template-columns:1fr .75fr .6fr .6fr .8fr .8fr auto;gap:10px}
    .quickbar .fld{display:flex;flex-direction:column}
    .quickbar label{font-size:.78rem;color:var(--muted-2);margin:0 0 6px 6px;font-weight:700}
    .input,.select-lg{width:100%;padding:11px 12px;border-radius:12px;border:1px solid var(--border);background:rgba(0,0,0,.25);color:#fff;font-weight:700}
    .btn{cursor:pointer;border:none;border-radius:12px;padding:12px 16px;font-weight:900;color:#0d1320;background:var(--grad);box-shadow:0 10px 24px rgba(0,0,0,.26);transition:transform .15s ease,filter .15s ease}
    .btn:hover{transform:translateY(-1px);filter:brightness(1.06)}
    @media (max-width:1080px){ .quickbar form{grid-template-columns:1fr .8fr .8fr 1fr auto} .hide-md{display:none} }
    @media (max-width:680px){ .quickbar form{grid-template-columns:1fr 1fr auto} .hide-sm{display:none} }

    /* ===================== Goals (compatti, modulari) ===================== */
    .goals-wrap{display:grid;gap:16px}
    .goal-card{background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.04));border:1px solid var(--border);border-radius:16px;padding:14px}
    .goal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .goal-name{font-weight:900}
    .goal-body{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center}
    .progress{height:10px;background:rgba(255,255,255,.12);border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;background:var(--grad)}
    .goal-actions .chip{height:32px;padding:6px 10px}

    /* ===================== Streams Entrate/Uscite ===================== */
    .streams{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:1024px){ .streams{grid-template-columns:1fr} }
    .list-title{display:flex;justify-content:space-between;align-items:center;padding:12px 18px;border-bottom:1px solid var(--border);color:var(--muted-2);font-weight:900}
    .tx-list .item{display:grid;grid-template-columns:auto 1fr auto auto;gap:12px;align-items:center;padding:12px 18px;border-bottom:1px solid rgba(255,255,255,.06)}
    .tx-list .item:last-child{border-bottom:0}
    .item .icon{font-size:22px}
    .item .note{font-weight:800}
    .item .cat{color:var(--muted)}
    .item .amt{font-weight:900}
    .amt.expense{color:var(--danger)}
    .amt.income{color:var(--success)}

    /* ===================== Premium Section (blur reveal) ===================== */
    .premium{position:relative;overflow:hidden}
    .premium::after{content:"";position:absolute;inset:0;background:backdrop-filter(blur(14px));}
    .premium-blur{position:absolute;inset:0;backdrop-filter:blur(18px);-webkit-backdrop-filter:blur(18px);}
    .premium-cta{position:absolute;inset:auto 16px 16px 16px;display:flex;justify-content:center}
    .premium-cta .chip{background:var(--grad);border:none}

    /* ===================== Utility ===================== */
    .mb-12{margin-bottom:12px} .mb-16{margin-bottom:16px} .mt-16{margin-top:16px}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <!-- ===== Boot Loader (mantiene id e struttura per JS esistente) ===== -->
  <div id="boot-loader" style="position: fixed; inset: 0; display: flex; align-items: center; justify-content: center;background: rgba(11,22,32,.85); z-index: 2000; flex-direction: column; gap: 12px;">
    <div class="spinner" style="width: 38px; height: 38px; border: 3px solid rgba(255,255,255,.25);border-top-color: #6c5ce7; border-radius: 50%;animation: spin 1s linear infinite"></div>
    <div id="boot-loader-text" style="font-weight:800;color:#fff;opacity:.9">Caricamento…</div>
    <button id="boot-retry-btn" class="btn" style="display:none;">Riprova</button>
  </div>

  <!-- ===================== TOPBAR (glass full-width) ===================== -->
  <nav class="topbar">
    <a href="/it/" class="logo-link">
      <img src="/homes.png" alt="Logo">
      <span class="logo-text">MyHomesBudget</span>
    </a>
    <div class="top-center">
      <!-- Mantiene ID per testo dinamico abbonamento -->
      <a href="/it/pricing.html" id="subscription-status-btn" class="chip primary" style="display:none"></a>
    </div>
    <div class="top-actions">
      <div class="date-selectors">
        <span class="select-wrap"><select id="month-selector" class="select"></select></span>
        <span class="select-wrap"><select id="year-selector" class="select"></select></span>
      </div>
      <a href="/it/onboarding.html?edit=1" class="top-link">🎯 Obiettivo</a>
      <button id="scheduler-btn" class="top-btn" aria-label="Apri scadenziario">🗓️</button>
      <button id="notifications-btn" class="top-btn" aria-label="Apri notifiche">🔔<span id="notification-badge" class="chip" style="display:none;padding:0 6px;height:22px"></span></button>
      <a href="#" id="logout-btn" class="top-link">Esci</a>
    </div>
  </nav>

  <main class="container">
    <!-- ===================== HERO ===================== -->
    <section class="hero">
      <!-- Hero Metric -->
      <div class="panel hero-metric">
        <header class="panel-header"><h2 class="panel-title">📊 Panoramica Mese</h2></header>
        <div class="panel-body">
          <div class="rings">
            <div class="ring">
              <div id="hero-balance" class="value">€ 0,00</div>
              <div class="label">Saldo</div>
            </div>
            <div class="ring">
              <div id="hero-budget" class="value">0%</div>
              <div class="label">Budget rispettato</div>
            </div>
            <div class="ring">
              <div id="hero-goals" class="value">0%</div>
              <div class="label">Avanzamento obiettivi</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Insights -->
      <div class="panel">
        <header class="panel-header"><h2 class="panel-title">✨ Insight del mese</h2></header>
        <div class="panel-body insights">
          <div id="free-insight" class="insight"><span class="dot"></span><div><strong>Ben fatto!</strong> Sei sotto al budget ristoranti di 12%.</div></div>
          <div class="insight premium" style="position:relative;">
            <div class="premium-blur"></div>
            <div style="position:relative;opacity:.9">Previsione AI: se mantieni il ritmo, chiudi il mese con +€180.</div>
            <div class="premium-cta"><a href="/it/pricing.html" class="chip">🔓 Sblocca con Pro</a></div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===================== SCADENZE (To-Do finanziario) ===================== -->
    <section id="deadlines-section" class="panel mb-16" style="display:none;">
      <header class="panel-header"><h2 class="panel-title">🔔 Scadenze & Voci Future (30 giorni)</h2></header>
      <div class="panel-body">
        <div id="deadlines-list" class="deadlines-list"></div>
      </div>
    </section>

    <!-- ===================== GOALS ===================== -->
    <section id="goals-section" class="panel mb-16">
      <header class="panel-header">
        <h3 class="panel-title">🎯 I Tuoi Obiettivi</h3>
        <button id="add-goal-btn" class="chip" style="display:none">+ Aggiungi</button>
      </header>
      <div id="goals-list" class="panel-body goals-wrap">
        <!-- Card generate via JS. Mantiene ID.  -->
        <!-- Esempio placeholder statico (puoi rimuoverlo in produzione): -->
        <!--
        <article class="goal-card">
          <div class="goal-head"><div class="goal-name">Fondo emergenze</div><div class="goal-actions"><button class="chip">Modifica</button></div></div>
          <div class="goal-body">
            <div>
              <div class="progress"><i style="width:40%"></i></div>
              <div class="muted">€ 800 / € 2.000 • 4 mesi rimanenti</div>
            </div>
            <div class="goal-actions"><button class="chip">Aggiungi quota</button></div>
          </div>
        </article>
        -->
      </div>
    </section>

    <!-- ===================== STREAMS ENTRATE/USCITE ===================== -->
    <section class="grid grid-cols">
      <div class="panel">
        <div class="list-title"><span>✅ Entrate Recenti</span><strong id="income-total">€ 0,00</strong></div>
        <div id="income-summary" class="panel-body"></div>
        <div id="income-list" class="panel-body tx-list"></div>
      </div>
      <div class="panel">
        <div class="list-title"><span>❌ Uscite Recenti</span><strong id="expense-total">€ 0,00</strong></div>
        <div id="expense-summary" class="panel-body"></div>
        <div id="expense-list" class="panel-body tx-list"></div>
      </div>
    </section>

    <!-- ===================== NAV SECONDARIO ===================== -->
    <nav id="dash-nav" class="panel mt-16">
      <div class="panel-body grid-2">
        <a href="/it/profile.html" class="chip">Profilo</a>
        <div style="display:flex;gap:10px;justify-content:flex-end">
          <a href="/it/dashboard.html" class="chip" aria-current="page">Operazioni</a>
          <a href="/it/dashboard-riepilogo.html" class="chip">Riepilogo</a>
          <button id="list-movements-btn" class="chip">Lista Movimenti</button>
        </div>
      </div>
    </nav>
  </main>

  <!-- ===================== QUICK ADD BAR (mantiene id form/fields) ===================== -->
  <section class="quickbar" aria-label="Aggiungi operazione rapida">
    <form id="transaction-form" class="transaction-form">
      <input type="hidden" id="transaction-id" name="transaction-id">
      <div class="fld hide-sm"><label for="kind">Tipo</label><select id="kind" name="kind" class="select-lg" required><option value="expense">Uscita</option><option value="income">Entrata</option></select></div>
      <div class="fld"><label for="note">Nota</label><input id="note" name="note" class="input" placeholder="Es. Stipendio, Rata Mutuo…" required></div>
      <div class="fld"><label for="amount">Importo (€)</label><input id="amount" name="amount" class="input" type="number" step="0.01" placeholder="0.00" required inputmode="decimal"></div>
      <div class="fld hide-sm"><label for="occurred_at">Data</label><input id="occurred_at" name="occurred_at" class="input" type="date" required></div>
      <div class="fld hide-md"><label for="category_id">Categoria</label><select id="category_id" name="category_id" class="select-lg" required></select></div>
      <div class="fld hide-md"><label for="subcategory_id">Sottocategoria</label><select id="subcategory_id" name="subcategory_id" class="select-lg"></select></div>

      <!-- Opzioni avanzate: manteniamo gli ID per la tua logica JS -->
      <button type="button" class="chip" onclick="document.getElementById('advanced-options-wrapper').style.display='grid'">Avanzate</button>
      <button type="submit" id="submit-btn" class="btn">Aggiungi</button>

      <!-- Hidden container richiesto dal tuo JS esistente -->
      <div id="advanced-options-wrapper" style="display:none; grid-column:1 / -1; background:rgba(255,255,255,.05); border:1px solid var(--border); border-radius:12px; padding:12px; margin-top:8px">
        <div class="advanced-options-controls" style="display:flex;flex-wrap:wrap;gap:14px;align-items:center;margin-bottom:10px">
          <label><input type="radio" name="transaction_type" value="single" checked> Operazione Singola</label>
          <label><input type="radio" name="transaction_type" value="recurring"> 🔄 Ricorrente</label>
          <label><input type="radio" name="transaction_type" value="scheduled"> 🗓️ Imposta Scadenza</label>
        </div>
        <div id="recurring-options" class="advanced-options-fields" style="display:none;grid-template-columns:1fr 1fr;gap:12px">
          <div class="fld"><label for="recurring_frequency">Frequenza</label><select id="recurring_frequency" name="recurring_frequency" class="select-lg"><option value="monthly">Mensile</option></select></div>
          <div class="fld"><label for="recurring_end_date">Termina il</label><input type="date" id="recurring_end_date" name="recurring_end_date" class="input"></div>
        </div>
        <div id="due-date-options" class="advanced-options-fields" style="display:none;grid-template-columns:1fr;gap:12px">
          <div class="fld"><label for="due_date">Data di Scadenza/Incasso</label><input type="date" id="due_date" name="due_date" class="input"></div>
        </div>
      </div>

      <button type="button" id="cancel-edit-btn" class="chip" style="display:none">Annulla</button>
      <div id="status-message" class="visually-hidden" aria-live="polite"></div>
    </form>
  </section>

  <!-- ===================== MODALS (mantengono id originali) ===================== -->
  <div id="scheduler-modal" class="modal-overlay" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:1500">
    <div class="modal-content panel" style="width:min(1000px,92vw);max-height:80vh;overflow:auto">
      <div class="panel-header"><h3 id="scheduler-modal-title" class="panel-title">Scadenziario</h3><button class="top-btn" onclick="this.closest('.modal-overlay').style.display='none'">✖</button></div>
      <div id="scheduler-modal-body" class="panel-body transaction-list"></div>
    </div>
  </div>

  <div id="generic-modal" class="modal-overlay" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:1500">
    <div class="modal-content panel" style="width:min(820px,92vw);max-height:80vh;overflow:auto">
      <div class="panel-header"><h3 id="generic-modal-title" class="panel-title">Titolo</h3><button class="top-btn" onclick="this.closest('.modal-overlay').style.display='none'">✖</button></div>
      <div id="generic-modal-body" class="panel-body"></div>
      <div id="generic-modal-footer" class="panel-body" style="display:flex;justify-content:flex-end;gap:10px"></div>
    </div>
  </div>

  <div id="animation-modal" class="animation-modal-overlay" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(10,25,47,.85);z-index:1600">
    <div class="animation-container" style="width:320px;height:320px;display:flex;align-items:center;justify-content:center">
      <img id="animation-bg-image" class="animation-bg-image" src="" alt="Animazione soldi" style="width:100%;height:100%;object-fit:contain;filter:drop-shadow(0 0 20px rgba(0,0,0,.6))"/>
      <div class="animation-elements-container"></div>
    </div>
  </div>

  <div id="movements-modal" class="modal-overlay" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:1500">
    <div class="modal-content panel" style="width:min(1100px,95vw);max-height:80vh;overflow:auto">
      <div class="panel-header"><h3 id="movements-modal-title" class="panel-title">Lista Movimenti</h3><button class="top-btn" onclick="this.closest('.modal-overlay').style.display='none'">✖</button></div>
      <div id="movements-modal-body" class="panel-body"><div class="movements-table-container"></div></div>
      <div id="movements-modal-footer" class="panel-body" style="display:flex;gap:18px;justify-content:space-around"></div>
    </div>
  </div>

  <!-- ===================== JS HOOK (solo mount; logiche restano nel tuo JS esistente) ===================== -->
  <script type="module">
    /*
      Questo file è un MOCKUP UI/UX.
      - Mantiene tutti gli ID chiave della tua dashboard per il JS esistente (Supabase, eventi, rendering liste, etc.).
      - Reordering sezioni: Deadlines in alto, Hero motivazionale, Goals compatti, Streams ben separati.
      - Quick Add Bar fissa in basso per mobile e desktop.
      In produzione, collega i tuoi metodi esistenti per:
        - populateSelectors(month-selector, year-selector)
        - renderDeadlinesList(deadlines-list, ...)
        - renderSummary(renderList) su income/expense
        - handleFormSubmit / handleEdit / handleDelete...
    */

    // Accessori minimi per demo visuale (safe)
    const balanceEl = document.getElementById('hero-balance');
    const budgetEl = document.getElementById('hero-budget');
    const goalsEl  = document.getElementById('hero-goals');
    const boot = document.getElementById('boot-loader');
    setTimeout(()=> boot.style.display = 'none', 600);

    // Placeholder demo (rimuovi quando colleghi i dati reali)
    balanceEl.textContent = '€ 1.245,80';
    budgetEl.textContent  = '78%';
    goalsEl.textContent   = '42%';

    // Badge notifiche demo
    const nb = document.getElementById('notification-badge');
    if(nb){ nb.style.display='inline-flex'; nb.textContent='3'; }
  </script>
</body>
</html>
